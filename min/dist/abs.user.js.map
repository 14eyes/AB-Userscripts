{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./min/src/abs.user.js"],"names":["AnimeBytesDeliciousUserScripts","EnhancedTorrentView","_debug","settingsKeys","i","length","delicious","settings","init","ensureSettingsInserted","section","createCollapsibleSection","s","querySelector","appendChild","createCheckbox","createDropDown","default","insertSection","days_per_year","show_yen","GM_getValue","show_required_time","sort_rows","filter_torrents","dynamic_load","time_frame","parseInt","get","time_frame_string","log10","Math","round","log","LN10","size_RegExp","ratio_RegExp","and_RegExp","duration_RegExp","datetime_RegExp","currency_RegExp","unit_prefix","prefix","toUpperCase","get_column","row","cell","cells","column","row_cell","colSpan","get_cell","index","get_next_separator_element_sibling","id","indexOf","className","nextElementSibling","get_corresponding_torrent_row","anchor","match","href","new_row","document","getElementById","duration_to_string","duration","days","floor","hours","minutes","ceil","res","yen_to_string","yen","toFixed","max","f_interest","f_duration","user_age","Date","getTime","console","min","f_size","size","sqrt","f_seeders","seeders","f_age","exp","isNaN","f","yen_generation_title","title","toPrecision","temp","start","end","yen_per_GB","toggle_yen","toggle","querySelectorAll","style","display","parse_cell","text_content","textContent","trim","text_content_no_comma","replace","image","alt","parseFloat","durations","num","undefined","push","Infinity","test","parse_row","size_index","seeders_index","duration_index","hr_index","size_cell","seeders_cell","duration_cell","torrent_row","seeding_time","block_quote","createElement","innerHTML","td1","td2","addEventListener","row_data","j","remaining","parse_table","table","headers","toLowerCase","nodeName","charAt","non_torrents","non_torrent","cells_1","last_cell","table_data","real_torrents","table_body","parentNode","sort_index","sort_descending","sort_function","a","b","sort_by_index","event","stopPropagation","preventDefault","reverse","sort","next_separator_element","insertBefore","load_history_page","prev","new_page","previous_page","next_page","last_page","previous_anchors","pagenum","removeChild","next_anchors","url","URL","split","xhr","XMLHttpRequest","open","send","onreadystatechange","readyState","parser","DOMParser","new_document","parseFromString","responseText","new_torrents","new_torrent","current_page_match","current_page","pagenums","previousElementSibling","last_child","lastElementChild","lastPageMatch","clone","cloneNode","new_pagenum","hasChildNodes","lastChild","nextSibling","filter_torrent_table","filter_body","deselected","checkboxes","firstElementChild","checkbox","checked","value","new_form","available_tags","values_by_column","dual_audio","freeleech","remastered","torrent","is_freeleech","is_remastered","is_dual_audio","corresponding","text","torrent_tags","map","e","to_be_collapsed","tag","hasOwnProperty","splice","Object","keys","shown_values","sorted_tags","len","label","input","marginRight","opacity","tagName","replaceChild","head_click_event","span","head","body","box","all_torrent_tables","toString","user_link","user_heading","user_profile_re","user_stats","children","child","join_date","timezone_re","GM_setValue","JSON","stringify","parse","error","call","ABFLStatus","_migrateStringSetting","pieLocations","createFieldSetSetting","niceNumber","slice","locked","getFLInfo","parseFLInfo","elem","boxes","current","tr","titles","hrefs","amounts","colors","sum","el","td","next_index","now","XPCNativeWrapper","window","wrappedJSObject","exc","updatePieChart","getPieChart","circlePart","diff","color","x","sin","phi","y","cos","PI","v","w","z","perc","str","pieChart","p","p3","li","p2","nav","firstChild","pos","ul","outerSpan","utilities","toggleSubnav","parent","userstats","tw","createTreeWalker","NodeFilter","SHOW_TEXT","acceptNode","node","data","nextNode","cNode","hr","clear","currentNode","ForumSearchEnhancement","textSettings","k","set","createColourSetting","createTextSetting","width","allResults","background_color","button","cb","filterPost","forumIds","forumid","getFirstTagParent","hideSubSelection","linkbox1","loadPost","loadText","loadThreadPage","loadingText","myCell","myLINK","newCheckbox","newLinkBox","patt","processThreadPage","quickLink","quickLinkSubs","result","sR","searchForums","searchForumsCB","searchForumsNew","showFastSearchLinks","showPost","strong","tP","textReplace","text_color","toggleText","toggleVisibility","user_filter","user_td","user_tr","workInForumSearch","workInRestOfForum","regExp","walk","RegExp","term","args","newSpan","newTextNode","offset","arguments","splitText","substr","backgroundColor","createTextNode","threadid","page","link","_i","len1","linkbox","myColsp","nextPost","post","prevPost","ref","ref1","threadPage","user_id","user","callback","filtered","newLink","previousSibling","visibility","nextTP","prevTP","toFilter","user_name","placeholder","type","results","userName","disabled","ABHidePMstaff","_enabled","basicScriptCheckbox","pmstaffnode","evaluate","XPathResult","FIRST_ORDERED_NODE_TYPE","singleNodeValue","ABHideTreats","treatsnode","Hoverin","css","getElementsByTagName","ABHyperQuote","formattedUTCString","date","timezone","creation","toUTCString","substring","QUOTEALL","sel","getSelection","rangeCount","getRangeAt","QUOTEMANY","allRanges","startRange","previousRange","thisRange","startOffset","endContainer","childNodes","endOffset","startContainer","newRange","createRange","setStart","setEnd","range","removeChildren","inArray","arr","isSmartQuote","quoteNode","colon","nodeValue","isUsernameQuote","wrote","nodeType","Node","ELEMENT_NODE","TEXT_NODE","savePreviousNodes","docFrag","createDocumentFragment","q","savedPreviousNodes","preserveIfNeeded","numToSave","pair","dataset","traverseUpwards","bottomNode","preserve","path","traverseDownwards","topNode","collapsed","html1","t","html2","u","htmlCopy","startNode","endNode","commonRoot","rootQuote","secondChild","classList","contains","selector","copyNode","bbcodeChildrenTrim","scrollIntoView","posts","l","QUOTEONE","postDiv","bbcodeChildren","bbcodeString","thisNode","exception","bbcodeSmartQuote","isBasicQuote","bbcodeQuote","isMediainfo","bbcodeMediainfo","bbcodeOneElement","quoteName","contents","strongNode","wroteLink","quoteType","exec","bbcodeStrong","dateString","bbcodeDiv","divNode","textAlign","align","bbcodeSpoiler","spoilerDiv","isSpoiler","bbcodeTag","buttonDiv","mediainfoTable","bbcodeList","listNode","c","childElementCount","bbcodeImage","imgNode","src","numToHex","h","rgbRegex","bbcodeSpan","spanNode","bbcodeSmiley","colour","rgbMatch","smileySpan","smiley","smileyNode","getAttribute","userRegex","torrentRegex","bbcodeLink","linkElement","realHref","userMatch","torrentMatch","youtubeRegex","soundcloudRegex","bbcodeIframe","iframeNode","decodeURIComponent","COMMENT_NODE","author","postid","location","pathname","search","ctrlKey","keyCode","charCodeAt","ABKeyboardShortcuts","custom_insert_text","close","activeElement","selectionStart","startPos","endPos","selectionEnd","focus","setSelectionRange","selection","move","select","ctrlorcmd","navigator","appVersion","insertedQueries","insert","key","ctrl","shift","query","String","fromCharCode","charCode","metaKey","altKey","shiftKey","imgs","img","keydownHandler","textAreas","mutationHandler","mutations","observer","addedNodes","mutationObserver","MutationObserver","observe","childList","subtree","ABTitleInverter","join","ABTitleNotifications","new_count","cnt","notifications","_len","createNumberInput","unread_tablenode","dividernode","newsnode","ABUnreadIndex","unread_doc","implementation","createHTMLDocument","xmlhttp","status","documentElement","unread_posts","rows","padding","deleteCell","deleteRow","marginBottom","ABYenStats","compoundInterest","years","pow","formatInteger","bytecount","unit","humancount","abs","dt","dd","addDefinitionAfter","after","definition","cclass","addDefinitionBefore","before","addRawStats","rawUpMatch","rawDownMatch","ratioNode","ulNode","dlNode","dl","uploaded","downloaded","rawuploaded","rawdownloaded","rawRatio","rawRatioNode","printBuffer","d","r","myRatio","addYenPerStats","dpy","ypdNode","ypy"],"mappings":"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","file":"abs.user.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","// ==UserScript==\r\n// @name        AnimeBytes delicious user scripts (updated)\r\n// @author      aldy, potatoe, alpha, Megure\r\n// @version     2.1.3\r\n// @description Userscripts to enhance AnimeBytes in various ways. (Updated by TheFallingMan)\r\n// @match       https://*.animebytes.tv/*\r\n// @icon        http://animebytes.tv/favicon.ico\r\n// @grant       GM_getValue\r\n// @grant       GM_setValue\r\n// @require     https://github.com/momentary0/AB-Userscripts/raw/master/delicious-library/src/ab_delicious_library.js\r\n// ==/UserScript==\r\n\r\n(function AnimeBytesDeliciousUserScripts() {\r\n    /* Begin src/ab_enhanced_torrent_view.user.js */\r\n    // ==UserScript==\r\n    // @name        Enhanced Torrent View\r\n    // @namespace   Megure@AnimeBytes.tv\r\n    // @description Shows how much yen you would receive if you seeded torrents; shows required seeding time; allows sorting and filtering of torrent tables; dynamic loading of transfer history tables\r\n    // @include     http*://animebytes.tv*\r\n    // @version     1.02\r\n    // @grant       GM_getValue\r\n    // @grant       GM_setValue\r\n    // @icon        http://animebytes.tv/favicon.ico\r\n    // @require     https://github.com/momentary0/AB-Userscripts/raw/master/delicious-library/src/ab_delicious_library.js\r\n    // ==/UserScript==\r\n\r\n    // Enhanced Torrent View by Megure\r\n    // Shows how much yen you would receive if you seeded torrents; shows required seeding time; allows sorting and filtering of torrent tables; dynamic loading of transfer history tables\r\n    (function EnhancedTorrentView() {\r\n        var _debug = false;\r\n        var settingsKeys = ['ABTorrentsShowYen', 'ABTorrentsReqTime',\r\n            'ABSortTorrents', 'ABTorrentsFilter', 'ABHistDynLoad'];\r\n        for (let i = 0; i < settingsKeys.length; i++) {\r\n            delicious.settings.init(settingsKeys[i], true);\r\n        }\r\n        delicious.settings.init('ABTorrentsYenTimeFrame', '24');\r\n\r\n        if (delicious.settings.ensureSettingsInserted()) {\r\n            var section = delicious.settings.createCollapsibleSection('Enhanced Torrent View');\r\n            var s = section.querySelector('.settings_section_body');\r\n            s.appendChild(delicious.settings.createCheckbox(\r\n                'ABTorrentsShowYen',\r\n                'Show yen generation',\r\n                'Show yen generation for torrents, with detailed information when hovered.'\r\n            ));\r\n            s.appendChild(delicious.settings.createDropDown(\r\n                'ABTorrentsYenTimeFrame',\r\n                'Yen time frame',\r\n                'Shows yen generated in this amount of time.',\r\n                [['Hour', '1'],\r\n                    ['Day', '24'],\r\n                    ['Week', '168']],\r\n                {default: '24'}\r\n            ));\r\n            s.appendChild(delicious.settings.createCheckbox(\r\n                'ABTorrentsReqTime',\r\n                'Show required seeding time',\r\n                'Shows minimal required seeding time for torrents in their description and when size is hovered.'\r\n            ));\r\n            s.appendChild(delicious.settings.createCheckbox(\r\n                'ABTorrentsFilter',\r\n                'Filter torrents',\r\n                'Shows a box above torrent tables, where you can filter the torrents from that table.'\r\n            ));\r\n            s.appendChild(delicious.settings.createCheckbox(\r\n                'ABSortTorrents',\r\n                'Sort torrents',\r\n                'Allows torrent tables to be sorted.'\r\n            ));\r\n            s.appendChild(delicious.settings.createCheckbox(\r\n                'ABHistDynLoad',\r\n                'Dynamic history tables',\r\n                'Dynamically load more pages into the transfer history page.'\r\n            ));\r\n            delicious.settings.insertSection(section);\r\n        }\r\n\r\n        var _debug = false;\r\n\r\n        var days_per_year = 365.256363;\r\n        var show_yen = GM_getValue('ABTorrentsShowYen', 'true') === 'true';\r\n        var show_required_time = GM_getValue('ABTorrentsReqTime', 'true') === 'true';\r\n        var sort_rows = GM_getValue('ABSortTorrents', 'true') === 'true';\r\n        var filter_torrents = GM_getValue('ABTorrentsFilter', 'true') === 'true';\r\n        var dynamic_load = GM_getValue('ABHistDynLoad', 'true') === 'true';\r\n        var time_frame = parseInt(delicious.settings.get('ABTorrentsYenTimeFrame', '24'), 10);\r\n        var time_frame_string = time_frame + ' hours';\r\n        if (time_frame === 1) {\r\n            time_frame_string = 'hour';\r\n        }\r\n        else if (time_frame === 24) {\r\n            time_frame_string = 'day';\r\n        }\r\n        else if (time_frame === 168) {\r\n            time_frame_string = 'week';\r\n        }\r\n        // How many digits to show for Yen over time_frame, see yen_to_string\r\n        var log10 = Math.round(Math.log(time_frame) / Math.LN10);\r\n        var size_RegExp = /^([\\d\\.]+)\\s(?:([a-zA-Z])i)?B(?:\\s\\(([\\d\\.]+)%\\))?$/;\r\n        var ratio_RegExp = /^(∞|\\-\\-|[\\d\\.]+)$/;\r\n        var and_RegExp = /(and|\\s)/ig;\r\n        var duration_RegExp = /^(?:(\\d+)years?)?(?:(\\d+)months?)?(?:(\\d+)weeks?)?(?:(\\d+)days?)?(?:(\\d+)hours?)?(?:(\\d+)minutes?)?(?:(\\d+)seconds?)?(?:\\s*\\([^)]*\\)\\s*)*$/;\r\n        var datetime_RegExp = /^(\\d+)\\-(\\d{1,2})\\-(\\d{1,2})\\s+(\\d{1,2}):(\\d{1,2})$/;\r\n        var currency_RegExp = /^(?:[¥|€|£|\\$]\\s*)([\\d\\.]+)$/;\r\n        function unit_prefix(prefix) {\r\n            // If prefix is undefined, the regex failed to match a prefix\r\n            // and we assume it is in bytes.\r\n            if (typeof prefix === 'undefined') return 1 / 1073741824;\r\n            // This is called with only the prefix of the byte unit\r\n            switch (prefix.toUpperCase()) {\r\n            case '':\r\n                return 1 / 1073741824;\r\n            case 'K':\r\n                return 1 / 1048576;\r\n            case 'M':\r\n                return 1 / 1024;\r\n            case 'G':\r\n                return 1;\r\n            case 'T':\r\n                return 1024;\r\n            case 'P':\r\n                return 1048576;\r\n            case 'E':\r\n                return 1073741824;\r\n            default:\r\n                return 0;\r\n            }\r\n        }\r\n        function get_column(row, cell) {\r\n            var cells = row.cells;\r\n            var column = 0;\r\n            for (var i = 0, length = cells.length; i < length; i++) {\r\n                var row_cell = cells[i];\r\n                if (row_cell === cell) {\r\n                    break;\r\n                }\r\n                column += row_cell.colSpan;\r\n            }\r\n            return column;\r\n        }\r\n        function get_cell(row, index) {\r\n            var cells = row.cells;\r\n            var column = 0;\r\n            for (var i = 0, length = cells.length; i < length; i++) {\r\n                var row_cell = cells[i];\r\n                if (column === index) {\r\n                    return row_cell;\r\n                }\r\n                column += row_cell.colSpan;\r\n            }\r\n            return null;\r\n        }\r\n        function get_next_separator_element_sibling(row) {\r\n            while ((row != null) && row.id.indexOf('group_') !== 0 && row.className.indexOf('edition_info') === -1) {\r\n                row = row.nextElementSibling;\r\n            }\r\n            return row;\r\n        }\r\n        function get_corresponding_torrent_row(row) {\r\n            var anchor = row.querySelector('a[title=\"Download\"]');\r\n            if (anchor !== null) {\r\n                //console.log(anchor.href);\r\n                var match = anchor.href.match(/torrent\\/(\\d+)\\/download/i);\r\n                if (match !== null) {\r\n                    var new_row = document.getElementById('torrent_' + match[1]);\r\n                    if (new_row !== row) {\r\n                        return new_row;\r\n                    }\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n        // Converts a duration of hours into a string, like 3 days, 4 hours and 17 minutes\r\n        function duration_to_string(duration) {\r\n            var days = Math.floor(duration / 24);\r\n            var hours = Math.floor(duration % 24);\r\n            var minutes = Math.ceil((duration * 60) % 60);\r\n            var res = days + ' days';\r\n            if (hours > 0) {\r\n                res += minutes === 0 ? ' and ' : ', ';\r\n                res += hours + ' hours';\r\n            }\r\n            if (minutes > 0) {\r\n                res += ' and ' + minutes + ' minutes';\r\n            }\r\n            return res;\r\n        }\r\n        // Show 2 - log10 digits\r\n        function yen_to_string(yen) {\r\n            return yen.toFixed(Math.max(2 - log10, 0));\r\n        }\r\n        // The compound interest factor for yen generation over time_frame hours\r\n        // time_frame is in hours and is the number of hours to find yen for.\r\n        // Oversimplified. I think this tries to account for the increase of yen/h over time as seeding duration increases\r\n        // when displaying yen/week.\r\n        //var f_interest = 24 * days_per_year / time_frame * (Math.pow(2, time_frame / (24 * days_per_year)) - 1) / Math.log(2);\r\n        var f_interest = 1;\r\n\r\n\r\n        // The duration factor for yen generation\r\n        // seeding duration is only available on the \"Seeding Torrents\" page. Assumes 0 on any other.\r\n        // duration is in hours.\r\n        function f_duration(duration) {\r\n            // user_age in hours\r\n            var user_age = ((new Date()).getTime() - parseInt(GM_getValue('creation', '0'), 10)) / 1000 / 60 / 60;\r\n            _debug && console.log('age: ' + user_age);\r\n            _debug && console.log('duration: ' + duration);\r\n            // number of years + 2\r\n            // 2018-04-11 - caps duration bonus to user age\r\n            return Math.min(duration, user_age) / (24 * days_per_year) + 2;\r\n        }\r\n        // The size factor for yen\r\n        // Size is in GB\r\n        function f_size(size) {\r\n            // max function handles the size < 10MB condition\r\n            return Math.max(0.1, Math.sqrt(size)) / 4;\r\n        }\r\n        // The seeders factor for yen generation\r\n        // Reciprocal of the wiki article's formula to allow calculation of % increase.\r\n        function f_seeders(seeders) {\r\n            if (seeders > 3) {\r\n                return 3 / Math.sqrt(seeders + 4);\r\n            } else {\r\n                return 2;\r\n            }\r\n        }\r\n        // The age factor for yen generation\r\n        // 'creation' is milliseconds. 1728000000 is 20 days in ms.\r\n        // Calculates how old the account is, then divides that by 20 days (in ms).\r\n        // Logistics function starting at 2 then declining to approach 1 over time.\r\n        var f_age = 2 - 1 / (1 + Math.exp(5 - ((new Date()).getTime() - parseInt(GM_getValue('creation', '0'), 10)) / 1728000000));\r\n        if (isNaN(f_age)) {\r\n            f_age = 1;\r\n        }\r\n\r\n        // Compound function for yen generation\r\n        function f(size, seeders, duration) {\r\n            //console.log(\"size: \" + size + \" seed: \" + seeders + \" dur: \" + duration + \" f_age: \" + f_age + \" time_f: \" + time_frame + \" int: \" + f_interest);\r\n            //console.log(GM_getValue('creation', '0'));\r\n            return f_size(size) * f_seeders(seeders) * f_duration(duration) * f_age * time_frame * f_interest;\r\n        }\r\n        // Creates title when hovering over yen generation to break down factors\r\n        function yen_generation_title(size, seeders, duration) {\r\n            var title = 'Click to toggle between Yen per ' + time_frame_string + '\\nand Yen per ' + time_frame_string + ' per GB of size.\\n\\n';\r\n\r\n            // Added f_duration(0) and f_seeders(1) to account for 2017 yen changes.\r\n            // The changes altered the initial values of these and hence altered the 'base' yen/h here.\r\n            title += '¥' + (f_seeders(1) * f_duration(0) * time_frame * f_size(size)).toPrecision(6) + ' \\tbase for size';\r\n            var temp = (100 * (f_interest - 1)).toFixed(1);\r\n            if (temp !== '0.0') {\r\n                title += '\\n+' + temp + '% \\tfor interest per ' + time_frame_string;\r\n            }\r\n            temp = (100 * (f_age - 1)).toFixed(1);\r\n            if (temp !== '0.0') {\r\n                title += '\\n+' + temp + '% \\tfor your account\\'s age';\r\n            }\r\n            // added divide by f_duration(0) to get accurate % change from initial\r\n            temp = (100 * (f_duration(duration) / f_duration(0) - 1)).toFixed(1);\r\n            if (temp !== '0.0') {\r\n                title += '\\n+' + temp + '% \\tfor your seeding time';\r\n            }\r\n            // added divide by f_seeders(1) to get accurate % change from initial\r\n            temp = (100 * (f_seeders(seeders) / f_seeders(1) - 1)).toFixed(1);\r\n            if (temp !== '0.0') {\r\n                title += '\\n' + temp + '% \\tfor the number of seeders';\r\n            }\r\n            title += '\\n\\n¥ per ' + time_frame_string + ' \\t¥ per ' + time_frame_string + ' per GB\\t#seeders\\n';\r\n            var start = Math.max(seeders - 1, 3);\r\n            var end = Math.max(seeders + 1, 3);\r\n\r\n            // edited to <= 3, 2017.\r\n            for (var i = start; i <= end; i++) {\r\n                title += '¥' + f(size, i, duration).toPrecision(6) + '  \\t';\r\n                title += '¥' + (f(size, i, duration) / size).toPrecision(6) + ' \\t\\t';\r\n                if (i === 3) {\r\n                    title += '≤';\r\n                }\r\n                title += i;\r\n                if (i !== end) {\r\n                    title += '\\n';\r\n                }\r\n            }\r\n            return title;\r\n        }\r\n        // Toggle yen generation per time and per time and size\r\n        var yen_per_GB = false;\r\n        function toggle_yen(toggle) {\r\n            if (toggle === void 0) { toggle = true; }\r\n            return function () {\r\n                if (toggle) {\r\n                    yen_per_GB = yen_per_GB !== true;\r\n                }\r\n                var cells = document.querySelectorAll('th.UserScriptToggleYenPerGB,td.UserScriptToggleYenPerGB');\r\n                for (var i = 0, length = cells.length; i < length; i++) {\r\n                    var cell = cells[i];\r\n                    if (yen_per_GB) {\r\n                        cell.style.display = '';\r\n                    }\r\n                    else {\r\n                        cell.style.display = 'none';\r\n                    }\r\n                }\r\n                cells = document.querySelectorAll('th.UserScriptToggleYen,td.UserScriptToggleYen');\r\n                for (let i = 0, length = cells.length; i < length; i++) {\r\n                    let cell = cells[i];\r\n                    if (yen_per_GB) {\r\n                        cell.style.display = 'none';\r\n                    }\r\n                    else {\r\n                        cell.style.display = '';\r\n                    }\r\n                }\r\n            };\r\n        }\r\n        // Parses a single HTMLElement's textContent using regular expressions\r\n        function parse_cell(cell) {\r\n            var text_content = cell.textContent.trim();\r\n            var text_content_no_comma = text_content.replace(/,/g, '').trim();\r\n            var image = cell.querySelector('img');\r\n            if (cell.textContent === '' && (image !== null)) {\r\n                return image.alt.toUpperCase();\r\n            }\r\n            var match = text_content_no_comma.match(size_RegExp);\r\n            if (match !== null) {\r\n                return parseFloat(match[1]) * unit_prefix(match[2]);\r\n            }\r\n            match = text_content_no_comma.match(datetime_RegExp);\r\n            if (match !== null) {\r\n                return new Date(parseInt(match[1], 10), parseInt(match[2], 10) - 1, parseInt(match[3], 10), parseInt(match[4], 10), parseInt(match[5], 10));\r\n            }\r\n            match = text_content_no_comma.replace(and_RegExp, '').match(duration_RegExp);\r\n            if (match !== null) {\r\n                var durations = [];\r\n                // Starting at 1, because 0 is full string\r\n                for (var i = 1, length = match.length; i < length; i++) {\r\n                    var num = match[i];\r\n                    if (num !== undefined) {\r\n                        durations.push(parseInt(num, 10));\r\n                    }\r\n                    else {\r\n                        durations.push(0);\r\n                    }\r\n                }\r\n                // Calculates number of days inside the brackets, then times by 24.\r\n                // Returns hours.\r\n                //     24 * (years                            months                               wweeks            days      ) + hours           minutes               seconds\r\n                return 24 * (durations[0] * days_per_year + durations[1] * days_per_year / 12 + durations[2] * 7 + durations[3]) + durations[4] + durations[5] / 60 + durations[6] / 3600;\r\n            }\r\n            match = text_content_no_comma.match(currency_RegExp);\r\n            if (match !== null) {\r\n                return parseFloat(match[1]);\r\n            }\r\n            match = text_content_no_comma.match(ratio_RegExp);\r\n            if (match !== null) {\r\n                switch (match[1]) {\r\n                case '∞':\r\n                    return Infinity;\r\n                case '--':\r\n                    return -0.2;\r\n                case '0':\r\n                    return -0.1;\r\n                default:\r\n                    return parseFloat(match[1]);\r\n                }\r\n            }\r\n            if (/^Never(\\s*\\([^)]*\\)\\s*)*$/i.test(text_content_no_comma)) {\r\n                return 0;\r\n            }\r\n            else {\r\n                return text_content.toUpperCase();\r\n            }\r\n        }\r\n        // Processes a row and parses its cells' contents\r\n        function parse_row(row, size_index, seeders_index, duration_index, hr_index) {\r\n            var size_cell = get_cell(row, size_index);\r\n            var seeders_cell = get_cell(row, seeders_index);\r\n            var duration_cell = get_cell(row, duration_index);\r\n            var size = (size_index !== null && size_cell !== null) ? parse_cell(size_cell) : 1;\r\n            var seeders = (seeders_index !== null && seeders_cell !== null) ? parse_cell(seeders_cell) : 6;\r\n            var duration = (duration_index !== null && duration_cell !== null) ? parse_cell(duration_cell) : 0;\r\n            var torrent_row = get_corresponding_torrent_row(row);\r\n            // Add required time to size_cell and blockquote in torrent_row\r\n            if (size_index !== null && show_required_time) {\r\n                var seeding_time = Math.max(0, size - 10) * 5 + 72;\r\n                size_cell.title = 'You need to seed this torrent for at least\\n' + duration_to_string(seeding_time) + '\\nor it will become a hit and run!';\r\n                if (torrent_row !== null) {\r\n                    var block_quote = torrent_row.querySelector('blockquote');\r\n                    if (block_quote !== null) {\r\n                        block_quote.appendChild(document.createElement('br'));\r\n                        block_quote.innerHTML += 'You need to seed this torrent for at least <span class=\"r01\">' + duration_to_string(seeding_time) + '</span> or it will become a hit and run!';\r\n                    }\r\n                }\r\n            }\r\n            // Add yen generation to row\r\n            if (size_index !== null && seeders_index !== null && show_yen) {\r\n                _debug && console.log('adding yen to row: ' + row.innerHTML);\r\n                var title = yen_generation_title(size, seeders, duration);\r\n                var td1 = document.createElement('td');\r\n                td1.textContent = '¥' + yen_to_string(f(size, seeders, duration));\r\n                td1.title = title;\r\n                td1.className = 'UserScriptToggleYen';\r\n                var td2 = document.createElement('td');\r\n                td2.textContent = '¥' + yen_to_string(f(size, seeders, duration) / size);\r\n                td2.title = title;\r\n                td2.className = 'UserScriptToggleYenPerGB';\r\n                td2.style.display = 'none';\r\n                td1.addEventListener('click', toggle_yen());\r\n                td2.addEventListener('click', toggle_yen());\r\n                row.appendChild(td2);\r\n                row.appendChild(td1);\r\n            }\r\n            // Parse row data\r\n            var row_data = [row, torrent_row];\r\n            if (sort_rows) {\r\n                var cells = row.cells;\r\n                for (var i = 0, length = cells.length; i < length; i++) {\r\n                    var cell = cells[i];\r\n                    row_data.push(parse_cell(cell));\r\n                    if (cell.colSpan > 1) {\r\n                        for (var j = 2; j <= cell.colSpan; j++) {\r\n                            row_data.push(null);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            // Replace H&R row content by remaining seed time if available in duration row\r\n            if (hr_index !== null && duration_index !== null) {\r\n                let cell = get_cell(row, duration_index);\r\n                var match = cell.textContent.replace(/^[^(]*(\\(|$)/, '').replace(/\\s*left\\s*\\)[^)]*$/, '').replace(and_RegExp, '').match(duration_RegExp);\r\n                var remaining = 0.0.toFixed(4);\r\n                if (match !== null) {\r\n                    var durations = [];\r\n                    // Starting at 1 because 0 is full matched string\r\n                    for (let i = 1, length = match.length; i < length; i++) {\r\n                        var num = match[i];\r\n                        if (num !== undefined) {\r\n                            durations.push(parseInt(num, 10));\r\n                        }\r\n                        else {\r\n                            durations.push(0);\r\n                        }\r\n                    }\r\n                    remaining = (24 * (durations[0] * days_per_year + durations[1] * days_per_year / 12 + durations[2] * 7 + durations[3]) + durations[4] + durations[5] / 60 + durations[6] / 3600).toFixed(4);\r\n                }\r\n                while (remaining.length < 16) {\r\n                    remaining = '0' + remaining;\r\n                }\r\n                row_data[hr_index + 2] = remaining + row_data[hr_index + 2];\r\n            }\r\n            return row_data;\r\n        }\r\n        // Processes a table and parses its rows' contents\r\n        function parse_table(table) {\r\n            var size_index = null;\r\n            var seeders_index = null;\r\n            var duration_index = null;\r\n            var hr_index = null;\r\n            var headers = table.querySelector('tr');\r\n            var cells = headers.cells;\r\n            var column = 0;\r\n            for (var i = 0, length = cells.length; i < length; i++) {\r\n                var cell = cells[i];\r\n                //console.log(cell);\r\n\r\n                // Get rid of non-breakable spaces -.-\r\n                var text_content = cell.textContent.replace(/\\u00a0/g, ' ').trim().toLowerCase();\r\n                var title = cell.title.trim().toLowerCase();\r\n                //console.log(title);\r\n                if (size_index === null && (text_content === 'size' || title === 'size' || cell.querySelector('*[title=\"Size\"]') !== null)) {\r\n                    size_index = column;\r\n                }\r\n                if (seeders_index === null && (title === 'seeders' || cell.querySelector('*[title=\"Seeders\"]') !== null)) {\r\n                    seeders_index = column;\r\n                }\r\n                if (duration_index === null && (text_content === 'seeding time' || text_content === 'seed time')) {\r\n                    duration_index = column;\r\n                }\r\n                if (hr_index === null && text_content === 'h&r') {\r\n                    hr_index = column;\r\n                }\r\n                column += cell.colSpan;\r\n            }\r\n            if (size_index !== null && seeders_index !== null && show_yen) {\r\n                var td1 = document.createElement(headers.cells[0].nodeName);\r\n                td1.textContent = '¥/' + time_frame_string.charAt(0);\r\n                td1.title = '¥ per ' + time_frame_string;\r\n                td1.className = 'UserScriptToggleYen';\r\n                var td2 = document.createElement(headers.cells[0].nodeName);\r\n                td2.textContent = '¥/' + time_frame_string.charAt(0) + '/GB';\r\n                td2.title = '¥ per ' + time_frame_string + ' per GB';\r\n                td2.className = 'UserScriptToggleYenPerGB';\r\n                td2.style.display = 'none';\r\n                td1.addEventListener('click', toggle_yen());\r\n                td2.addEventListener('click', toggle_yen());\r\n                headers.appendChild(td2);\r\n                headers.appendChild(td1);\r\n                // Increase colSpan of non-torrent rows in the table\r\n                var non_torrents = table.querySelectorAll('tr.edition_info,tr.pad,tr[id^=\"group_\"]');\r\n                for (let i = 0, length = non_torrents.length; i < length; i++) {\r\n                    var non_torrent = non_torrents[i];\r\n                    var cells_1 = non_torrent.cells;\r\n                    var last_cell = cells_1[cells_1.length - 1];\r\n                    last_cell.colSpan += 1;\r\n                }\r\n            }\r\n            // Parse table data\r\n            var table_data = [];\r\n            var real_torrents = table.querySelectorAll('tr.torrent,tr.group_torrent');\r\n            for (let i = 0, length = real_torrents.length; i < length; i++) {\r\n                var row = real_torrents[i];\r\n                table_data.push(parse_row(row, size_index, seeders_index, duration_index, hr_index));\r\n            }\r\n            // Sorting...\r\n            var table_body = table_data[0][0].parentNode;\r\n            var sort_index = null;\r\n            var sort_descending = true;\r\n            function sort_function(index) {\r\n                return function (a, b) {\r\n                    if ((a[index + 2] !== null) && (b[index + 2] !== null)) {\r\n                        if (a[index + 2] > b[index + 2]) {\r\n                            return -1;\r\n                        }\r\n                        else if (a[index + 2] < b[index + 2]) {\r\n                            return 1;\r\n                        }\r\n                        else {\r\n                            return 0;\r\n                        }\r\n                    }\r\n                    else if ((a[index + 2] !== null) && (b[index + 2] === null)) {\r\n                        return -1;\r\n                    }\r\n                    else if ((b[index + 2] !== null) && (a[index + 2] === null)) {\r\n                        return 1;\r\n                    }\r\n                    else {\r\n                        return 0;\r\n                    }\r\n                };\r\n            }\r\n            function sort_by_index(index, toggle) {\r\n                if (toggle === void 0) { toggle = true; }\r\n                return function (event) {\r\n                    if (event !== null) {\r\n                        event.stopPropagation();\r\n                        event.preventDefault();\r\n                    }\r\n                    if (index !== null) {\r\n                        if (sort_index === index && toggle) {\r\n                            sort_descending = sort_descending !== true;\r\n                            table_data.reverse();\r\n                        }\r\n                        else {\r\n                            if (toggle) {\r\n                                sort_descending = true;\r\n                            }\r\n                            sort_index = index;\r\n                            table_data.sort(sort_function(index));\r\n                            if (!sort_descending) {\r\n                                table_data.reverse();\r\n                            }\r\n                        }\r\n                    }\r\n                    for (var i = 0, length = table_data.length; i < length; i++) {\r\n                        var row = table_data[i];\r\n                        var next_separator_element = get_next_separator_element_sibling(row[0]);\r\n                        if (next_separator_element !== null) {\r\n                            table_body.insertBefore(row[0], next_separator_element);\r\n                            if (row[1] !== null) {\r\n                                table_body.insertBefore(row[1], next_separator_element);\r\n                            }\r\n                        }\r\n                        else {\r\n                            table_body.appendChild(row[0]);\r\n                            if (row[1] !== null && row[0] !== row[1]) {\r\n                                table_body.appendChild(row[1]);\r\n                            }\r\n                        }\r\n                    }\r\n                };\r\n            }\r\n            if (sort_rows && table_data.length > 1) {\r\n                // Add * to headers which will trigger sort\r\n                for (let i = 0, length = cells.length; i < length; i++) {\r\n                    let cell = cells[i];\r\n                    var index = get_column(headers, cell);\r\n                    var a = document.createElement('a');\r\n                    a.href = '#';\r\n                    a.textContent = '*';\r\n                    a.addEventListener('click', sort_by_index(index));\r\n                    cell.appendChild(a);\r\n                }\r\n            }\r\n            function load_history_page(prev) {\r\n                if (prev === void 0) { prev = false; }\r\n                return function (event) {\r\n                    if (event !== null) {\r\n                        event.stopPropagation();\r\n                        event.preventDefault();\r\n                    }\r\n                    var new_page = prev ? previous_page-- : next_page++;\r\n                    if (new_page < 1 || new_page > last_page) {\r\n                        return;\r\n                    }\r\n                    // Remove links to dynamically load more pages if we've reached the end\r\n                    if (new_page === 1) {\r\n                        for (var i = 0, length = previous_anchors.length; i < length; i++) {\r\n                            var pagenum = previous_anchors[i];\r\n                            pagenum.parentNode.removeChild(pagenum);\r\n                        }\r\n                    }\r\n                    if (new_page === last_page) {\r\n                        for (let i = 0, length = next_anchors.length; i < length; i++) {\r\n                            let pagenum = next_anchors[i];\r\n                            pagenum.parentNode.removeChild(pagenum);\r\n                        }\r\n                    }\r\n                    var url = document.URL.split('#')[0];\r\n                    if (url.indexOf('page=') >= 0) {\r\n                        url = url.replace(/page=(\\d+)/i, 'page=' + new_page);\r\n                    }\r\n                    else {\r\n                        url = url + '&page=' + new_page;\r\n                    }\r\n                    var xhr = new XMLHttpRequest();\r\n                    xhr.open('GET', url, true);\r\n                    xhr.send();\r\n                    xhr.onreadystatechange = function () {\r\n                        if (xhr.readyState === 4) {\r\n                            var parser = new DOMParser();\r\n                            var new_document = parser.parseFromString(xhr.responseText, 'text/html');\r\n                            var new_torrents = new_document.querySelectorAll('tr.torrent,tr.group_torrent');\r\n                            for (var i = 0, length = new_torrents.length; i < length; i++) {\r\n                                var new_torrent = new_torrents[i];\r\n                                table_data.push(parse_row(new_torrent, size_index, seeders_index, duration_index, hr_index));\r\n                            }\r\n                            sort_by_index(sort_index, false)(null);\r\n                            toggle_yen(false)();\r\n                        }\r\n                    };\r\n                };\r\n            }\r\n            if (dynamic_load) {\r\n                var current_page_match = document.URL.match(/page=(\\d+)/i);\r\n                var current_page = current_page_match != null ? parseInt(current_page_match[1], 10) : 1;\r\n                var previous_page = current_page - 1;\r\n                var next_page = current_page + 1;\r\n                var last_page = Infinity;\r\n                var pagenums = [];\r\n                if (table.previousElementSibling !== null) {\r\n                    var pagenum = table.previousElementSibling.querySelector('div.pagenums');\r\n                    if (pagenum !== null) {\r\n                        pagenums.push(pagenum);\r\n                    }\r\n                }\r\n                if (table.nextElementSibling !== null) {\r\n                    let pagenum = table.nextElementSibling.querySelector('div.pagenums');\r\n                    if (pagenum !== null) {\r\n                        pagenums.push(pagenum);\r\n                    }\r\n                }\r\n                var previous_anchors = [];\r\n                var next_anchors = [];\r\n                // Loads the previous or next page into tableData, triggered by MouseEvent\r\n                for (let i = 0, length = pagenums.length; i < length; i++) {\r\n                    let pagenum = pagenums[i];\r\n                    // Figure out what the last page is\r\n                    var last_child = pagenum.lastElementChild;\r\n                    if (last_child !== null && last_child.href !== null) {\r\n                        var lastPageMatch = last_child.href.match(/page=(\\d+)/i);\r\n                        last_page = lastPageMatch !== null ? parseInt(lastPageMatch[1], 10) : 1;\r\n                    }\r\n                    else {\r\n                        last_page = parseInt(last_child.textContent.trim(), 10);\r\n                        if (isNaN(last_page)) {\r\n                            last_page = 1;\r\n                        }\r\n                    }\r\n                    var clone = pagenum.parentNode.cloneNode(true);\r\n                    var new_pagenum = clone.querySelector('div.pagenums');\r\n                    while (new_pagenum.hasChildNodes()) {\r\n                        new_pagenum.removeChild(new_pagenum.lastChild);\r\n                    }\r\n                    // Add buttons to dynamically load previous or next page\r\n                    if (current_page > 1) {\r\n                        let a = document.createElement('a');\r\n                        a.href = '#';\r\n                        a.className = 'next-prev';\r\n                        a.textContent = '← Load previous page dynamically';\r\n                        a.addEventListener('click', load_history_page(true), true);\r\n                        new_pagenum.appendChild(a);\r\n                        previous_anchors.push(a);\r\n                    }\r\n                    if (current_page < last_page) {\r\n                        let a = document.createElement('a');\r\n                        a.href = '#';\r\n                        a.className = 'next-prev';\r\n                        a.textContent = 'Load next page dynamically →';\r\n                        a.addEventListener('click', load_history_page(false), true);\r\n                        new_pagenum.appendChild(a);\r\n                        next_anchors.push(a);\r\n                    }\r\n                    // Insert new pagenum after old pagenum\r\n                    pagenum.parentNode.parentNode.insertBefore(clone, pagenum.parentNode.nextSibling);\r\n                }\r\n            }\r\n            // Function to filter torrent tables with deselected tags\r\n            function filter_torrent_table(filter_body) {\r\n                // Calculate deselected tags on demand\r\n                var deselected = {};\r\n                if (filter_body.hasChildNodes()) {\r\n                    var checkboxes = filter_body.firstElementChild.querySelectorAll('input[type=\"checkbox\"]');\r\n                    for (var i = 0, length = checkboxes.length; i < length; i++) {\r\n                        var checkbox = checkboxes[i];\r\n                        if (!checkbox.checked) {\r\n                            deselected[checkbox.value] = true;\r\n                        }\r\n                    }\r\n                }\r\n                // Create new form\r\n                var new_form = document.createElement('form');\r\n                // value = 0: all hidden, value = 1: at least one visible\r\n                var available_tags = {};\r\n                var values_by_column = [];\r\n                // Check if there are both options for these binary traits, and if so display, else ignore\r\n                var dual_audio = 0;\r\n                var freeleech = 0;\r\n                var remastered = 0;\r\n                for (let i = 0, length = real_torrents.length; i < length; i++) {\r\n                    var torrent = real_torrents[i];\r\n                    var is_freeleech = /freeleech/.test(torrent.className) || torrent.querySelector('img[alt=\"Freeleech!\"]') !== null;\r\n                    var is_remastered = torrent.querySelector('img[alt=\"Remastered\"]') !== null;\r\n                    var is_dual_audio = /Dual Audio/.test(torrent.cells[0].lastElementChild.textContent);\r\n                    dual_audio |= is_dual_audio ? 1 : 2;\r\n                    freeleech |= is_freeleech ? 1 : 2;\r\n                    remastered |= is_remastered ? 1 : 2;\r\n                }\r\n                for (let i = 0, length = real_torrents.length; i < length; i++) {\r\n                    let torrent = real_torrents[i];\r\n                    var corresponding = get_corresponding_torrent_row(torrent);\r\n                    let is_freeleech = /freeleech/.test(torrent.className) || torrent.querySelector('img[alt=\"Freeleech!\"]') !== null;\r\n                    let is_remastered = torrent.querySelector('img[alt=\"Remastered\"]') !== null;\r\n                    // Check for deselected tags in cleaned textContent of first cell\r\n                    var text = torrent.cells[0].lastElementChild.textContent;\r\n                    let is_dual_audio = /Dual Audio/i.test(text);\r\n                    // Remove » from beginning, format, Dual Audio, end empty tags (images, will handle them separately down below)\r\n                    text = text.replace(/^\\s*»/i, '').replace(/\\d+:\\d+/g, '').replace(/Dual Audio/ig, '').replace(/\\|(\\s*\\|)+/g, '|').replace(/^\\s*\\|/, '').replace(/\\|\\s*$/, '');\r\n                    // Split text content to get tags\r\n                    var torrent_tags = (text.indexOf('|') >= 0 ? text.split('|') : text.split('/')).map(function (e) { return e.trim(); });\r\n                    // Add Dual Audio, Freeleech, and Remastered status, only if torrents with yes and no are available\r\n                    if (dual_audio === 3) {\r\n                        torrent_tags.push(is_dual_audio ? 'Dual Audio' : 'No Dual Audio');\r\n                    }\r\n                    if (freeleech === 3) {\r\n                        torrent_tags.push(is_freeleech ? 'Freeleech' : 'No Freeleech');\r\n                    }\r\n                    if (remastered === 3) {\r\n                        torrent_tags.push(is_remastered ? 'Remastered' : 'Not Remastered');\r\n                    }\r\n                    // Keep track of tags and whether this element needs to be hidden\r\n                    var to_be_collapsed = false;\r\n                    for (var j = 0; j < torrent_tags.length; j++) {\r\n                        var tag = torrent_tags[j];\r\n                        if (deselected.hasOwnProperty(tag)) {\r\n                            to_be_collapsed = true;\r\n                            break;\r\n                        }\r\n                    }\r\n                    for (let j = 0; j < torrent_tags.length; j++) {\r\n                        let tag = torrent_tags[j];\r\n                        // Fucking ISOs...\r\n                        if (tag.indexOf('ISO') === 0) {\r\n                            torrent_tags.splice(j + 1, 0, '');\r\n                        }\r\n                        if (tag !== '') {\r\n                            if (!available_tags.hasOwnProperty(tag)) {\r\n                                available_tags[tag] = 0;\r\n                            }\r\n                            if (!to_be_collapsed) {\r\n                                available_tags[tag] = 1;\r\n                            }\r\n                            while (values_by_column.length <= j) {\r\n                                values_by_column.push({});\r\n                            }\r\n                            if (!values_by_column[j].hasOwnProperty(tag)) {\r\n                                values_by_column[j][tag] = 1;\r\n                            }\r\n                        }\r\n                    }\r\n                    // Hide or show torrent row and corresponding row if deselected tags are found\r\n                    if (to_be_collapsed) {\r\n                        torrent.style.display = 'none';\r\n                        if (corresponding !== null) {\r\n                            corresponding.style.display = 'none';\r\n                        }\r\n                    }\r\n                    else {\r\n                        torrent.style.display = '';\r\n                        if (corresponding !== null) {\r\n                            corresponding.style.display = '';\r\n                        }\r\n                    }\r\n                }\r\n                // If we found any tags or anything is deselected, create filter box\r\n                if (values_by_column.length > 0 || Object.keys(deselected).length > 0) {\r\n                    // Only show each tag once, even across multiple columns, so keep track\r\n                    var shown_values = {};\r\n                    for (let i = 0, length = values_by_column.length; i < length; i++) {\r\n                        var index = values_by_column[i];\r\n                        var sorted_tags = Object.keys(index).sort(function (a, b) {\r\n                            if (a.toUpperCase() > b.toUpperCase())\r\n                                return 1;\r\n                            else\r\n                                return -1;\r\n                        });\r\n                        for (let j = 0, len = sorted_tags.length; j < len; j++) {\r\n                            let tag = sorted_tags[j];\r\n                            if (shown_values.hasOwnProperty(tag)) {\r\n                                // Skip values we have already shown\r\n                                continue;\r\n                            }\r\n                            else {\r\n                                shown_values[tag] = 1;\r\n                            }\r\n                            var label = document.createElement('label');\r\n                            label.innerHTML = '<input type=\"checkbox\" ' + (deselected[tag] != null ? '' : 'checked=\"checked\"') + '> ' + tag;\r\n                            var input = label.querySelector('input');\r\n                            input.value = tag;\r\n                            label.style.marginRight = '1em';\r\n                            label.style.display = 'inline-block';\r\n                            // No visible torrents have this property, but it's also not deselected\r\n                            if (available_tags[tag] === 0 && !deselected.hasOwnProperty(tag)) {\r\n                                label.style.opacity = '0.25';\r\n                            }\r\n                            // Only one option, grey it out slightly\r\n                            if (sorted_tags.length <= 1) {\r\n                                label.style.opacity = '0.5';\r\n                            }\r\n                            new_form.appendChild(label);\r\n                        }\r\n                        new_form.appendChild(document.createElement('hr'));\r\n                    }\r\n                    // Remove excessive hr at end (where do they come from?)\r\n                    while (new_form.lastElementChild.tagName === 'HR') {\r\n                        new_form.removeChild(new_form.lastChild);\r\n                    }\r\n                    // With every change (all changes are checkbox changes), update deselected and filter anew\r\n                    new_form.addEventListener('change', function (e) {\r\n                        filter_torrent_table(filter_body);\r\n                    });\r\n                    // Replace old_form with new_form\r\n                    if (filter_body.hasChildNodes()) {\r\n                        filter_body.replaceChild(new_form, filter_body.firstElementChild);\r\n                    }\r\n                    else {\r\n                        filter_body.appendChild(new_form);\r\n                    }\r\n                }\r\n            }\r\n            function head_click_event(e) {\r\n                if (e !== null) {\r\n                    e.stopPropagation();\r\n                    e.preventDefault();\r\n                }\r\n                var span = head.querySelector('span');\r\n                if (body.style.display !== 'none') {\r\n                    body.style.display = 'none';\r\n                    span.className = 'triangle-right-md';\r\n                }\r\n                else {\r\n                    filter_torrent_table(body);\r\n                    body.style.display = '';\r\n                    span.className = 'triangle-down-md';\r\n                }\r\n            }\r\n            if (filter_torrents && real_torrents.length > 1) {\r\n                var box = document.createElement('div');\r\n                var head = document.createElement('div');\r\n                var body = document.createElement('div');\r\n                box.className = 'box torrent_filter_box';\r\n                head.className = 'head colhead strong';\r\n                body.className = 'body pad';\r\n                body.style.display = 'none';\r\n                head.innerHTML = '<a href=\"#\"><span class=\"triangle-right-md\"><span class=\"stext\">+/-</span></span> Filter </a>';\r\n                // Show or hide filter box\r\n                head.addEventListener('click', head_click_event);\r\n                box.appendChild(head);\r\n                box.appendChild(body);\r\n                table.parentNode.insertBefore(box, table);\r\n            }\r\n        }\r\n        // Process and parse all tables\r\n        if (show_yen || show_required_time || sort_rows || dynamic_load || filter_torrents) {\r\n            var all_torrent_tables = document.querySelectorAll('table.torrent_table,table.torrent_group');\r\n            for (var i = 0, length = all_torrent_tables.length; i < length; i++) {\r\n                var table = all_torrent_tables[i];\r\n                parse_table(table);\r\n            }\r\n        }\r\n\r\n        // If yen should be shown and user creation is not yet saved, try to get and save it\r\n        if (show_yen && (GM_getValue('creation', '0').toString() === '0' || GM_getValue('creation', '0') === 'null')) {\r\n\r\n\r\n            // no longer works because header profile link uses username.\r\n            //var user_id = document.querySelector('div#header div#userinfo li#username_menu a.username');\r\n\r\n            // checks if the current page's URL matches the profile page\r\n            // of the logged in user.\r\n            // var user_id_re = new RegExp('/user\\\\.php\\\\?id=' + CURRENT_USER[\"userId\"]);\r\n            //console.log(CURRENT_USER[\"userId\"]);\r\n            //console.log();\r\n            //if (document.URL.match(user_id_re) !== null) {\r\n\r\n            // ^ broken on some browsers if CURRENT_USER isn't passed.\r\n\r\n            // checks if the username link in navbar is the same as the current heading.\r\n            // if it is, we are on a profile page.\r\n            // hopefully no edge cases\r\n            // - TFM 2017-12-28\r\n            var user_link = document.querySelector('div#header div#userinfo li#username_menu a.username');\r\n            var user_heading = document.querySelector('div#content h2 a');\r\n            var user_profile_re = /\\/user\\.php\\?id=/i;\r\n\r\n            if (document.URL.match(user_profile_re) !== null && user_link !== null && user_heading !== null && user_link.href === user_heading.href) {\r\n\r\n                var user_stats = document.querySelector('div#content div#user_rightcol div.userstatsleft dl.userprofile_list');\r\n                var children = user_stats.children;\r\n                //console.log(children);\r\n                for (let i = 0, length = children.length; i < length; i++) {\r\n\r\n                    var child = children[i];\r\n                    //console.log(child);\r\n                    if (child.textContent.indexOf(\"Join\") !== -1) {\r\n                        try {\r\n                            var join_date = child.nextElementSibling.firstElementChild.title;\r\n\r\n                            // deletes timezone because it was causing issues with Date.parse()\r\n                            // worst case is +/- 12 hours anyway\r\n                            var timezone_re = /( \\d\\d:\\d\\d) [A-Z]+$/;\r\n                            GM_setValue('creation', JSON.stringify(Date.parse(join_date.replace(timezone_re, '$1'))));\r\n                        }\r\n                        catch (error) { console.error(error);}\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }).call(this);\r\n    /* End src/ab_enhanced_torrent_view.user.js */\r\n\r\n\r\n    /* Begin src/ab_fl_status.user.js */\r\n    // ==UserScript==\r\n    // @name        AB - Freeleech Pool Status\r\n    // @author      Megure (inspired by Lemma, Alpha, NSC)\r\n    // @description Shows current freeleech pool status in navbar with a pie-chart\r\n    // @include     https://animebytes.tv/*\r\n    // @version     0.1.1.2\r\n    // @icon        http://animebytes.tv/favicon.ico\r\n    // @grant       GM_getValue\r\n    // @grant       GM_setValue\r\n    // @require     https://github.com/momentary0/AB-Userscripts/raw/master/delicious-library/src/ab_delicious_library.js\r\n    // ==/UserScript==\r\n\r\n    // Freeleech Pool Status by Megure, inspired by Lemma, Alpha, NSC\r\n    // Shows current freeleech pool status in navbar with a pie-chart\r\n    // Updates only once every hour or when pool site is visited, showing a pie-chart on pool site\r\n    (function ABFLStatus() {\r\n        delicious.settings._migrateStringSetting('deliciousflpoolposition');\r\n\r\n        delicious.settings.init('deliciousflpoolposition', 'after #userinfo_minor');\r\n        delicious.settings.init('deliciousfreeleechpool', true);\r\n        delicious.settings.init('deliciousnavbarpiechart', true);\r\n        var pieLocations = delicious.settings.init('deliciousflpiepositions', {\r\n            'navbar': delicious.settings.get('deliciousnavbarpiechart'),\r\n            'profile': delicious.settings.get('deliciousnavbarpiechart')\r\n        });\r\n\r\n        if (delicious.settings.ensureSettingsInserted()) {\r\n            var section = delicious.settings.createCollapsibleSection('Delicious Freeleech Pool');\r\n            var s = section.querySelector('.settings_section_body');\r\n            s.appendChild(delicious.settings.createCheckbox(\r\n                'deliciousfreeleechpool',\r\n                'Enable/Disable',\r\n                'Shows current freeleech pool progress in the navbar and on user pages'\r\n                + ' (updated once an hour or when freeleech pool site is visited).'));\r\n            s.appendChild(delicious.settings.createDropDown(\r\n                'deliciousflpoolposition',\r\n                'Navbar Position',\r\n                'Select position of freeleech pool progress in the navbar or disable it.',\r\n                [['Before user info', 'before #userinfo_minor'],\r\n                    ['After user info', 'after #userinfo_minor'],\r\n                    ['Before menu', 'before .main-menu.nobullet'],\r\n                    ['After menu', 'after .main-menu.nobullet'],\r\n                    ['Don\\'t display', 'none']],\r\n                {default: 'after #userinfo_minor'}\r\n            ));\r\n            s.appendChild(delicious.settings.createFieldSetSetting(\r\n                'deliciousflpiepositions',\r\n                'FL Pie Chart Locations',\r\n                [['Navbar dropdown', 'navbar'], ['User profile', 'profile']]\r\n            ));\r\n            delicious.settings.insertSection(section);\r\n        }\r\n\r\n        if (!delicious.settings.get('deliciousfreeleechpool'))\r\n            return;\r\n\r\n        function niceNumber(num) {\r\n            var res = '';\r\n            while (num >= 1000) {\r\n                res = ',' + ('00' + (num % 1000)).slice(-3) + res;\r\n                num = Math.floor(num / 1000);\r\n            }\r\n            return num + res;\r\n        }\r\n        var locked = false;\r\n        function getFLInfo() {\r\n            function parseFLInfo(elem) {\r\n                var boxes = elem.querySelectorAll('#content .box.pad');\r\n                //console.log(boxes);\r\n                if (boxes.length < 3) return;\r\n\r\n                // The first box holds the current amount, the max amount and the user's individual all-time contribution\r\n                var match = boxes[0].textContent.match(/have ¥([0-9,]+) \\/ ¥([0-9,]+)/i),\r\n                    max = parseInt(GM_getValue('FLPoolMax', '50000000'), 10),\r\n                    current = parseInt(GM_getValue('FLPoolCurrent', '0'), 10);\r\n                if (match == null) {\r\n                    // Updated 2018-02-23 according to oregano's suggestion\r\n                    match = boxes[0].textContent.match(/You must wait for freeleech to be over before donating/i);\r\n                    if (match != null) current = max;\r\n                }\r\n                else {\r\n                    current = parseInt(match[1].replace(/,/g, ''), 10);\r\n                    max = parseInt(match[2].replace(/,/g, ''), 10);\r\n                }\r\n                if (match != null) {\r\n                    GM_setValue('FLPoolCurrent', current);\r\n                    GM_setValue('FLPoolMax', max);\r\n                }\r\n                // Check first box for user's individual all-time contribution\r\n                match = boxes[0].textContent.match(/you've donated ¥([0-9,]+)/i);\r\n                if (match != null)\r\n                    GM_setValue('FLPoolContribution', parseInt(match[1].replace(/,/g, ''), 10));\r\n\r\n                // The third box holds the top 10 donators for the current box\r\n                var box = boxes[2],\r\n                    tr = box.querySelector('table').querySelectorAll('tbody > tr');\r\n\r\n                var titles = [], hrefs = [], amounts = [], colors = [], sum = 0;\r\n                for (var i = 0; i < tr.length; i++) {\r\n                    var el = tr[i],\r\n                        td = el.querySelectorAll('td');\r\n\r\n                    titles[i] = td[0].textContent;\r\n                    hrefs[i] = td[0].querySelector('a').href;\r\n                    amounts[i] = parseInt(td[1].textContent.replace(/[,¥]/g, ''), 10);\r\n                    colors[i] = 'red';\r\n                    sum += amounts[i];\r\n                }\r\n\r\n                // Updated 2018-02-23. Properly draw full pie when FL active.\r\n                if (current === max && sum === 0) {\r\n                    titles[0] = \"Freeleech!\";\r\n                    hrefs[0] = 'https://animebytes.tv/konbini/pool';\r\n                    amounts[0] = current;\r\n                    colors[0] = 'red';\r\n                    sum = current;\r\n                }\r\n                else {\r\n                    // Also add others and missing to the arrays\r\n                    // 2018-02-23 But only if FL isn't active.\r\n                    var next_index = titles.length;\r\n                    titles[next_index] = 'Other';\r\n                    hrefs[next_index] = 'https://animebytes.tv/konbini/pool';\r\n                    amounts[next_index] = current - sum;\r\n                    colors[next_index] = 'lightgrey';\r\n\r\n                    titles[next_index + 1] = 'Missing';\r\n                    hrefs[next_index + 1] = 'https://animebytes.tv/konbini/pool';\r\n                    amounts[next_index + 1] = max - current;\r\n                    colors[next_index + 1] = 'black';\r\n                }\r\n\r\n                GM_setValue('FLPoolLastUpdate', Date.now());\r\n                GM_setValue('FLPoolTitles', JSON.stringify(titles));\r\n                GM_setValue('FLPoolHrefs', JSON.stringify(hrefs));\r\n                GM_setValue('FLPoolAmounts', JSON.stringify(amounts));\r\n                GM_setValue('FLPoolColors', JSON.stringify(colors));\r\n            }\r\n\r\n            // Either parse document or retrieve freeleech pool site 60*60*1000 ms after last retrieval\r\n            if (/konbini\\/pool$/i.test(document.URL))\r\n                parseFLInfo(document);\r\n            else if (Date.now() - parseInt(GM_getValue('FLPoolLastUpdate', '0'), 10) > 3600000 && locked === false) {\r\n                locked = true;\r\n                // Fix suggested by https://animebytes.tv/user/profile/oregano\r\n                // https://discourse.mozilla.org/t/webextension-xmlhttprequest-issues-no-cookies-or-referrer-solved/11224/18\r\n                try {\r\n                    var xhr = XPCNativeWrapper(new window.wrappedJSObject.XMLHttpRequest());\r\n                } catch (exc) {\r\n                    xhr = new XMLHttpRequest();\r\n                }\r\n                var parser = new DOMParser();\r\n                xhr.open('GET', \"https://animebytes.tv/konbini/pool\", true);\r\n                xhr.send();\r\n                xhr.onreadystatechange = function () {\r\n                    if (xhr.readyState === 4) {\r\n                        parseFLInfo(parser.parseFromString(xhr.responseText, 'text/html'));\r\n                        updatePieChart();\r\n                        locked = false;\r\n                    }\r\n                };\r\n            }\r\n        }\r\n\r\n        function getPieChart() {\r\n            function circlePart(diff, title, href, color) {\r\n                if (diff == 0) return '';\r\n                var x = Math.sin(phi), y = Math.cos(phi);\r\n                phi -= 2 * Math.PI * diff / max;\r\n                var v = Math.sin(phi), w = Math.cos(phi);\r\n                var z = 0;\r\n                if (2 * diff > max)\r\n                    z = 1; // use long arc\r\n                var perc = (100 * diff / max).toFixed(1) + '%\\n' + niceNumber(diff) + ' ¥';\r\n\r\n                // 2018-02-23 Hardcoded since rounding errors were making the pie a thin strip when it was a single\r\n                // slice at 100%.\r\n                if (diff === max) {\r\n                    /*v = -6.283185273215512e-8;\r\n                    w = -0.999999999999998;\r\n                    z = 1;\r\n                    x = 1.2246467991473532e-16;\r\n                    y = -1;*/\r\n                    v = -0.000001;\r\n                    w = -1;\r\n                    z = 1;\r\n                    x = 0;\r\n                    y = -1;\r\n\r\n                }\r\n                return '<a xlink:href=\"' + href + '\" xlink:title=\"' + title + '\\n' + perc + '\"><path title=\"' + title + '\\n' + perc +\r\n                    '\" stroke-width=\"0.01\" stroke=\"grey\" fill=\"' + color + '\" d=\"M0,0 L' + v + ',' + w + ' A1,1 0 ' + z + ',0 ' + x + ',' + y + 'z\">\\n' +\r\n\r\n                    '<animate begin=\"mouseover\" attributeName=\"d\" to=\"M0,0 L' + 1.1 * v + ',' + 1.1 * w + ' A1.1,1.1 0 ' + z + ',0 ' + 1.1 * x + ',' + 1.1 * y + 'z\" dur=\"0.3s\" fill=\"freeze\" />\\n' +\r\n                    '<animate begin=\"mouseout\"  attributeName=\"d\" to=\"M0,0 L' + v + ',' + w + ' A1,1 0 ' + z + ',0 ' + x + ',' + y + 'z\" dur=\"0.3s\" fill=\"freeze\" />\\n' +\r\n                    '</path></a>\\n\\n';\r\n            }\r\n\r\n            var str = '<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"-1.11 -1.11 2.22 2.22\" height=\"200px\" width=\"100%\">' +\r\n                '<title>Most Donated To This Box Pie-Chart</title>';\r\n            try {\r\n                var phi = Math.PI, max = parseInt(GM_getValue('FLPoolMax', '50000000'), 10),\r\n                    titles = JSON.parse(GM_getValue('FLPoolTitles', '[]')),\r\n                    hrefs = JSON.parse(GM_getValue('FLPoolHrefs', '[]')),\r\n                    amounts = JSON.parse(GM_getValue('FLPoolAmounts', '[]')),\r\n                    colors = JSON.parse(GM_getValue('FLPoolColors', '[]'));\r\n                for (var i = 0; i < titles.length; i++) {\r\n                    str += circlePart(amounts[i], titles[i], hrefs[i], colors[i]);\r\n                }\r\n            } catch (e) {console.error(e); }\r\n            return str + '</svg>';\r\n        }\r\n\r\n        function updatePieChart() {\r\n            var pieChart = getPieChart();\r\n            p.innerHTML = pieChart;\r\n            p3.innerHTML = pieChart;\r\n            if (pieLocations['navbar']) {\r\n                li.innerHTML = pieChart;\r\n            }\r\n            p2.innerHTML = 'We currently have ¥' + niceNumber(parseInt(GM_getValue('FLPoolCurrent', '0'), 10)) + ' / ¥' + niceNumber(parseInt(GM_getValue('FLPoolMax', '50000000'), 10)) + ' in our donation box.<br/>';\r\n            p2.innerHTML += '(That means we\\'re ¥' + niceNumber(parseInt(GM_getValue('FLPoolMax', '50000000'), 10) - parseInt(GM_getValue('FLPoolCurrent', '0'), 10)) + ' away from getting sitewide freeleech!)<br/>';\r\n            p2.innerHTML += '<br>In total, you\\'ve donated ¥' + niceNumber(parseInt(GM_getValue('FLPoolContribution', '0'), 10)) + ' to the freeleech pool.<br/>';\r\n            p2.innerHTML += 'Last Update: ' + Math.round((Date.now() - parseInt(GM_getValue('FLPoolLastUpdate', Date.now()), 10)) / 60000) + ' minutes ago.';\r\n            a.textContent = 'FL: ' + (100 * parseInt(GM_getValue('FLPoolCurrent', '0'), 10) / parseInt(GM_getValue('FLPoolMax', '50000000'), 10)).toFixed(1) + '%';\r\n            nav.replaceChild(a, nav.firstChild);\r\n        }\r\n\r\n        var pos = delicious.settings.get('deliciousflpoolposition');\r\n\r\n        // // prevents global click handler from immediately closing the menu\r\n        // event.stopPropagation();\r\n        // return false;\r\n\r\n        if (pos !== 'none' || /user\\.php\\?id=/i.test(document.URL) || /konbini\\/pool/i.test(document.URL)) {\r\n            var p = document.createElement('p'),\r\n                p2 = document.createElement('center'),\r\n                p3 = document.createElement('p'),\r\n                nav = document.createElement('li'),\r\n                a = document.createElement('a'),\r\n                ul = document.createElement('ul'),\r\n                li = document.createElement('li');\r\n            a.href = '/konbini/pool';\r\n            nav.appendChild(a);\r\n            if (pieLocations['navbar']) {\r\n                var outerSpan = document.createElement('span');\r\n                outerSpan.className += \"dropit hover clickmenu\";\r\n                outerSpan.addEventListener('click', delicious.utilities.toggleSubnav);\r\n                outerSpan.innerHTML += '<span class=\"stext\">▼</span>';\r\n\r\n                // nav is the li.navmenu\r\n                nav.appendChild(outerSpan);\r\n\r\n                // this ul contains the pie (somehow)\r\n                ul.appendChild(li);\r\n                ul.className = 'subnav nobullet';\r\n                ul.style.display = 'none';\r\n                nav.appendChild(ul);\r\n                nav.className = 'navmenu';\r\n                nav.id = \"fl_menu\";\r\n            }\r\n            if (pos !== 'none') {\r\n                pos = pos.split(' ');\r\n                var parent = document.querySelector(pos[1]);\r\n                if (parent !== null) {\r\n                    getFLInfo();\r\n                    if (pos[0] === 'after')\r\n                        parent.appendChild(nav);\r\n                    if (pos[0] === 'before')\r\n                        parent.insertBefore(nav, parent.firstChild);\r\n                }\r\n            }\r\n\r\n            updatePieChart();\r\n\r\n            if (pieLocations['profile'] && /user\\.php\\?id=/i.test(document.URL)) {\r\n                var userstats = document.querySelector('#user_rightcol > .box');\r\n                if (userstats != null) {\r\n                    var tw = document.createTreeWalker(userstats, NodeFilter.SHOW_TEXT, { acceptNode: function (node) { return /Yen per day/i.test(node.data); } });\r\n                    if (tw.nextNode() != null) {\r\n                        getFLInfo();\r\n                        var cNode = document.querySelector('.userstatsleft');\r\n                        var hr = document.createElement('hr');\r\n                        hr.style.clear = 'both';\r\n                        cNode.insertBefore(hr, cNode.lastElementChild);\r\n                        cNode.insertBefore(p2, cNode.lastElementChild);\r\n                        cNode.insertBefore(p3, cNode.lastElementChild);\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (/konbini\\/pool/i.test(document.URL)) {\r\n                let tw = document.createTreeWalker(document.getElementById('content'), NodeFilter.SHOW_TEXT, { acceptNode: function (node) { return /^\\s*Most Donated to This Box\\s*$/i.test(node.data); } });\r\n                if (tw.nextNode() !== null) {\r\n                    tw.currentNode.parentNode.insertBefore(p, tw.currentNode.nextSibling);\r\n                }\r\n            }\r\n        }\r\n    })();\r\n    /* End src/ab_fl_status.user.js */\r\n\r\n\r\n    /* Begin src/ab_forum_search_enhancement.user.js */\r\n    // ==UserScript==\r\n    // @name        AnimeBytes - Forum Search - Enhancement\r\n    // @namespace   Megure@AnimeBytes.tv\r\n    // @description Load posts into search results; highlight search terms; filter authors; slide through posts\r\n    // @include     http*://animebytes.tv/forums.php*\r\n    // @exclude     *action=viewthread*\r\n    // @version     0.72.2\r\n    // @grant       GM_getValue\r\n    // @grant       GM_setValue\r\n    // @icon        http://animebytes.tv/favicon.ico\r\n    // @require     https://github.com/momentary0/AB-Userscripts/raw/master/delicious-library/src/ab_delicious_library.js\r\n    // ==/UserScript==\r\n\r\n    //import '../delicious-library/src/ab_delicious_library'\r\n\r\n    (function ForumSearchEnhancement() {\r\n        delicious.settings.init('ABForumSearchWorkInFS', true);\r\n        delicious.settings.init('ABForumSearchWorkInRest', true);\r\n\r\n        var textSettings = ['ABForumSearchHighlightBG', 'ABForumSearchHighlightFG',\r\n            'ABForumLoadText', 'ABForumLoadingText', 'ABForumToggleText'];\r\n        for (var k = 0; k < textSettings.length; k++) {\r\n            delicious.settings._migrateStringSetting(textSettings[k]);\r\n        }\r\n\r\n        if (delicious.settings.get('ABForumSearchHighlightBG') === 'none')\r\n            delicious.settings.set('ABForumSearchHighlightBG', null);\r\n        if (delicious.settings.get('ABForumSearchHighlightFG') === 'none')\r\n            delicious.settings.set('ABForumSearchHighlightFG', null);\r\n\r\n        if (delicious.settings.ensureSettingsInserted()) {\r\n            var section = delicious.settings.createCollapsibleSection('Forum Search Enhancements');\r\n            var s = section.querySelector('.settings_section_body');\r\n            s.appendChild(delicious.settings.createCheckbox(\r\n                'ABForumSearchWorkInFS',\r\n                'Load posts into search results',\r\n                'Allows you to load posts and threads into search results, slide through posts and filter for authors.'\r\n            ));\r\n\r\n            s.appendChild(delicious.settings.createColourSetting('ABForumSearchHighlightBG',\r\n                'Color for search terms', 'Background color for search terms within posts and headers.',\r\n                {default: '#FFC000'}));\r\n            s.appendChild(delicious.settings.createColourSetting('ABForumSearchHighlightFG',\r\n                'Color for search terms', 'Text color for search terms within posts and headers.',\r\n                {default: '#000000'}));\r\n\r\n            s.appendChild(delicious.settings.createCheckbox('ABForumEnhWorkInRest',\r\n                'Load posts into forum view', 'Allows you to load posts and threads into the general forum view.',\r\n                {default: false}));\r\n            s.appendChild(delicious.settings.createTextSetting('ABForumLoadText',\r\n                'Text for links to be loaded', 'The text to be shown for forum links that have not been loaded yet.',\r\n                {default: '(Load) ', width: '8em'}));\r\n            s.appendChild(delicious.settings.createTextSetting('ABForumLoadingText', 'Text for loading links',\r\n                'The text to be shown for forum links that are currently being loaded.',\r\n                {default: '(Loading) ', width: '8em'}));\r\n            s.appendChild(delicious.settings.createTextSetting('ABForumToggleText', 'Text for loaded links',\r\n                'The text to be shown for forum links that have been loaded and can now be toggled.',\r\n                {default: '(Toggle) ', width: '8em'}));\r\n\r\n            delicious.settings.insertSection(section);\r\n        }\r\n\r\n        if (!( (/^http.*:\\/\\/animebytes\\.tv\\/forums\\.php/i.test(document.URL))\r\n            && !/action=viewthread/i.test(document.URL) ))\r\n            return;\r\n\r\n\r\n        var a, allResults, background_color, button, cb, filterPost, forumIds, forumid, getFirstTagParent, hideSubSelection, i, j, input, len, linkbox1, loadPost, loadText, loadThreadPage, loadingText, myCell, myLINK, newCheckbox, newLinkBox, patt, processThreadPage, quickLink, quickLinkSubs, result, sR, searchForums, searchForumsCB, searchForumsNew, showFastSearchLinks, showPost, strong, tP, textReplace, text_color, toggleText, toggleVisibility, user_filter, user_td, user_tr, workInForumSearch, workInRestOfForum;\r\n\r\n        background_color = delicious.settings.get('ABForumSearchHighlightBG', '#FFC000');\r\n\r\n        text_color = delicious.settings.get('ABForumSearchHighlightFG', '#000000');\r\n\r\n        toggleText = delicious.settings.get('ABForumToggleText', '(Toggle) ');\r\n\r\n        loadText = delicious.settings.get('ABForumLoadText', '(Load) ');\r\n\r\n        loadingText = delicious.settings.get('ABForumLoadingText', '(Loading) ');\r\n\r\n        hideSubSelection = delicious.settings.get('ABForumSearchHideSubfor', true);\r\n\r\n        workInForumSearch = delicious.settings.get('ABForumSearchWorkInFS', true) && document.URL.indexOf('action=search') >= 0;\r\n\r\n        workInRestOfForum = delicious.settings.get('ABForumEnhWorkInRest', false) && (document.URL.indexOf('action=viewforum') >= 0 || document.URL.indexOf('?') === -1);\r\n\r\n        showFastSearchLinks = delicious.settings.get('ABForumEnhFastSearch', true) && document.URL.indexOf('action=viewforum') >= 0;\r\n\r\n        user_filter = [];\r\n\r\n        sR = [];\r\n\r\n        tP = [];\r\n\r\n        cb = [];\r\n\r\n        getFirstTagParent = function (elem, tag) {\r\n            while (elem !== null && elem.tagName !== 'BODY' && elem.tagName !== tag) {\r\n                elem = elem.parentNode;\r\n            }\r\n            if (elem === null || elem.tagName !== tag) {\r\n                return null;\r\n            } else {\r\n                return elem;\r\n            }\r\n        };\r\n\r\n        textReplace = function (elem) {\r\n            var node, regExp, walk;\r\n            if (patt !== '' && (background_color !== 'none' || text_color !== 'none')) {\r\n                walk = document.createTreeWalker(elem, NodeFilter.SHOW_TEXT, null, false);\r\n                node = walk.nextNode();\r\n                regExp = new RegExp('(' + patt + ')', 'i');\r\n                while (node != null) {\r\n                    node.textContent.replace(regExp, function (term) {\r\n                        var args, newSpan, newTextNode, offset;\r\n                        args = [].slice.call(arguments);\r\n                        offset = args[args.length - 2];\r\n                        newTextNode = node.splitText(offset);\r\n                        newTextNode.textContent = newTextNode.textContent.substr(term.length);\r\n                        newSpan = document.createElement('span');\r\n                        if (background_color !== 'none') {\r\n                            newSpan.style.backgroundColor = background_color;\r\n                        }\r\n                        if (text_color !== 'none') {\r\n                            newSpan.style.color = text_color;\r\n                        }\r\n                        newSpan.appendChild(document.createTextNode(term));\r\n                        node.parentNode.insertBefore(newSpan, newTextNode);\r\n                        return node = walk.nextNode();\r\n                    });\r\n                    node = walk.nextNode();\r\n                }\r\n            }\r\n        };\r\n\r\n        processThreadPage = function (id, threadid, page, parent, link) {\r\n            return function () {\r\n                var _i, cell, i, j, len, len1, linkbox, myColsp, nextPost, pagenums, post, prevPost, ref, ref1, td, threadPage, tr, user_id;\r\n                threadPage = \"threadid=\" + threadid + \"&page=\" + page;\r\n                link.textContent = toggleText;\r\n                sR[id] = [];\r\n                sR[id].parent = parent;\r\n                sR[id].index = 0;\r\n                sR[id].page = page;\r\n                sR[id].threadid = threadid;\r\n                ref = tP[threadPage];\r\n                for (_i = i = 0, len = ref.length; i < len; _i = ++i) {\r\n                    post = ref[_i];\r\n                    if (post.id === id) {\r\n                        sR[id].index = _i;\r\n                    }\r\n                }\r\n                user_id = tP[threadPage][sR[id].index].className.split('_');\r\n                user_id = user_id[user_id.length - 1];\r\n                // It looks lke sR is the search results, and tP is a thread page.\r\n                // This line gets the username from the author's profile link.\r\n                sR[id].user = tP[threadPage][sR[id].index].querySelector('.num_author > a[href^=\"/user\"]').textContent;\r\n                linkbox = document.createElement('div');\r\n                pagenums = document.createElement('div');\r\n                linkbox.className = 'linkbox';\r\n                pagenums.className = 'pagenums';\r\n                prevPost = document.createElement('a');\r\n                nextPost = document.createElement('a');\r\n                prevPost.href = '#';\r\n                nextPost.href = '#';\r\n                prevPost.className = 'page-link';\r\n                nextPost.className = 'page-link';\r\n                prevPost.textContent = '← Prev';\r\n                nextPost.textContent = 'Next →';\r\n                pagenums.appendChild(prevPost);\r\n                pagenums.appendChild(nextPost);\r\n                linkbox.appendChild(pagenums);\r\n                prevPost.addEventListener('click', showPost(id, true), true);\r\n                nextPost.addEventListener('click', showPost(id, false), true);\r\n                tr = document.createElement('tr');\r\n                td = document.createElement('td');\r\n                myColsp = 0;\r\n                ref1 = parent.cells;\r\n                for (j = 0, len1 = ref1.length; j < len1; j++) {\r\n                    cell = ref1[j];\r\n                    myColsp += cell.colSpan;\r\n                }\r\n                td.colSpan = myColsp;\r\n                td.appendChild(linkbox);\r\n                td.appendChild(tP[threadPage][sR[id].index]);\r\n                tr.appendChild(td);\r\n                sR[id].td = td;\r\n                sR[id].parent.parentNode.insertBefore(tr, sR[id].parent.nextSibling);\r\n            };\r\n        };\r\n\r\n        loadThreadPage = function (threadid, page) {\r\n            var threadPage, xhr;\r\n            threadPage = \"threadid=\" + threadid + \"&page=\" + page;\r\n            tP[threadPage] = 'Loading';\r\n            cb[threadPage] = [];\r\n            xhr = new XMLHttpRequest();\r\n            xhr.open('GET', \"https://animebytes.tv/forums.php?action=viewthread&\" + threadPage, true);\r\n            xhr.send();\r\n            xhr.onreadystatechange = function () {\r\n                var callback, i, j, len, len1, parser, post, ref, ref1;\r\n                if (xhr.readyState === 4) {\r\n                    parser = new DOMParser();\r\n                    tP[threadPage] = (parser.parseFromString(xhr.responseText, 'text/html')).querySelectorAll('div[id^=\"post\"]');\r\n                    ref = tP[threadPage];\r\n                    for (i = 0, len = ref.length; i < len; i++) {\r\n                        post = ref[i];\r\n                        textReplace(post);\r\n                    }\r\n                    ref1 = cb[threadPage];\r\n                    for (j = 0, len1 = ref1.length; j < len1; j++) {\r\n                        callback = ref1[j];\r\n                        callback();\r\n                    }\r\n                    return delete cb[threadPage];\r\n                }\r\n            };\r\n        };\r\n\r\n        loadPost = function (link, index, filtered) {\r\n            return function (event) {\r\n                var cell, id, match, newLink, node, page, threadPage, threadid;\r\n                if (event != null) {\r\n                    event.stopPropagation();\r\n                    event.preventDefault();\r\n                }\r\n                newLink = link.previousSibling;\r\n                cell = link.parentNode;\r\n                node = getFirstTagParent(link, 'TR');\r\n                threadid = link.href.match(/threadid=(\\d+)/i);\r\n                threadid = threadid != null ? threadid[1] : '0';\r\n                match = link.href.match(/([^#]*)(?:#post(\\d+))?/i);\r\n                if (match != null) {\r\n                    id = match[2] != null ? 'post' + match[2] : id = index + link.href;\r\n                } else {\r\n                    return;\r\n                }\r\n                if (id in sR) {\r\n                    if (filtered === true) {\r\n                        filterPost(id)();\r\n                    } else {\r\n                        toggleVisibility(id);\r\n                    }\r\n                } else {\r\n                    page = link.href.match(/page=(\\d+)/i);\r\n                    page = page != null ? parseInt(page[1], 10) : 1;\r\n                    link.previousSibling.textContent = loadingText;\r\n                    threadPage = \"threadid=\" + threadid + \"&page=\" + page;\r\n                    if (threadPage in tP) {\r\n                        if (tP[threadPage] === 'Loading') {\r\n                            cb[threadPage].push(processThreadPage(id, threadid, page, node, newLink));\r\n                            if (filtered === true) {\r\n                                cb[threadPage].push(filterPost(id));\r\n                            }\r\n                        } else {\r\n                            processThreadPage(id, threadid, page, node, newLink)();\r\n                            if (filtered === true) {\r\n                                filterPost(id)();\r\n                            }\r\n                        }\r\n                    } else {\r\n                        loadThreadPage(threadid, page);\r\n                        cb[threadPage].push(processThreadPage(id, threadid, page, node, newLink));\r\n                        if (filtered === true) {\r\n                            cb[threadPage].push(filterPost(id));\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n        };\r\n\r\n        toggleVisibility = function (id) {\r\n            var elem;\r\n            elem = sR[id];\r\n            if (elem.td.parentNode.style.visibility === 'collapse') {\r\n                showPost(id, null)();\r\n                return elem.td.parentNode.style.visibility = 'visible';\r\n            } else {\r\n                return elem.td.parentNode.style.visibility = 'collapse';\r\n            }\r\n        };\r\n\r\n        showPost = function (id, prev) {\r\n            return function (event) {\r\n                var elem, nextTP, prevTP, threadPage;\r\n                elem = sR[id];\r\n                threadPage = \"threadid=\" + elem.threadid + \"&page=\" + elem.page;\r\n                nextTP = \"threadid=\" + elem.threadid + \"&page=\" + (elem.page + 1);\r\n                prevTP = \"threadid=\" + elem.threadid + \"&page=\" + (elem.page - 1);\r\n                if (event != null) {\r\n                    event.stopPropagation();\r\n                    event.preventDefault();\r\n                }\r\n                if (prev === true) {\r\n                    if (elem.index === 0 && elem.page > 1) {\r\n                        if (prevTP in tP) {\r\n                            if (tP[prevTP] === 'Loading') {\r\n                                cb[prevTP].push(showPost(id, prev));\r\n                            } else {\r\n                                elem.page = elem.page - 1;\r\n                                elem.index = tP[prevTP].length - 1;\r\n                                elem.td.replaceChild(tP[prevTP][elem.index], elem.td.lastChild);\r\n                            }\r\n                        } else {\r\n                            loadThreadPage(elem.threadid, elem.page - 1);\r\n                            cb[prevTP].push(showPost(id, prev));\r\n                        }\r\n                    } else {\r\n                        elem.index = Math.max(elem.index - 1, 0);\r\n                        if (elem.td.children.length === 2) {\r\n                            elem.td.replaceChild(tP[threadPage][elem.index], elem.td.lastChild);\r\n                        } else {\r\n                            elem.td.appendChild(tP[threadPage][elem.index]);\r\n                        }\r\n                    }\r\n                } else if (prev === false) {\r\n                    if (elem.index === 24) {\r\n                        if (nextTP in tP) {\r\n                            if (tP[nextTP] === 'Loading') {\r\n                                cb[prevTP].push(showPost(id, prev));\r\n                            } else {\r\n                                if (tP[nextTP].length > 0) {\r\n                                    elem.page = elem.page + 1;\r\n                                    elem.index = 0;\r\n                                    elem.td.replaceChild(tP[nextTP][0], elem.td.lastChild);\r\n                                }\r\n                            }\r\n                        } else {\r\n                            loadThreadPage(elem.threadid, elem.page + 1);\r\n                            cb[nextTP].push(showPost(id, prev));\r\n                        }\r\n                    } else {\r\n                        elem.index = Math.min(elem.index + 1, tP[threadPage].length - 1);\r\n                        if (elem.td.children.length === 2) {\r\n                            elem.td.replaceChild(tP[threadPage][elem.index], elem.td.lastChild);\r\n                        } else {\r\n                            elem.td.appendChild(tP[threadPage][elem.index]);\r\n                        }\r\n                    }\r\n                } else {\r\n                    if (elem.td.children.length === 2) {\r\n                        elem.td.replaceChild(tP[threadPage][elem.index], elem.td.lastChild);\r\n                    } else {\r\n                        elem.td.appendChild(tP[threadPage][elem.index]);\r\n                    }\r\n                }\r\n            };\r\n        };\r\n\r\n        filterPost = function (id) {\r\n            return function () {\r\n                var elem, i, len, toFilter, user_name;\r\n                elem = sR[id];\r\n                toFilter = true;\r\n                for (i = 0, len = user_filter.length; i < len; i++) {\r\n                    user_name = user_filter[i];\r\n                    if (elem.user.toUpperCase() === user_name.toUpperCase()) {\r\n                        toFilter = false;\r\n                        break;\r\n                    }\r\n                }\r\n                if (toFilter) {\r\n                    elem.td.parentNode.style.visibility = 'collapse';\r\n                    elem.parent.style.visibility = 'collapse';\r\n                }\r\n            };\r\n        };\r\n\r\n        if (workInRestOfForum || workInForumSearch) {\r\n            patt = document.querySelector('form[action=\"\"] input[name=\"search\"]');\r\n            if (patt != null) {\r\n                patt = patt.value.trim().replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, '\\\\$&').replace(/\\s+/g, '|');\r\n            } else {\r\n                patt = '';\r\n            }\r\n            allResults = document.querySelectorAll('a[href^=\"/forums.php?action=viewthread\"]');\r\n            for (j = i = 0, len = allResults.length; i < len; j = ++i) {\r\n                result = allResults[j];\r\n                textReplace(result);\r\n                a = document.createElement('a');\r\n                a.href = '#';\r\n                a.textContent = loadText;\r\n                a.addEventListener('click', loadPost(result, j, false), true);\r\n                myCell = result.parentNode;\r\n                myCell.insertBefore(a, result);\r\n            }\r\n        }\r\n\r\n        if (workInForumSearch) {\r\n            user_tr = document.createElement('tr');\r\n            user_td = [];\r\n            user_td.push(document.createElement('td'));\r\n            user_td.push(document.createElement('td'));\r\n            user_td[0].className = 'label';\r\n            strong = document.createElement('strong');\r\n            strong.textContent = 'Filter author(s):';\r\n            user_td[0].appendChild(strong);\r\n            input = document.createElement('input');\r\n            input.placeholder = 'Comma- or space-separated list of authors';\r\n            input.size = '64';\r\n            button = document.createElement('button');\r\n            button.textContent = 'Filter';\r\n            button.type = 'button';\r\n            user_td[1].appendChild(input);\r\n            user_td[1].appendChild(button);\r\n            user_tr.appendChild(user_td[0]);\r\n            user_tr.appendChild(user_td[1]);\r\n            searchForums = document.querySelector('select[name=\"forums[]\"]').parentNode.parentNode;\r\n            searchForums.parentNode.insertBefore(user_tr, searchForums);\r\n            button.addEventListener('click', function (event) {\r\n                var j, len1, results, userName;\r\n                if (input.value.replace(/[,\\s]/g, '') !== '') {\r\n                    user_filter = (function () {\r\n                        var j, len1, ref, results;\r\n                        ref = input.value.trim().replace(/[,\\s]+/g, ',').split(',');\r\n                        results = [];\r\n                        for (j = 0, len1 = ref.length; j < len1; j++) {\r\n                            userName = ref[j];\r\n                            results.push(userName.trim());\r\n                        }\r\n                        return results;\r\n                    })();\r\n                    button.disabled = 'disabled';\r\n                    results = [];\r\n                    for (j = j = 0, len1 = allResults.length; j < len1; j = ++j) {\r\n                        result = allResults[j];\r\n                        results.push(loadPost(result, j, true)());\r\n                    }\r\n                    return results;\r\n                }\r\n            }, true);\r\n        }\r\n    }).call(this);\r\n    /* End src/ab_forum_search_enhancement.user.js */\r\n\r\n\r\n    /* Begin src/ab_hide_pmstaff.user.js */\r\n    // ==UserScript==\r\n    // @name        AB - Hide PM staff\r\n    // @author      ShaverJ\r\n    // @description Hide PM staff on Main menu.\r\n    // @include     https://animebytes.tv/*\r\n    // @version     0.1\r\n    // @icon        http://animebytes.tv/favicon.ico\r\n    // @grant       GM_setValue\r\n    // @grant       GM_getValue\r\n    // @require     https://github.com/momentary0/AB-Userscripts/raw/master/delicious-library/src/ab_delicious_library.js\r\n    // ==/UserScript==\r\n\r\n    // Bassed on Hide treats by Alpha\r\n    (function ABHidePMstaff() {\r\n        var _enabled = delicious.settings.basicScriptCheckbox(\r\n            'hidepmstaff',\r\n            'PM the staff',\r\n            'Hide/Unhide PM the Staff link on the main menu'\r\n        );\r\n        if (!_enabled)\r\n            return;\r\n\r\n        var pmstaffnode = document.evaluate('//*[@id=\"nav_staffpm\"]', document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;\r\n        if (pmstaffnode) pmstaffnode.style.display = \"none\";\r\n    })();\r\n    /* End src/ab_hide_pmstaff.user.js */\r\n\r\n\r\n    /* Begin src/ab_hide_treats.user.js */\r\n    // ==UserScript==\r\n    // @name        AB - Hide treats\r\n    // @author      Alpha\r\n    // @description Hide treats on profile.\r\n    // @include     https://animebytes.tv/*\r\n    // @version     0.1.1\r\n    // @icon        http://animebytes.tv/favicon.ico\r\n    // @grant       GM_setValue\r\n    // @grant       GM_getValue\r\n    // @require     https://github.com/momentary0/AB-Userscripts/raw/master/delicious-library/src/ab_delicious_library.js\r\n    // ==/UserScript==\r\n\r\n    // Hide treats by Alpha\r\n    // Hide treats on profile.\r\n    (function ABHideTreats(){\r\n        var _enabled = delicious.settings.basicScriptCheckbox(\r\n            'delicioustreats',\r\n            'Disgusting Treats',\r\n            'Hide those hideous treats on profile pages!'\r\n        );\r\n        if (!_enabled)\r\n            return;\r\n\r\n        var treatsnode = document.evaluate('//*[@id=\"user_leftcol\"]/div[@class=\"box\" and div[@class=\"head\" and .=\"Treats\"]]', document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;\r\n        if (treatsnode) treatsnode.style.display = \"none\";\r\n    })();\r\n    /* End src/ab_hide_treats.user.js */\r\n\r\n\r\n    /* Begin src/ab_hoverin.user.js */\r\n    // ==UserScript==\r\n    // @name           AB Hoverin'\r\n    // @namespace      http://animebytes.tv\r\n    // @include        animebytes.tv*\r\n    // @grant       GM_setValue\r\n    // @grant       GM_getValue\r\n    // @require     https://github.com/momentary0/AB-Userscripts/raw/master/delicious-library/src/ab_delicious_library.js\r\n    // ==/UserScript==\r\n    function Hoverin(css) {\r\n        var head, style;\r\n        head = document.getElementsByTagName('head')[0];\r\n        if (!head) {\r\n            return;\r\n        }\r\n        style = document.createElement('style');\r\n        style.type = 'text/css';\r\n        style.innerHTML = css;\r\n        head.appendChild(style);\r\n    }\r\n    var _enabled = delicious.settings.basicScriptCheckbox(\r\n        'hoverdrop',\r\n        'Hoverin',\r\n        'Enable/Disable Auto dropdown menus when hovering.'\r\n    );\r\n    if (!_enabled)\r\n        return;\r\n\r\n    Hoverin('.navmenu:hover .subnav {' + ' display: block !important;' + '}');\r\n    /* End src/ab_hoverin.user.js */\r\n\r\n\r\n    /* Begin src/ab_hyper_quote.user.js */\r\n    // ==UserScript==\r\n    // @name        AB - HYPER QUOTE!\r\n    // @author      Megure, TheFallingMan\r\n    // @description Select text and press CTRL+V to quote\r\n    // @include     https://animebytes.tv/*\r\n    // @version     0.2.4\r\n    // @icon        http://animebytes.tv/favicon.ico\r\n    // @grant       GM_setValue\r\n    // @grant       GM_getValue\r\n    // @require     https://github.com/momentary0/AB-Userscripts/raw/master/delicious-library/src/ab_delicious_library.js\r\n    // ==/UserScript==\r\n\r\n    //import '../delicious-library/src/ab_delicious_library';\r\n\r\n    /* global delicious */\r\n\r\n    (function ABHyperQuote() {\r\n        var _enabled = delicious.settings.basicScriptCheckbox(\r\n            'delicioushyperquote',\r\n            'Delicious Hyper Quote',\r\n            'Select text and press Ctrl+V to instantly quote it.'\r\n        );\r\n        if (!_enabled)\r\n            return;\r\n\r\n        if (document.getElementById('quickpost') === null)\r\n            return;\r\n        /** Debug flag. */\r\n        var _debug = false;\r\n\r\n        function formattedUTCString(date, timezone) {\r\n            var creation = new Date(date);\r\n            if (isNaN(creation.getTime()))\r\n                return date;\r\n            else {\r\n                creation = creation.toUTCString().split(' ');\r\n                return creation[1] + ' ' + creation[2] + ' ' + creation[3] + ', ' + creation[4].substring(0, 5) + (timezone !== false ? ' ' + creation[5] : '');\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Quotes the entire selection.\r\n         *\r\n         * Handles combining adjacent selection ranges, then calls\r\n         * QUOTEMANY.\r\n         * */\r\n        function QUOTEALL() {\r\n            var sel = window.getSelection();\r\n            if (sel.rangeCount === 0) return;\r\n            // If there's only one range, happy days.\r\n            if (sel.rangeCount === 1) {\r\n                _debug && console.log('Quoting one range:');\r\n                _debug && console.log(sel.getRangeAt(0));\r\n                QUOTEMANY(sel.getRangeAt(0));\r\n            } else {\r\n                _debug && console.log('Dealing with multiple ranges.');\r\n                // Ohhh boy.... firefox, why...?\r\n                var allRanges = [];\r\n                // Start range of the current continguous selection range.\r\n                // The aim of this code is to join contiguous ranges into one range\r\n                // so they can be parsed properly, without being split into multiple\r\n                // quotes.\r\n                var startRange = sel.getRangeAt(0);\r\n                // Previous range we encountered.\r\n                var previousRange = startRange;\r\n                // Current range. Set in loop.\r\n                var thisRange = null;\r\n                // rangeCount+1 to make it loop one time after list is exhausted, to append\r\n                // last range to list.\r\n                // Start at 2nd range, because we have already set startRange\r\n                // and previousRange above. Also, first range has no previous\r\n                // range to compare to.\r\n                for (var i = 1; i < sel.rangeCount+1; i++) {\r\n                    if (i < sel.rangeCount)\r\n                        thisRange = sel.getRangeAt(i);\r\n                    else\r\n                        thisRange = null;\r\n                    // If this range starts at the beginning and picks up\r\n                    // exactly where the previous range left off.\r\n                    // After trial/error, this code should work.\r\n                    // endOffset+1 is to get the childNode _after_ the previous\r\n                    // range ends, since ranges don't overlap (hopefully)\r\n                    if (thisRange !== null && thisRange.startOffset === 0 &&\r\n                        previousRange.endContainer.childNodes[previousRange.endOffset+1] === thisRange.startContainer) {\r\n                        // Store this range as the previous and continue looping.\r\n                        previousRange = thisRange;\r\n                    } else {\r\n                        // Else, the current range does not continue from\r\n                        // the previous one.\r\n                        if (startRange !== previousRange) {\r\n                            // Create and append a new, more sensible, range.\r\n                            var newRange = document.createRange();\r\n                            newRange.setStart(startRange.startContainer, startRange.startOffset);\r\n                            newRange.setEnd(previousRange.endContainer, previousRange.endOffset);\r\n                            allRanges.push(newRange);\r\n                        } else {\r\n                            // No adjacent ranges to startRange.\r\n                            // They're both the same, append either.\r\n                            allRanges.push(previousRange);\r\n                        }\r\n                        // Set these for the next iteration.\r\n                        startRange = thisRange;\r\n                        previousRange = thisRange;\r\n                    }\r\n                }\r\n                for (var j = 0; j < allRanges.length; j++) {\r\n                    QUOTEMANY(allRanges[j]);\r\n                }\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Quotes many posts.\r\n         *\r\n         * Clones each post and deletes text outside of the selection\r\n         * range.\r\n         *\r\n         * @param {Range} range Selection range to quote.\r\n         */\r\n        function QUOTEMANY(range) {\r\n            /**\r\n             * Removes all siblings of 'node' which occur before or after it,\r\n             * depending on the value of 'prev'.\r\n             *\r\n             * @param {Node} node\r\n             * @param {boolean} prev\r\n             */\r\n            function removeChildren(node, prev) {\r\n                if (node === null || node.parentNode === null) return;\r\n                if (prev === true)\r\n                    while (node.parentNode.firstChild !== node)\r\n                        node.parentNode.removeChild(node.parentNode.firstChild);\r\n                else\r\n                    while (node.parentNode.lastChild !== node)\r\n                        node.parentNode.removeChild(node.parentNode.lastChild);\r\n                removeChildren(node.parentNode, prev);\r\n            }\r\n            /**\r\n             * Essentailly indexOf for any array-like object.\r\n             *\r\n             * @param {Array} arr\r\n             * @param {object} elem\r\n             */\r\n            function inArray(arr, elem) {\r\n                for (var i = 0; i < arr.length; i++) {\r\n                    if (arr[i] === elem)\r\n                        return i;\r\n                }\r\n                _debug && console.log(elem);\r\n                return -1;\r\n            }\r\n\r\n            // TODO: refactor bbcodeChildren to use these functions.\r\n\r\n            /**\r\n             *\r\n             * @param {HTMLElement} quoteNode\r\n             */\r\n            function isSmartQuote(quoteNode) {\r\n                try {\r\n                    var colon = quoteNode.previousSibling;\r\n                    var link = colon.previousSibling;\r\n                    var span = link.firstElementChild;\r\n                    var strong = link.previousElementSibling;\r\n                    return (colon.nodeValue === ':\\n'\r\n                        && span.tagName.toUpperCase() === 'SPAN'\r\n                        && span.title\r\n                        && link.tagName.toUpperCase() === 'A'\r\n                        && link.textContent.slice(0, 6) === 'wrote '\r\n                        && strong.tagName.toUpperCase() === 'STRONG'\r\n                        && strong.firstElementChild.href.indexOf('/user.php?id=') !== -1);\r\n                } catch (e) {\r\n                    return false;\r\n                }\r\n            }\r\n\r\n            function isUsernameQuote(quoteNode) {\r\n                try {\r\n                    var wrote = quoteNode.previousSibling;\r\n                    var strong = wrote.previousSibling;\r\n                    return (wrote.nodeValue === ' wrote:\\n'\r\n                        && strong.nodeType === Node.ELEMENT_NODE\r\n                        && strong.tagName.toUpperCase() === 'STRONG'\r\n                        && strong.childNodes.length === 1\r\n                        && strong.firstChild.nodeType === Node.TEXT_NODE\r\n                    );\r\n                } catch (e) {\r\n                    return false;\r\n                }\r\n            }\r\n\r\n            /**\r\n             * Returns a new documentFragment containing 'num' many nodes\r\n             * which are previous siblings of 'node', cloned.\r\n             * Assumes said siblings exist.\r\n             *\r\n             * @param {number} num\r\n             * @param {Node} node\r\n             */\r\n            function savePreviousNodes(num, node) {\r\n                var docFrag = document.createDocumentFragment();\r\n                var index = inArray(node.parentNode.childNodes, node);\r\n                for (var q = 0; q < num; q++) {\r\n                    docFrag.appendChild(\r\n                        node.parentNode.childNodes[index-num+q].cloneNode(true));\r\n                }\r\n                return docFrag;\r\n            }\r\n\r\n            /**\r\n             * Array of [number, docFrag] pairs where number is a\r\n             * data-hyper-quote value referencing a unique node\r\n             * and the corresponding document fragment\r\n             * contains the nodes to insert before it.\r\n             *\r\n             * @type {[number, DocumentFragment][]}\r\n             */\r\n            var savedPreviousNodes = [];\r\n            /**\r\n             * Checks if 'node' has previous siblings which should be kept\r\n             * (e.g. usernames of quotes or buttons of spoilers).\r\n             *\r\n             * @param {Node} node\r\n             */\r\n            function preserveIfNeeded(node) {\r\n                var numToSave = 0;\r\n                if (isSmartQuote(node))\r\n                    numToSave = 4;\r\n                else if (isUsernameQuote(node))\r\n                    numToSave = 2;\r\n\r\n                if (numToSave) {\r\n                    var num;\r\n                    if (savedPreviousNodes.length) num = savedPreviousNodes.slice(-1)[0] + 1;\r\n                    else num = 1;\r\n                    var pair = [num, savePreviousNodes(numToSave, node)];\r\n                    node.dataset['hyperQuote'] = num;\r\n                    savedPreviousNodes.push(pair);\r\n                    return pair;\r\n                }\r\n                return null;\r\n            }\r\n\r\n            /**\r\n             * Traverses upwards from 'node' to the topmost element in the document.\r\n             *\r\n             * If preserve is true, will check for previous nodes to preserve.\r\n             *\r\n             * @param {Node} bottomNode\r\n             * @param {boolean} preserve\r\n             * @returns {[Node, number[]]} Tuple of topmost parent element and array of indexes.\r\n             */\r\n            function traverseUpwards(bottomNode, preserve) {\r\n                var path = [];\r\n                while (bottomNode.parentNode !== null) {\r\n                    path.push(inArray(bottomNode.parentNode.childNodes, bottomNode));\r\n                    if (preserve)\r\n                        preserveIfNeeded(bottomNode);\r\n                    bottomNode = bottomNode.parentNode;\r\n                }\r\n                return [bottomNode, path];\r\n            }\r\n\r\n            /**\r\n             * Reverse of traverseUpwards,\r\n             * descending to the element in the original position using a known\r\n             * array of indexes.\r\n             *\r\n             * @param {Node} topNode\r\n             * @param {number[]} path\r\n             */\r\n            function traverseDownwards(topNode, path) {\r\n                for (var i = path.length - 1; i >= 0; i--) {\r\n                    if (path[i] === -1) return;\r\n                    topNode = topNode.childNodes[path[i]];\r\n                }\r\n                return topNode;\r\n            }\r\n\r\n            if (range.collapsed === true) return;\r\n\r\n            // Goes from the startContainer to root document node, storing its\r\n            // path in 'start'.\r\n            var html1 = range.startContainer;\r\n            var t = traverseUpwards(html1, true);\r\n            html1 = t[0];\r\n            var start = t[1];\r\n\r\n            // Similarly for the endContainer.\r\n            var html2 = range.endContainer;\r\n            var u = traverseUpwards(html2, false);\r\n            html2 = u[0];\r\n            var end = u[1];\r\n\r\n            // These should be equal as they originate from the same <html> tag.\r\n            if (html1 !== html2 || html1 === null) return;\r\n            // Take a copy which we can edit as we need.\r\n            var htmlCopy = html1.cloneNode(true);\r\n\r\n            // Descends the copied HTML tree to get to the startContainer\r\n            // and endContainer, using the indexes stored previously.\r\n            var startNode = traverseDownwards(htmlCopy, start);\r\n            var endNode = traverseDownwards(htmlCopy, end);\r\n\r\n            // Slices the start and end containers so they contain only\r\n            // the selected text.\r\n            if (endNode.nodeType === 3)\r\n                endNode.data = endNode.data.substr(0, range.endOffset);\r\n            else if (endNode.nodeType === 1)\r\n                for (var i = endNode.childNodes.length; i > range.endOffset; i--)\r\n                    endNode.removeChild(endNode.lastChild);\r\n            if (range.startOffset > 0) {\r\n                if (startNode.nodeType === 3)\r\n                    startNode.data = startNode.data.substr(range.startOffset);\r\n                else if (startNode.nodeType === 1)\r\n                    for (var j = 0; j < range.startOffset; j++)\r\n                        startNode.removeChild(startNode.firstChild);\r\n            }\r\n\r\n            // Removes all elements before startNode and after endNode.\r\n            removeChildren(startNode, true);\r\n            removeChildren(endNode, false);\r\n\r\n            // Finds the bottommost element which is a parent of both\r\n            // startNode and endNode. This is done to find the deepest quote\r\n            // which was quoted.\r\n            // Implemented by searching recursing downwards while the parent node\r\n            // only has one child or one whild + whitespace.\r\n            var commonRoot = htmlCopy;\r\n            var rootQuote = null;\r\n            var secondChild = null; // Set in 'while' conditional.\r\n            while ( // I'm really sorry about this code ;-;\r\n                (commonRoot.childNodes.length === 1) // If only one child, the result is obvious.\r\n                || (\r\n                    commonRoot.childNodes.length === 2 // If 2 children.\r\n                    && (secondChild = commonRoot.childNodes[1])\r\n                    && ( // If second child is a text node, we require it be whitespace.\r\n                        (secondChild.nodeType === Node.TEXT_NODE && !secondChild.nodeValue.trim())\r\n                        || // If it is an element, we require it to be <br>.\r\n                        (secondChild.tagName && secondChild.tagName.toUpperCase() === 'BR')\r\n                    )\r\n                )\r\n            ) {\r\n                // If these conditions hold, the child is a common parent of both\r\n                // startNode and endNode, as other elements were deleted earlier.\r\n                commonRoot = commonRoot.firstChild;\r\n                // Moreover, if it's a quote, we store it so we only quote within\r\n                // the deepest common quote.\r\n                if (commonRoot.classList && commonRoot.classList.contains('blockquote')) {\r\n                    rootQuote = commonRoot;\r\n                }\r\n            }\r\n\r\n            // Restores extra nodes before a quote such as username and link.\r\n            // Must be done after the common root checking otherwise it will\r\n            // mess up the process.\r\n            for (var k = 0; k < savedPreviousNodes.length; k++) {\r\n                // Use selectors on the copied HTML tree to find the corresponding\r\n                // nodes.\r\n                var selector = '[data-hyper-quote=\"'+savedPreviousNodes[k][0]+'\"]';\r\n                var copyNode = htmlCopy.querySelector(selector);\r\n                copyNode.parentNode.insertBefore(savedPreviousNodes[k][1], copyNode);\r\n\r\n                // Delete original document's data-hyper-quote attribute.\r\n                // We don't care about htmlCopy's attributes as it gets reset\r\n                // every time.\r\n                delete document.querySelector(selector).dataset['hyperQuote'];\r\n            }\r\n            savedPreviousNodes = [];\r\n\r\n            // If there is a [quote] common to start and end. In other worse,\r\n            // the selection is contained entirely within one quote.\r\n            if (rootQuote) {\r\n                // Then, we only quote within the deepest quote, as that makes\r\n                // the most sense.\r\n                var sel = document.getElementById('quickpost');\r\n                sel.value += bbcodeChildrenTrim(rootQuote.parentNode);\r\n                sel.scrollIntoView();\r\n                return;\r\n            }\r\n\r\n            // Otherwise, quote as usual.\r\n            var posts = htmlCopy.querySelectorAll('div[id^=\"post\"],div[id^=\"msg\"]');\r\n            for (var l = 0; l < posts.length; l++) {\r\n                QUOTEONE(posts[l]);\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Returns BBCode of one whole div.post.\r\n         *\r\n         * @param {HTMLDivElement} postDiv\r\n         */\r\n        function bbcodeChildrenTrim(postDiv) {\r\n            return bbcodeChildren(postDiv).trim();\r\n        }\r\n\r\n        /**\r\n         * Returns BBCode of parentNode's children.\r\n         *\r\n         * BBCode which relies on adjacent siblings (e.g. quotes) must be placed\r\n         * here, as other functions consider one HTML element only.\r\n         *\r\n         * Returns children's BBCode only; assumes the parent BBCode has\r\n         * been generated elsewhere.\r\n         *\r\n         * @param {Node} parentNode\r\n         */\r\n        function bbcodeChildren(parentNode) {\r\n            _debug && console.log('parentNode: ');\r\n            _debug && console.log(parentNode);\r\n            if (!(parentNode.childNodes && parentNode.childNodes.length))\r\n                return '';\r\n            var bbcodeString = '';\r\n            for (var i = 0; i < parentNode.childNodes.length; i++) {\r\n                var thisNode = parentNode.childNodes[i];\r\n                if (thisNode.nodeType === Node.TEXT_NODE) {\r\n                    // Handles text nodes.\r\n                    var text = thisNode.nodeValue;\r\n                    // If this isn't the first child and previous is a <br>,\r\n                    // collapse leading space.\r\n                    if (i > 0 && parentNode.childNodes[i-1].nodeType === Node.ELEMENT_NODE\r\n                        && parentNode.childNodes[i-1].tagName.toUpperCase() === 'BR')\r\n                        text = text.replace(/^\\s+/, '');\r\n                    // If this isn't the last child and next is a <br>,\r\n                    // collapse trailing space.\r\n                    if (i+1 < parentNode.childNodes.length\r\n                        && parentNode.childNodes[i+1].nodeType === Node.ELEMENT_NODE\r\n                        && parentNode.childNodes[i+1].tagName.toUpperCase() === 'BR')\r\n                        text = text.replace(/\\s+$/, '');\r\n                    bbcodeString += text;\r\n                    continue;\r\n                }\r\n\r\n                /**\r\n                 * Whether this element represents the start of a\r\n                 * post number (e.g. `[quote=#1559283]`) quote.\r\n                 */\r\n                var isSmartQuote = false;\r\n                try {\r\n                    // We fully expect this to throw exceptions if the element\r\n                    // is not a quote block, as the surrounding structure\r\n                    // will not be there.\r\n                    //debugger;\r\n                    isSmartQuote = (\r\n                        (i+4 < parentNode.childNodes.length)\r\n                        // thisNode is a <strong></strong> node containing the\r\n                        // user link.\r\n                        && thisNode.nodeType === Node.ELEMENT_NODE\r\n                        && thisNode.tagName.toUpperCase() === 'STRONG'\r\n                        && thisNode.firstElementChild.href.indexOf('user.php?id=') !== -1\r\n                        // i+1 is a \" \" text node.\r\n                        && !parentNode.childNodes[i+1].nodeValue.trim()\r\n                        // i+2 is the <a> node linking to the post.\r\n                        && parentNode.childNodes[i+2].textContent.indexOf('wrote') !== -1\r\n                        && parentNode.childNodes[i+2].firstElementChild.tagName.toUpperCase() === 'SPAN'\r\n                        && parentNode.childNodes[i+2].firstElementChild.title\r\n                        // i+3 is the :\r\n                        && parentNode.childNodes[i+3].nodeValue.indexOf(':') !== -1\r\n                        // i+4 is the quote.\r\n                        && parentNode.childNodes[i+4].classList.contains('blockquote')\r\n                    );\r\n                } catch (exception) { _debug && console.log(exception); }\r\n                _debug && console.log('isSmartQuote: ' + isSmartQuote);\r\n                if (isSmartQuote) {\r\n                    bbcodeString += bbcodeSmartQuote(thisNode,\r\n                        parentNode.childNodes[i+2], parentNode.childNodes[i+4]);\r\n                    i += 4; // Skip the next 4 nodes.\r\n                    continue;\r\n                }\r\n\r\n                /**\r\n                 * Whether this element represents the start of a\r\n                 * `[quote=username]` quote.\r\n                 * */\r\n                var isBasicQuote = false;\r\n                try {\r\n                    // Strictly speaking, we don't have to handle this here;\r\n                    // handling it with the generic code\r\n                    // (i.e. [b]username[/b] wrote ...)\r\n                    // results in identical rendered output.\r\n                    isBasicQuote = (\r\n                        // Similar logic as above.\r\n                        (i+2 < parentNode.childNodes.length)\r\n                        && thisNode.nodeType === Node.ELEMENT_NODE\r\n                        && thisNode.tagName.toUpperCase() === 'STRONG'\r\n                        && thisNode.childNodes.length === 1\r\n                        && thisNode.firstChild.nodeType === Node.TEXT_NODE\r\n                        && parentNode.childNodes[i+1].nodeValue.trim() === 'wrote:'\r\n                        && parentNode.childNodes[i+2].classList.contains('blockquote')\r\n                    );\r\n                } catch (exception) { _debug && console.log(exception); }\r\n                if (isBasicQuote) {\r\n                    bbcodeString += bbcodeQuote(thisNode.firstChild.nodeValue, parentNode.childNodes[i+2]);\r\n                    i += 2;\r\n                    continue;\r\n                }\r\n\r\n                var isMediainfo = false;\r\n                try {\r\n                    isMediainfo = (\r\n                        // Spoiler button\r\n                        thisNode.classList.contains('hideContainer')\r\n                        && (\r\n                            (// Either followed by a .mediainfo table\r\n                                (i+1 < parentNode.childNodes.length)\r\n                                && parentNode.childNodes[i+1].tagName.toUpperCase() === 'TABLE'\r\n                                && parentNode.childNodes[i+1].classList.contains('mediainfo'))\r\n                            || ( // OR, which was originally followed by a mediainfo table.\r\n                                (i+1 === parentNode.childNodes.length)\r\n                                && thisNode.firstElementChild.value.length > 4\r\n                                && thisNode.firstElementChild.value.indexOf('.') !== -1\r\n                                && document.querySelector(\r\n                                    '.hideContainer > .spoilerButton[value=\"'\r\n                                    + thisNode.firstElementChild.value+'\"]'\r\n                                ).parentNode.nextElementSibling.classList.contains('mediainfo'))\r\n                        )\r\n                    );\r\n                } catch (exception) { _debug && console.log(exception); }\r\n                if (isMediainfo) {\r\n                    bbcodeString += bbcodeMediainfo(thisNode,\r\n                        parentNode.childNodes[i+1]);\r\n                    i += 1;\r\n                    continue;\r\n                }\r\n\r\n                // Otherwise, we handle it as a normal node.\r\n                bbcodeString += bbcodeOneElement(thisNode);\r\n            }\r\n            return bbcodeString;\r\n        }\r\n\r\n        /**\r\n         * Returns a quote BBCode, with quoteName as the = parameter, containing\r\n         * the contents of quoteNode.\r\n         *\r\n         * @param {string} quoteName\r\n         * @param {HTMLQuoteElement} quoteNode\r\n         */\r\n        function bbcodeQuote(quoteName, quoteNode) {\r\n            var contents = bbcodeChildrenTrim(quoteNode);\r\n            return (\r\n                '[quote'+(quoteName?'='+quoteName:'')+']\\n'\r\n                +contents\r\n                +'\\n[/quote]\\n');\r\n        }\r\n\r\n        /**\r\n         * Returns an appropriate [quote] tag using a post number.\r\n         *\r\n         * @param {HTMLElement} strongNode Node containing username link.\r\n         * @param {HTMLAnchorElement} wroteLink Post link element.\r\n         * @param {HTMLQuoteElement} quoteNode Blockquote element.\r\n         */\r\n        function bbcodeSmartQuote(strongNode, wroteLink, quoteNode) {\r\n            var quoteType = '';\r\n            var href = wroteLink.href;\r\n            if (href.indexOf('/forums.php') !== -1) quoteType = '#';\r\n            else if (href.indexOf('/user.php') !== -1) quoteType = '*';\r\n            else if (href.indexOf('/torrents.php') !== -1) quoteType = '-1';\r\n            else if (href.indexOf('/torrents2.php') !== -1) quoteType = '-2';\r\n            if (quoteType !== '') {\r\n                var id = /#(?:msg|post)?(\\d+)$/.exec(href); // post number\r\n                // We have to be careful with newlines otherwise too much whitespace\r\n                // will be added.\r\n                if (id)\r\n                    return bbcodeQuote(quoteType + id[1], quoteNode);\r\n            }\r\n            // We shouldn't ever reach this.\r\n            return ('[url='+wroteLink.href+']Unknown quote[/url][quote]'\r\n                +bbcodeChildren(quoteNode)+'[/quote]');\r\n        }\r\n\r\n        /**\r\n         * Returns BBCode of one <strong> node.\r\n         *\r\n         * @param {HTMLElement} strongNode\r\n         */\r\n        function bbcodeStrong(strongNode) {\r\n            // Special case of \"Added on ...\" text.\r\n            if (strongNode.childNodes.length === 1\r\n            && strongNode.firstChild.nodeType === Node.TEXT_NODE\r\n            && strongNode.firstChild.nodeValue.slice(0, 9) === 'Added on ') {\r\n                var dateString = strongNode.firstChild.nodeValue.slice(9);\r\n                var end = '';\r\n                if (dateString.slice(-1) === ':') {\r\n                    dateString = dateString.slice(0, -1);\r\n                    end = ':';\r\n                }\r\n                return '[b]Added on '+formattedUTCString(dateString)+end+'[/b]';\r\n            } else {\r\n                return '[b]'+bbcodeChildren(strongNode)+'[/b]';\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Returns BBCode of a div element.\r\n         *\r\n         * Possible cases:\r\n         *\r\n         *  - [align=...] tag.\r\n         *  - [code] tag.\r\n         *  - [spoiler] or [hide] tag.\r\n         *\r\n         * @param {HTMLDivElement} divNode\r\n         */\r\n        function bbcodeDiv(divNode) {\r\n            if (divNode.style.textAlign) {\r\n                var align = divNode.style.textAlign;\r\n                return '[align='+align+']'+bbcodeChildren(divNode)+'[/align]';\r\n            }\r\n            if (divNode.classList.contains('codeBox')) {\r\n                return '[code]'+divNode.firstElementChild.firstChild.nodeValue+'[/code]';\r\n            }\r\n            if (divNode.classList.contains('spoilerContainer')) {\r\n                return bbcodeSpoiler(divNode);\r\n            }\r\n            // This fallback shouldn't ever occur.\r\n            return bbcodeChildren(divNode);\r\n        }\r\n\r\n        /**\r\n         * Returns BBCode of a spoiler element, considering for\r\n         * custom button text.\r\n         *\r\n         * @param {HTMLDivElement} spoilerDiv\r\n         */\r\n        function bbcodeSpoiler(spoilerDiv) {\r\n            var isSpoiler = !spoilerDiv.classList.contains('hideContainer');\r\n            // [hide] or [spoiler]\r\n            var bbcodeTag = isSpoiler ? 'spoiler' : 'hide';\r\n\r\n            // If we have less than 2 children, then this is an abnormal spoiler.\r\n            if (spoilerDiv.children.length < 2) {\r\n                // If the only child of this div isn't the spoiler's contents,\r\n                // it must be the button and we return.\r\n                if (!spoilerDiv.firstElementChild.classList.contains('spoiler')) {\r\n                    return '';\r\n                }\r\n                // Otherwise, only the inside of a spoiler is selected.\r\n                // In this case, we have no button to work with. Compromise.\r\n                return '['+bbcodeTag+']'+bbcodeChildren(spoilerDiv.firstElementChild)+'[/'+bbcodeTag+']';\r\n            }\r\n            var label = spoilerDiv.firstElementChild.value.replace(/^(Hide|Show)/, '');\r\n            if (isSpoiler) // ' spoiler' is appended automatically to spoiler buttons\r\n                label = label.replace(/ spoiler$/, '');\r\n            if (label) {\r\n                label = label.slice(1); // slice space.\r\n            }\r\n            return '['+bbcodeTag + (label ? '='+label : '') + ']\\n' +\r\n                bbcodeChildrenTrim(spoilerDiv.children[1]) + '\\n[/'+bbcodeTag+']';\r\n        }\r\n\r\n\r\n        /**\r\n         * Returns BBCode for a [mediainfo] tag.\r\n         *\r\n         * @param {HTMLDivElement} buttonDiv Div containing the button and spoiler.\r\n         * @param {HTMLTableElement} mediainfoTable\r\n         */\r\n        function bbcodeMediainfo(buttonDiv, mediainfoTable) { // eslint-disable-line no-unused-vars\r\n            if (buttonDiv.children.length < 2) return '';\r\n            return '[mediainfo]' + bbcodeChildren(buttonDiv.children[1]) + '[/mediainfo]';\r\n        }\r\n\r\n\r\n        /**\r\n         * Returns BBCode of a <ol> or <ul> tag.\r\n         *\r\n         * @param {HTMLUListElement} listNode\r\n         * @param {String} bbcodeTag Tag to insert before each line.\r\n         */\r\n        function bbcodeList(listNode, bbcodeTag) {\r\n            var str = '';\r\n            for (var c = 0; c < listNode.childElementCount; c++) {\r\n                // Only consider element children, which we assume are\r\n                // <li> or <ol>/<ul>.\r\n                str += bbcodeTag + bbcodeChildren(listNode.children[c]);\r\n                // For whitespace.\r\n                if (str.slice(-1) !== '\\n') str += '\\n';\r\n            }\r\n            return str;\r\n        }\r\n\r\n        /**\r\n         * Returns BBCode of an image element, possibly a smiley.\r\n         *\r\n         * @param {HTMLImageElement} imgNode\r\n         */\r\n        function bbcodeImage(imgNode) {\r\n            if (imgNode.classList.contains('bbcode_smiley')) {\r\n                return imgNode.alt;\r\n            }\r\n            // Note: AB proxies images, so quoted images will not\r\n            // necessarily use the same URL as the original did.\r\n            // Original URL is b64 encoded within the CDN URL.\r\n            return '[img]'+imgNode.src+'[/img]';\r\n        }\r\n\r\n        /**\r\n         * Returns a string containing the hex representation of a number,\r\n         * padded to 2 hex digits.\r\n         *\r\n         * @param {Number} num\r\n         */\r\n        function numToHex(num) {\r\n            var h = num.toString(16);\r\n            while (h.length < 2)\r\n                h = '0' + h;\r\n            return h;\r\n        }\r\n\r\n        /** Regex matching colour in rgb(x, y, z) format. */\r\n        var rgbRegex = /^rgb\\((\\d{1,3}), (\\d{1,3}), (\\d{1,3})\\)$/i;\r\n        /**\r\n         * Returns BBCode of a HTML <span> element.\r\n         *\r\n         * Possible cases:\r\n         *\r\n         *  - Smiley\r\n         *  - Color\r\n         *  - Size\r\n         *  - Secret\r\n         *\r\n         * @param {HTMLSpanElement} spanNode\r\n         */\r\n        function bbcodeSpan(spanNode) {\r\n            if (spanNode.className.indexOf('smiley-') !== -1) {\r\n                return bbcodeSmiley(spanNode);\r\n            }\r\n            var colour = spanNode.style.color;\r\n            if (colour) {\r\n                var rgbMatch = rgbRegex.exec(colour);\r\n                // Check for rgb() format colours.\r\n                if (rgbMatch)\r\n                    colour = ('#' + numToHex(parseInt(rgbMatch[1]))\r\n                    +numToHex(parseInt(rgbMatch[2]))\r\n                    +numToHex(parseInt(rgbMatch[3])));\r\n                return '[color='+colour+']' + bbcodeChildren(spanNode) + '[/color]';\r\n            }\r\n            if (spanNode.className.slice(0, 4) === 'size') {\r\n                var size = spanNode.className.replace('size', '');\r\n                return '[size='+size+']'+bbcodeChildren(spanNode)+'[/size]';\r\n            }\r\n            if (spanNode.className === 'last-edited') {\r\n                return '';\r\n            }\r\n            if (spanNode.classList.contains('secret')) {\r\n                return '[secret]' + bbcodeChildren(spanNode) + '[/secret]';\r\n            }\r\n            if (spanNode.title)\r\n                return formattedUTCString(spanNode.title);\r\n            return bbcodeChildren(spanNode);\r\n        }\r\n\r\n        /**\r\n         * Given a HTML span element representing a smiley, finds and returns\r\n         * the smiley's BBCode.\r\n         *\r\n         * @param {HTMLSpanElement} smileySpan\r\n         */\r\n        function bbcodeSmiley(smileySpan) {\r\n            var smiley = smileySpan.title;\r\n            var smileyNode = document.querySelector('span[alt=\"' + smiley + '\"]');\r\n            if (smileyNode === null)\r\n                smileyNode = document.querySelector('span[style*=\"/' + smiley + '.png\"]');\r\n            if (smileyNode === null)\r\n                smileyNode = document.querySelector('span[style*=\"/' + smiley.replace(/-/g, '_') + '.png\"]');\r\n            if (smileyNode === null)\r\n                smileyNode = document.querySelector('span[style*=\"/' +\r\n                    smiley.replace(/-/g, '_').toLowerCase() + '.png\"]');\r\n            if (smileyNode === null)\r\n                smileyNode = document.querySelector('span[style*=\"/' + smiley.replace(/face/g, '~_~') + '.png\"]');\r\n            if (smileyNode !== null && smileyNode.parentNode !== null) {\r\n                smileyNode = smileyNode.getAttribute('onclick').match(/'(.+?)'/i);\r\n                if (smileyNode !== null)\r\n                    return smileyNode[1];\r\n            }\r\n            return ':' + smiley + ':';\r\n        }\r\n\r\n\r\n        var userRegex = /^\\/user\\.php\\?id=(\\d+)$/;\r\n        var torrentRegex = /^torrents2?\\.php\\?id=\\d+&torrentid=(\\d+)$/;\r\n\r\n        /**\r\n         *\r\n         * @param {HTMLAnchorElement} linkElement\r\n         */\r\n        function bbcodeLink(linkElement) {\r\n            // <img> tags are often wrapped around a <a> pointing to the same image.\r\n            if (linkElement.classList.contains('scaledImg')) {\r\n                return bbcodeImage(linkElement.firstElementChild);\r\n            }\r\n            /** href with relative links resolved. */\r\n            var href = linkElement.href;\r\n            /** Actual href as typed into HTML */\r\n            var realHref = linkElement.getAttribute('href');\r\n\r\n            var userMatch = userRegex.exec(realHref);\r\n            if (userMatch)\r\n                return '[user='+href+']'+bbcodeChildren(linkElement)+'[/user]';\r\n            var torrentMatch = torrentRegex.exec(realHref);\r\n            if (torrentMatch) {\r\n                // If the link's text contains &nbsp; we assume it is a torrent\r\n                // link.\r\n                if (linkElement.textContent.indexOf('\\xa0\\xa0[') !== -1)\r\n                    return '[torrent]'+href+'[/torrent]';\r\n                else\r\n                    return '[torrent='+href+']'+bbcodeChildren(linkElement)+'[/torrent]';\r\n            }\r\n            // Actually, torrent and user links could be written using [url=]\r\n            // and the rendered output would be the same.\r\n            return ('[url='+realHref+']'+ bbcodeChildren(linkElement) + '[/url]');\r\n        }\r\n\r\n        var youtubeRegex = /\\/embed\\/([^?]+)\\?/i;\r\n        var soundcloudRegex = /\\/player\\/\\?url=([^&]+)&/i;\r\n\r\n        /**\r\n         * Returns BBCode for embedded media.\r\n         *\r\n         * @param {HTMLIFrameElement} iframeNode\r\n         */\r\n        function bbcodeIframe(iframeNode) {\r\n            var src = iframeNode.src;\r\n            if (src.indexOf('youtube.com/embed') !== -1) {\r\n                return '[youtube]https://youtube.com/watch?v='+youtubeRegex.exec(src)[1]+'[/youtube]';\r\n            }\r\n            if (src.indexOf('soundcloud.com/player') !== -1) {\r\n                // The original soundcloud URL is encoded and forms a part of the\r\n                // embed URL.\r\n                return '[soundcloud]'+decodeURIComponent(soundcloudRegex.exec(src)[1])+'[/soundcloud]';\r\n            }\r\n            return 'Embedded media: ' + src;\r\n        }\r\n\r\n        /**\r\n         * Returns BBCode for one element.\r\n         *\r\n         * Handles simple cases and routes more complex cases\r\n         * to the appropriate function.\r\n         *\r\n         * @param {HTMLElement} node\r\n         */\r\n        function bbcodeOneElement(node) {\r\n            if (node.nodeType !== Node.ELEMENT_NODE) {\r\n                // Text nodes should be handled in bbcodeChildren.\r\n                if (node.nodeType === Node.TEXT_NODE)\r\n                    return node.nodeValue;\r\n                if (node.nodeType === Node.COMMENT_NODE && node.nodeValue === 'n')\r\n                    return '[n]';\r\n                return '';\r\n            }\r\n            switch (node.tagName.toUpperCase()) {\r\n            case 'DIV': return bbcodeDiv(node);\r\n            case 'SPAN': return bbcodeSpan(node);\r\n            case 'BR': return '\\n';\r\n            case 'STRONG': return bbcodeStrong(node);\r\n            case 'EM': return '[i]'+bbcodeChildren(node)+'[/i]';\r\n            case 'U': return '[u]'+bbcodeChildren(node)+'[/u]';\r\n            case 'S': return '[s]'+bbcodeChildren(node)+'[/s]';\r\n            case 'OL': return bbcodeList(node, '[#] ');\r\n            case 'UL': return bbcodeList(node, '[*] ');\r\n            case 'A': return bbcodeLink(node);\r\n            case 'IMG': return bbcodeImage(node);\r\n            case 'IFRAME': return bbcodeIframe(node);\r\n            case 'BLOCKQUOTE': return bbcodeQuote('', node);\r\n            case 'HR': return '[hr]';\r\n            case 'TABLE': return bbcodeChildren(node); // crude representation of a table\r\n            case 'CAPTION': return '[b]'+bbcodeChildren(node)+'[/b]\\n';\r\n            case 'TBODY': return bbcodeChildren(node);\r\n            case 'TH': return bbcodeChildren(node) + '\\n';\r\n            case 'TR': return bbcodeChildren(node) + '\\n';\r\n            case 'TD': return bbcodeChildren(node) + '\\t';\r\n            default:\r\n                return '<'+node.tagName+'>' + bbcodeChildren(node) + '</'+node.tagName+'>';\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Quotes one post, with post number.\r\n         *\r\n         * @param {Node} post\r\n         */\r\n        function QUOTEONE(post) {\r\n            //_debug && console.log(post.querySelector('div.post,div.body').innerHTML);\r\n            //var res = HTMLtoBB(post.querySelector('div.post,div.body').innerHTML),\r\n            var res = bbcodeChildrenTrim(post.querySelector('div.post, div.body'));\r\n            var author, creation, postid, type = '';\r\n            if (res === '') return;\r\n\r\n            postid = post.id.match(/(?:msg|post)(\\d+)/i);\r\n            if (postid === null)\r\n                return;\r\n\r\n            if (window.location.pathname === '/forums.php') type = '#';\r\n            if (window.location.pathname === '/user.php') type = '*';\r\n            if (window.location.pathname === '/torrents.php') type = '-1';\r\n            if (window.location.pathname === '/torrents2.php') type = '-2';\r\n            if (type !== '')\r\n                res = '[quote=' + type + postid[1] + ']' + res + '[/quote]\\n';\r\n            else {\r\n                author = post.className.match(/user_(\\d+)/i);\r\n                if (author !== null)\r\n                    author = '[b][user]' + author[1] + '[/user][/b] ';\r\n                else {\r\n                    author = document.querySelector('#' + postid[0] + ' a[href^=\"/user.php?\"]');\r\n                    if (author !== null) {\r\n                        author = author.href.match(/id=(\\d+)/i);\r\n                        author = (author !== null ? '[b][user]' + author[1] + '[/user][/b] ' : '');\r\n                    }\r\n                    else\r\n                        author = '';\r\n                }\r\n\r\n                creation = document.querySelector('div#' + postid[0] + ' > div > div > p.posted_info > span');\r\n                if (creation === null)\r\n                    creation = document.querySelector('div#' + postid[0] + ' > div > span > span.usercomment_posttime');\r\n                if (creation !== null)\r\n                    creation = ' on ' + formattedUTCString(creation.title.replace(/-/g, '/'));\r\n                else\r\n                    creation = '';\r\n\r\n                res = author + '[url=' + window.location.pathname + window.location.search + '#' + postid[0] + ']wrote' + creation + '[/url]:\\n[quote]' + res + '[/quote]\\n\\n';\r\n            }\r\n\r\n            document.getElementById('quickpost').value += res;\r\n\r\n            var sel = document.getElementById('quickpost');\r\n            if (sel !== null)\r\n                sel.scrollIntoView();\r\n        }\r\n\r\n        document.addEventListener('keydown', function (e) {\r\n            if ((e.ctrlKey) && (e.keyCode === 'V'.charCodeAt(0)))\r\n                QUOTEALL();\r\n        });\r\n    })();\r\n    /* End src/ab_hyper_quote.user.js */\r\n\r\n\r\n    /* Begin src/ab_keyboard_shortcuts.user.js */\r\n    // ==UserScript==\r\n    // @name        AnimeBytes - Forum Keyboard Shortcuts\r\n    // @author      Alpha, modified by Megure\r\n    // @description Enables keyboard shortcuts for forum (new post and edit) and PM\r\n    // @include     https://animebytes.tv/*\r\n    // @version     0.1.2\r\n    // @icon        http://animebytes.tv/favicon.ico\r\n    // @grant       GM_setValue\r\n    // @grant       GM_getValue\r\n    // @require     https://github.com/momentary0/AB-Userscripts/raw/master/delicious-library/src/ab_delicious_library.js\r\n    // ==/UserScript==\r\n\r\n\r\n    // Keyboard shortcuts by Alpha, mod by Megure\r\n    // Enables keyboard shortcuts for forum (new post and edit) and PM\r\n    (function ABKeyboardShortcuts() {\r\n        var _debug = false;\r\n\r\n        var _enabled = delicious.settings.basicScriptCheckbox(\r\n            'deliciouskeyboard',\r\n            'Delicious Keyboard Shortcuts',\r\n            'Keyboard shortcuts to make typing BBCode easier.'\r\n        );\r\n        if (!_enabled)\r\n            return;\r\n        if (document.querySelector('textarea') === null)\r\n            return;\r\n\r\n        function custom_insert_text(open, close) {\r\n            var sel;\r\n            var elem = document.activeElement;\r\n            if (elem.selectionStart || elem.selectionStart == '0') {\r\n                var startPos = elem.selectionStart;\r\n                var endPos = elem.selectionEnd;\r\n                elem.value = elem.value.substring(0, startPos) + open + elem.value.substring(startPos, endPos) + close + elem.value.substring(endPos, elem.value.length);\r\n                elem.selectionStart = elem.selectionEnd = endPos + open.length + close.length;\r\n                elem.focus();\r\n                if (close.length == 0)\r\n                    elem.setSelectionRange(startPos + open.length, startPos + open.length);\r\n                else\r\n                    elem.setSelectionRange(startPos + open.length, endPos + open.length);\r\n            } else if (document.selection && document.selection.createRange) {\r\n                elem.focus();\r\n                sel = document.selection.createRange();\r\n                sel.text = open + sel.text + close;\r\n                if (close.length != 0) {\r\n                    sel.move(\"character\", -close.length);\r\n                    sel.select();\r\n                }\r\n                elem.focus();\r\n            } else {\r\n                elem.value += open;\r\n                elem.focus();\r\n                elem.value += close;\r\n            }\r\n        }\r\n\r\n        var ctrlorcmd = (navigator.appVersion.indexOf('Mac') != -1) ? '⌘' : 'Ctrl';\r\n        var insertedQueries = [];\r\n\r\n        function insert(e, key, ctrl, alt, shift, open, close, query) {\r\n            /* Function to handle detecting key combinations and inserting the\r\n            shortcut text onto the relevent buttons. */\r\n            if (_debug) {\r\n                //console.log(String.fromCharCode((96 <= key && key <= 105)? key-48 : key));\r\n                console.log(String.fromCharCode(e.charCode));\r\n                console.log(e.ctrlKey);\r\n                console.log(e.metaKey);\r\n                console.log(e.altKey);\r\n                console.log(e.shiftKey);\r\n            }\r\n            // Javascript has some discrepancies with symbols and their keycodes.\r\n            var keyCode;\r\n            switch (key) {\r\n            case '.':\r\n                keyCode = 190;\r\n                break;\r\n            case '/':\r\n                keyCode = 191;\r\n                break;\r\n            default:\r\n                keyCode = key.charCodeAt(0);\r\n            }\r\n\r\n            // Checks if correct modifiers are pressed\r\n            if (document.activeElement.tagName.toLowerCase() === 'textarea' &&\r\n            (ctrl === (e.ctrlKey || e.metaKey)) &&\r\n            (alt === e.altKey) &&\r\n            (shift === e.shiftKey) &&\r\n            (e.keyCode === keyCode)) {\r\n                e.preventDefault();\r\n                custom_insert_text(open, close);\r\n                return false;\r\n            }\r\n\r\n            if (query !== undefined) {\r\n                if (insertedQueries.indexOf(query) === -1) {\r\n                    insertedQueries.push(query);\r\n                    var imgs = document.querySelectorAll(query);\r\n                    for (var i = 0; i < imgs.length; i++) {\r\n                        var img = imgs[i];\r\n                        img.title += ' (';\r\n                        if (ctrl) img.title += ctrlorcmd + '+';\r\n                        if (alt) img.title += 'Alt+';\r\n                        if (shift) img.title += 'Shift+';\r\n                        img.title += key + ')';\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        function keydownHandler(e) {\r\n            // Used as a keydown event handler.\r\n            // Defines all keyboard shortcuts.\r\n            /**\r\n                * All keyboard shortcuts based on MS Word\r\n                **/\r\n            // Bold\r\n            insert(e, 'B', true, false, false, '[b]', '[/b]', '#bbcode img[title=\"Bold\"]');\r\n            // Italics\r\n            insert(e, 'I', true, false, false, '[i]', '[/i]', '#bbcode img[title=\"Italics\"]');\r\n            // Underline\r\n            insert(e, 'U', true, false, false, '[u]', '[/u]', '#bbcode img[title=\"Underline\"]');\r\n            // Align right\r\n            insert(e, 'R', true, false, false, '[align=right]', '[/align]');\r\n            // Align left\r\n            insert(e, 'L', true, false, false, '[align=left]', '[/align]');\r\n            // Align center\r\n            insert(e, 'E', true, false, false, '[align=center]', '[/align]');\r\n            // Spoiler\r\n            insert(e, 'S', true, false, false, '[spoiler]', '[/spoiler]', '#bbcode img[title=\"Spoilers\"]');\r\n            // Hide\r\n            insert(e, 'H', true, false, false, '[hide]', '[/hide]', '#bbcode img[title=\"Hide\"]');\r\n            // YouTube\r\n            insert(e, 'Y', true, true, false, '[youtube]', '[/youtube]', '#bbcode img[alt=\"YouTube\"]');\r\n            // Image\r\n            insert(e, 'G', true, false, false, '[img]', '[/img]', '#bbcode img[title=\"Image\"]');\r\n            // Bullet point and numbered list\r\n            insert(e, '.', true, false, false, '[*] ', '', '#bbcode img[title=\"Unordered list\"]');\r\n            insert(e, '/', true, false, false, '[#] ', '', '#bbcode img[title=\"Ordered list\"]');\r\n            // URL\r\n            insert(e, 'K', true, false, false, '[url=]', '[/url]', '#bbcode img[title=\"URL\"]');\r\n        }\r\n\r\n        var textAreas = document.querySelectorAll('textarea');\r\n        // inserts shortcuts into title text on load, rather than\r\n        // doing it when first key is pressed.\r\n        keydownHandler({});\r\n        for (var i = 0; i < textAreas.length; i++) {\r\n            textAreas[i].addEventListener('keydown', keydownHandler, false);\r\n        }\r\n\r\n        function mutationHandler(mutations, observer) {\r\n            _debug && console.log(mutations);\r\n            if (mutations[0].addedNodes.length) {\r\n                var textAreas = document.querySelectorAll('textarea');\r\n                for (var i = 0; i < textAreas.length; i++) {\r\n                    textAreas[i].addEventListener('keydown', keydownHandler, false);\r\n                }\r\n            }\r\n        }\r\n\r\n        // Watch for new textareas (e.g. forum edit post)\r\n        var mutationObserver = new MutationObserver(mutationHandler);\r\n        mutationObserver.observe(document.querySelector('body'), { childList: true, subtree: true });\r\n    })();\r\n    /* End src/ab_keyboard_shortcuts.user.js */\r\n\r\n\r\n    /* Begin src/ab_title_inverter.user.js */\r\n    // ==UserScript==\r\n    // @name        AnimeBytes forums title inverter\r\n    // @author      potatoe\r\n    // @version     0.1.1\r\n    // @description Inverts the forums titles.\r\n    // @icon        https://animebytes.tv/favicon.ico\r\n    // @include     https://animebytes.tv/forums.php?*\r\n    // @match       https://animebytes.tv/forums.php?*\r\n    // @grant       GM_setValue\r\n    // @grant       GM_getValue\r\n    // @require     https://github.com/momentary0/AB-Userscripts/raw/master/delicious-library/src/ab_delicious_library.js\r\n    // ==/UserScript==\r\n\r\n    // Forums title inverter by Potatoe\r\n    // Inverts the forums titles.\r\n    (function ABTitleInverter() {\r\n        var _enabled = delicious.settings.basicScriptCheckbox(\r\n            'delicioustitleflip',\r\n            'Delicious Title Flip',\r\n            'Flips the tab title.'\r\n        );\r\n        if (!_enabled)\r\n            return;\r\n\r\n        if (document.title.indexOf(' > ') !== -1) {\r\n            document.title = document.title.split(\" :: \")[0].split(\" > \").reverse().join(\" < \") + \" :: AnimeBytes\";\r\n        }\r\n    })();\r\n    /* End src/ab_title_inverter.user.js */\r\n\r\n\r\n    /* Begin src/ab_title_notifications.user.js */\r\n    // ==UserScript==\r\n    // @name        AnimeBytes - Title Notifications\r\n    // @author      Megure\r\n    // @description Will prepend the number of notifications to the title\r\n    // @include     https://animebytes.tv/*\r\n    // @version     0.1.1\r\n    // @icon        http://animebytes.tv/favicon.ico\r\n    // @grant       GM_setValue\r\n    // @grant       GM_getValue\r\n    // @require     https://github.com/momentary0/AB-Userscripts/raw/master/delicious-library/src/ab_delicious_library.js\r\n    // ==/UserScript==\r\n\r\n    // Title Notifications by Megure\r\n    // Will prepend the number of notifications to the title\r\n    (function ABTitleNotifications() {\r\n        var _enabled = delicious.settings.basicScriptCheckbox(\r\n            'delicioustitlenotifications',\r\n            'Delicious Title Notifications',\r\n            'Display number of notifications in the tab title.'\r\n        );\r\n        if (!_enabled)\r\n            return;\r\n\r\n        var new_count = 0, _i, cnt, notifications = document.querySelectorAll('#alerts .new_count'), _len = notifications.length;\r\n        for (_i = 0; _i < _len; _i++) {\r\n            cnt = parseInt(notifications[_i].textContent, 10);\r\n            if (!isNaN(cnt))\r\n                new_count += cnt;\r\n        }\r\n        if (new_count > 0)\r\n            document.title = '(' + new_count + ') ' + document.title;\r\n    })();\r\n    /* End src/ab_title_notifications.user.js */\r\n\r\n\r\n    /* Begin src/ab_unread_index.user.js */\r\n    // ==UserScript==\r\n    // @name AnimeBytes Unread Index\r\n    // @author potatoe\r\n    // @version 1.12.1\r\n    // @description Adds the top new unread forum posts to AnimeBytes index page.\r\n    // @icon https://animebytes.tv/favicon.ico\r\n    // @include https://animebytes.tv/\r\n    // @include https://animebytes.tv/index.php\r\n    // @include https://animebytes.tv/user.php?action=edit\r\n    // @match https://animebytes.tv/\r\n    // @match https://animebytes.tv/index.php\r\n    // @match https://animebytes.tv/user.php?action=edit\r\n    // @grant       GM_setValue\r\n    // @grant       GM_getValue\r\n    // @require https://github.com/momentary0/AB-Userscripts/raw/master/delicious-library/src/ab_delicious_library.js\r\n    // ==/UserScript==\r\n\r\n    delicious.settings.init('ABGamesForum', false);\r\n    delicious.settings.init('unreadindx', false);\r\n    delicious.settings.init('ABNoT', 5);\r\n    if (delicious.settings.ensureSettingsInserted()) {\r\n        var section = delicious.settings.createCollapsibleSection('Unread Index');\r\n        var s = section.querySelector('.settings_section_body');\r\n        s.appendChild(delicious.settings.createCheckbox(\r\n            'unreadindx',\r\n            'Enable',\r\n            'Enable/Disable Unread Index script.'\r\n        ));\r\n        s.appendChild(delicious.settings.createCheckbox(\r\n            'ABGamesForum',\r\n            'Unread forums in index(News Page)',\r\n            'Hide those hideous \"Forum Games\" on your unread index page!'\r\n        ));\r\n\r\n        s.appendChild(delicious.settings.createNumberInput(\r\n            'ABNoT',\r\n            'Number of threads',\r\n            'set the number of threads to show'\r\n        ));\r\n        delicious.settings.insertSection(section);\r\n    }\r\n    var _enabled = delicious.settings.get('unreadindx');\r\n    if (!_enabled)\r\n        return;\r\n    var unread_tablenode;\r\n    var dividernode = document.createElement('div');\r\n    dividernode.className = 'divider';\r\n    var newsnode = document.getElementById('news');\r\n    function ABUnreadIndex () {\r\n        var unread_doc = document.implementation.createHTMLDocument('');\r\n        var xmlhttp = new XMLHttpRequest();\r\n        xmlhttp.onreadystatechange = function () {\r\n            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {\r\n                unread_doc.documentElement.innerHTML = xmlhttp.responseText;\r\n                unread_tablenode = unread_doc.evaluate(\"//div[@id='content']/div[@class='thin']/table[@width='100%']\", unread_doc, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;\r\n                var unread_posts = 0;\r\n                for (let j = 0; j < 2; j++) unread_tablenode.rows[0].cells[j].style.padding = '8px';\r\n                unread_tablenode.rows[0].cells[0].style.width = '30%';\r\n                unread_tablenode.rows[0].cells[1].style.width = '70%';\r\n                unread_tablenode.rows[0].deleteCell(2);\r\n                var row = unread_tablenode.rows[1];\r\n                for (let i = 1; row; i++) {\r\n                    row = unread_tablenode.rows[i];\r\n                    if (row == null) break;\r\n                    if ((delicious.settings.get('ABGamesForum') === true && row.cells[0].getElementsByTagName('a')[0].textContent.trim() === \"Forum Games\") || (unread_posts === delicious.settings.get('ABNoT'))){\r\n                        unread_tablenode.deleteRow(i);\r\n                        i--;\r\n                    } else if (unread_posts < delicious.settings.get('ABNoT')) {\r\n                        for (let j = 0; j < 2; j++) row.cells[j].style.padding = '0px';\r\n                        //row.cells[0].getElementsByTagName('p')[0].innerHTML += \"<div style='font-size: 8px;'>&nbsp;</div>\";\r\n                        row.cells[1].getElementsByTagName('p')[0].innerHTML += \"<div style='font-size: 8px;'>\" + row.cells[2].getElementsByTagName('p')[0].innerHTML + '</div>';\r\n                        row.deleteCell(2);\r\n                        unread_posts++;\r\n                    }\r\n                }\r\n                unread_tablenode.style.marginBottom = '20px';\r\n                newsnode.parentNode.insertBefore(unread_tablenode, newsnode);\r\n                newsnode.parentNode.insertBefore(dividernode, newsnode);\r\n            }\r\n        };\r\n        xmlhttp.open('GET', '/forums.php?action=viewunread', true);\r\n        xmlhttp.send();\r\n\r\n    }\r\n    if (newsnode !== null) {\r\n        ABUnreadIndex();\r\n    }\r\n    /* End src/ab_unread_index.user.js */\r\n\r\n\r\n    /* Begin src/ab_yen_stats.user.js */\r\n    // ==UserScript==\r\n    // @name        AB - Yen per X and ratio milestones\r\n    // @author      Megure, Lemma, NSC, et al.\r\n    // @description Yen per X and ratio milestones, by Megure, Lemma, NSC, et al.\r\n    // @include     https://animebytes.tv/user.php*\r\n    // @version     0.1.1\r\n    // @icon        http://animebytes.tv/favicon.ico\r\n    // @grant       GM_setValue\r\n    // @grant       GM_getValue\r\n    // @require     https://github.com/momentary0/AB-Userscripts/raw/master/delicious-library/src/ab_delicious_library.js\r\n    // ==/UserScript==\r\n\r\n    // Yen per X and ratio milestones, by Megure, Lemma, NSC, et al.\r\n    (function ABYenStats() {\r\n        var _debug = false;\r\n        delicious.settings.init('deliciousyenperx', true);\r\n        delicious.settings.init('deliciousratio', true);\r\n        delicious.settings.basicScriptCheckbox('deliciousyenperx', 'Delicious Yen Per X',\r\n            'Shows how much yen you receive per X and as upload equivalent.');\r\n        delicious.settings.basicScriptCheckbox('deliciousratio', 'Delicious Ratio',\r\n            'Shows ratio, raw ratio and how much upload/download you need for certain ratio milestones.');\r\n\r\n        var _debug = false;\r\n\r\n        if (!/user\\.php\\?id=/i.test(document.URL))\r\n            return;\r\n\r\n        function compoundInterest(years) {\r\n            return (Math.pow(2, years) - 1) / Math.log(2);\r\n        }\r\n        function formatInteger(num) {\r\n            var res = '';\r\n            while (num >= 1000) {\r\n                res = ',' + ('00' + (num % 1000)).slice(-3) + res;\r\n                num = Math.floor(num / 1000);\r\n            }\r\n            return num + res;\r\n        }\r\n        function bytecount(num, unit) {\r\n            // For whatever reason, this was always called with .toUpperCase()\r\n            // by the original author, but newer KiB style prefixes have\r\n            // a lowercase. Keeping both for compatibility.\r\n            switch (unit) {\r\n            case 'B':\r\n                return num * Math.pow(1024, 0);\r\n            case 'KiB':\r\n            case 'KIB':\r\n                return num * Math.pow(1024, 1);\r\n            case 'MiB':\r\n            case 'MIB':\r\n                return num * Math.pow(1024, 2);\r\n            case 'GiB':\r\n            case 'GIB':\r\n                return num * Math.pow(1024, 3);\r\n            case 'TiB':\r\n            case 'TIB':\r\n                return num * Math.pow(1024, 4);\r\n            case 'PiB':\r\n            case 'PIB':\r\n                return num * Math.pow(1024, 5);\r\n            case 'EiB':\r\n            case 'EIB':\r\n                return num * Math.pow(1024, 6);\r\n            }\r\n        }\r\n        function humancount(num) {\r\n            if (num == 0) return '0 B';\r\n            var i = Math.floor(Math.log(Math.abs(num)) / Math.log(1024));\r\n            num = (num / Math.pow(1024, i)).toFixed(2);\r\n            switch (i) {\r\n            case 0:\r\n                return num + ' B';\r\n            case 1:\r\n                return num + ' KiB';\r\n            case 2:\r\n                return num + ' MiB';\r\n            case 3:\r\n                return num + ' GiB';\r\n            case 4:\r\n                return num + ' TiB';\r\n            case 5:\r\n                return num + ' PiB';\r\n            case 6:\r\n                return num + ' EiB';\r\n            default:\r\n                return num + ' × 1024^' + i + ' B';\r\n            }\r\n        }\r\n        var dt, dd;\r\n        function addDefinitionAfter(after, definition, value, cclass) {\r\n            dt = document.createElement('dt');\r\n            dt.appendChild(document.createTextNode(definition));\r\n            dd = document.createElement('dd');\r\n            if (cclass !== undefined) dd.className += cclass;\r\n            dd.appendChild(document.createTextNode(value));\r\n            after.parentNode.insertBefore(dd, after.nextElementSibling.nextSibling);\r\n            after.parentNode.insertBefore(dt, after.nextElementSibling.nextSibling);\r\n            return dt;\r\n        }\r\n        function addDefinitionBefore(before, definition, value, cclass) {\r\n            dt = document.createElement('dt');\r\n            dt.appendChild(document.createTextNode(definition));\r\n            dd = document.createElement('dd');\r\n            if (cclass !== undefined) dd.className += cclass;\r\n            dd.appendChild(document.createTextNode(value));\r\n            before.parentNode.insertBefore(dt, before);\r\n            before.parentNode.insertBefore(dd, before);\r\n            return dt;\r\n        }\r\n        function addRawStats() {\r\n            var tw, regExp = /([0-9,.]+)\\s*([A-Z]+)\\s*\\(([^)]*)\\)/i;\r\n            // Find text with raw stats\r\n            tw = document.createTreeWalker(document, NodeFilter.SHOW_TEXT, { acceptNode: function (node) { return /^Raw Uploaded:/i.test(node.data); } });\r\n            if (tw.nextNode() == null) return;\r\n            var rawUpMatch = tw.currentNode.data.match(regExp);\r\n            tw = document.createTreeWalker(tw.currentNode.parentNode.parentNode, NodeFilter.SHOW_TEXT, { acceptNode: function (node) { return /^Raw Downloaded:/i.test(node.data); } });\r\n            if (tw.nextNode() == null) return;\r\n            var rawDownMatch = tw.currentNode.data.match(regExp);\r\n            tw = document.createTreeWalker(document.getElementById('content'), NodeFilter.SHOW_TEXT, { acceptNode: function (node) { return /^\\s*Ratio/i.test(node.data); } });\r\n            if (tw.nextNode() == null) return;\r\n            var ratioNode = tw.currentNode.parentNode;\r\n            tw = document.createTreeWalker(document.getElementById('content'), NodeFilter.SHOW_TEXT, { acceptNode: function (node) { return /^\\s*Uploaded/i.test(node.data); } });\r\n            if (tw.nextNode() == null) return;\r\n            var ulNode = tw.currentNode.parentNode;\r\n            tw = document.createTreeWalker(document.getElementById('content'), NodeFilter.SHOW_TEXT, { acceptNode: function (node) { return /^\\s*Downloaded/i.test(node.data); } });\r\n            if (tw.nextNode() == null) return;\r\n            var dlNode = tw.currentNode.parentNode;\r\n\r\n            var ul = ulNode.nextElementSibling.textContent.match(regExp);\r\n            var dl = dlNode.nextElementSibling.textContent.match(regExp);\r\n            _debug && console.log(ul);\r\n            _debug && console.log(dl);\r\n            var uploaded = bytecount(parseFloat(ul[1].replace(/,/g, '')), ul[2].toUpperCase());\r\n            var downloaded = bytecount(parseFloat(dl[1].replace(/,/g, '')), dl[2].toUpperCase());\r\n            var rawuploaded = bytecount(parseFloat(rawUpMatch[1].replace(/,/g, '')), rawUpMatch[2].toUpperCase());\r\n            var rawdownloaded = bytecount(parseFloat(rawDownMatch[1].replace(/,/g, '')), rawDownMatch[2].toUpperCase());\r\n            var rawRatio = Infinity;\r\n            if (bytecount(parseFloat(rawDownMatch[1].replace(/,/g, '')), rawDownMatch[2].toUpperCase()) > 0)\r\n                rawRatio = (bytecount(parseFloat(rawUpMatch[1].replace(/,/g, '')), rawUpMatch[2].toUpperCase()) / bytecount(parseFloat(rawDownMatch[1].replace(/,/g, '')), rawDownMatch[2].toUpperCase())).toFixed(2);\r\n\r\n            // Color ratio\r\n            var color = 'r99';\r\n            if (rawRatio < 1)\r\n                color = 'r' + ('0' + Math.ceil(10 * rawRatio)).slice(-2);\r\n            else if (rawRatio < 5)\r\n                color = 'r20';\r\n            else if (rawRatio < 99)\r\n                color = 'r50';\r\n\r\n            // Add to user stats after ratio\r\n            var hr = document.createElement('hr');\r\n            hr.style.clear = 'both';\r\n            ratioNode.parentNode.insertBefore(hr, ratioNode.nextElementSibling.nextSibling);\r\n            var rawRatioNode = addDefinitionAfter(ratioNode, 'Raw Ratio:', rawRatio, color);\r\n            addDefinitionAfter(ratioNode, 'Raw Downloaded:', rawDownMatch[0]);\r\n            addDefinitionAfter(ratioNode, 'Raw Uploaded:', rawUpMatch[0]);\r\n            ratioNode.nextElementSibling.title = 'Ratio\\t  Buffer';\r\n            rawRatioNode.nextElementSibling.title = 'Raw ratio\\t Raw Buffer';\r\n\r\n            function printBuffer(u, d, r) {\r\n                if (u / r - d >= 0)\r\n                    return '\\n' + r.toFixed(1) + '\\t' + (humancount(u / r - d)).slice(-10) + '    \\tcan be downloaded';\r\n                else\r\n                    return '\\n' + r.toFixed(1) + '\\t' + (humancount(d * r - u)).slice(-10) + '    \\tmust be uploaded';\r\n            }\r\n            for (var i = 0; i < 10; i++) {\r\n                var myRatio = [0.2, 0.5, 0.7, 0.8, 0.9, 1.0, 1.5, 2.0, 5.0, 10.0][i];\r\n                ratioNode.nextElementSibling.title += printBuffer(uploaded, downloaded, myRatio);\r\n                rawRatioNode.nextElementSibling.title += printBuffer(rawuploaded, rawdownloaded, myRatio);\r\n            }\r\n        }\r\n        function addYenPerStats() {\r\n            var dpy = 365.256363; // days per year\r\n            var tw = document.createTreeWalker(document.getElementById('content'), NodeFilter.SHOW_TEXT, { acceptNode: function (node) { return /Yen per day/i.test(node.data); } });\r\n            if (tw.nextNode() == null) return;\r\n            var ypdNode = tw.currentNode.parentNode;\r\n            var ypy = parseInt(ypdNode.nextElementSibling.textContent, 10) * dpy; // Yen per year\r\n            addDefinitionAfter(ypdNode, 'Yen per year:', formatInteger(Math.round(ypy * compoundInterest(1))));\r\n            addDefinitionAfter(ypdNode, 'Yen per month:', formatInteger(Math.round(ypy * compoundInterest(1 / 12))));\r\n            addDefinitionAfter(ypdNode, 'Yen per week:', formatInteger(Math.round(ypy * compoundInterest(7 / dpy))));\r\n            // 1 Yen = 1 MB = 1024^2 B * yen per year * interest for 1 s\r\n            var hr = document.createElement('hr');\r\n            hr.style.clear = 'both';\r\n            ypdNode.parentNode.insertBefore(hr, ypdNode);\r\n            addDefinitionBefore(ypdNode, 'Yen as upload:', humancount(Math.pow(1024, 2) * ypy * compoundInterest(1 / dpy / 24 / 60 / 60)) + '/s');\r\n            addDefinitionBefore(ypdNode, 'Yen per seconds:', (ypy * compoundInterest(1 / dpy / 24)/3600).toFixed(4));\r\n            addDefinitionBefore(ypdNode, 'Yen per minutes:', (ypy * compoundInterest(1 / dpy / 24)/60).toFixed(2));\r\n            addDefinitionBefore(ypdNode, 'Yen per hour:', (ypy * compoundInterest(1 / dpy / 24)).toFixed(1));\r\n        }\r\n        if (delicious.settings.get('deliciousratio')){\r\n            addRawStats();\r\n        }\r\n        if (delicious.settings.get('deliciousyenperx')){\r\n            addYenPerStats();\r\n        }\r\n\r\n    })();\r\n    /* End src/ab_yen_stats.user.js */\r\n\r\n\r\n})();"],"sourceRoot":""}