// ==UserScript==
// @name        AnimeBytes delicious user scripts (updated)
// @author      aldy, potatoe, alpha, Megure
// @version     2.1.3
// @description Userscripts to enhance AnimeBytes in various ways. (Updated by TheFallingMan)
// @match       https://*.animebytes.tv/*
// @icon        http://animebytes.tv/favicon.ico
// @grant       GM_getValue
// @grant       GM_setValue
// @require     https://github.com/momentary0/AB-Userscripts/raw/master/delicious-library/src/ab_delicious_library.js
// ==/UserScript==

!function(e){var t={};function __webpack_require__(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:false,exports:{}};return e[n].call(r.exports,r,r.exports,__webpack_require__),r.l=true,r.exports}__webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.d=function(e,t,n){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{enumerable:true,get:n})},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:true})},__webpack_require__.t=function(e,t){if(1&t&&(e=__webpack_require__(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(__webpack_require__.r(n),Object.defineProperty(n,"default",{enumerable:true,value:e}),2&t&&"string"!=typeof e)for(var r in e)__webpack_require__.d(n,r,function(t){return e[t]}.bind(null,r));return n},__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=0)}([function(e,t,n){"use strict";!function(){if(function(){for(var e=false,t=["ABTorrentsShowYen","ABTorrentsReqTime","ABSortTorrents","ABTorrentsFilter","ABHistDynLoad"],n=0;n<t.length;n++)delicious.settings.init(t[n],true);if(delicious.settings.init("ABTorrentsYenTimeFrame","24"),delicious.settings.ensureSettingsInserted()){var r=delicious.settings.createCollapsibleSection("Enhanced Torrent View"),o=r.querySelector(".settings_section_body");o.appendChild(delicious.settings.createCheckbox("ABTorrentsShowYen","Show yen generation","Show yen generation for torrents, with detailed information when hovered.")),o.appendChild(delicious.settings.createDropDown("ABTorrentsYenTimeFrame","Yen time frame","Shows yen generated in this amount of time.",[["Hour","1"],["Day","24"],["Week","168"]],{default:"24"})),o.appendChild(delicious.settings.createCheckbox("ABTorrentsReqTime","Show required seeding time","Shows minimal required seeding time for torrents in their description and when size is hovered.")),o.appendChild(delicious.settings.createCheckbox("ABTorrentsFilter","Filter torrents","Shows a box above torrent tables, where you can filter the torrents from that table.")),o.appendChild(delicious.settings.createCheckbox("ABSortTorrents","Sort torrents","Allows torrent tables to be sorted.")),o.appendChild(delicious.settings.createCheckbox("ABHistDynLoad","Dynamic history tables","Dynamically load more pages into the transfer history page.")),delicious.settings.insertSection(r)}e=false;var i=365.256363,l="true"===GM_getValue("ABTorrentsShowYen","true"),a="true"===GM_getValue("ABTorrentsReqTime","true"),s="true"===GM_getValue("ABSortTorrents","true"),d="true"===GM_getValue("ABTorrentsFilter","true"),u="true"===GM_getValue("ABHistDynLoad","true"),c=parseInt(delicious.settings.get("ABTorrentsYenTimeFrame","24"),10),p=c+" hours";1===c?p="hour":24===c?p="day":168===c&&(p="week");var h=Math.round(Math.log(c)/Math.LN10),g=/^([\d\.]+)\s(?:([a-zA-Z])i)?B(?:\s\(([\d\.]+)%\))?$/,m=/^(∞|\-\-|[\d\.]+)$/,v=/(and|\s)/gi,b=/^(?:(\d+)years?)?(?:(\d+)months?)?(?:(\d+)weeks?)?(?:(\d+)days?)?(?:(\d+)hours?)?(?:(\d+)minutes?)?(?:(\d+)seconds?)?(?:\s*\([^)]*\)\s*)*$/,y=/^(\d+)\-(\d{1,2})\-(\d{1,2})\s+(\d{1,2}):(\d{1,2})$/,C=/^(?:[¥|€|£|\$]\s*)([\d\.]+)$/;function get_column(e,t){for(var n=e.cells,r=0,o=0,i=n.length;o<i;o++){var l=n[o];if(l===t)break;r+=l.colSpan}return r}function get_cell(e,t){for(var n=e.cells,r=0,o=0,i=n.length;o<i;o++){var l=n[o];if(r===t)return l;r+=l.colSpan}return null}function get_next_separator_element_sibling(e){for(;null!=e&&0!==e.id.indexOf("group_")&&-1===e.className.indexOf("edition_info");)e=e.nextElementSibling;return e}function get_corresponding_torrent_row(e){var t=e.querySelector('a[title="Download"]');if(null!==t){var n=t.href.match(/torrent\/(\d+)\/download/i);if(null!==n){var r=document.getElementById("torrent_"+n[1]);if(r!==e)return r}}return null}function duration_to_string(e){var t=Math.floor(e/24),n=Math.floor(e%24),r=Math.ceil(60*e%60),o=t+" days";return n>0&&(o+=0===r?" and ":", ",o+=n+" hours"),r>0&&(o+=" and "+r+" minutes"),o}function yen_to_string(e){return e.toFixed(Math.max(2-h,0))}var N=1;function f_duration(t){var n=((new Date).getTime()-parseInt(GM_getValue("creation","0"),10))/1e3/60/60;return e&&console.log("age: "+n),e&&console.log("duration: "+t),Math.min(t,n)/(24*i)+2}function f_size(e){return Math.max(.1,Math.sqrt(e))/4}function f_seeders(e){return e>3?3/Math.sqrt(e+4):2}var _=2-1/(1+Math.exp(5-((new Date).getTime()-parseInt(GM_getValue("creation","0"),10))/1728e6));function f(e,t,n){return f_size(e)*f_seeders(t)*f_duration(n)*_*c*N}isNaN(_)&&(_=1);var x=false;function toggle_yen(e){return void 0===e&&(e=true),function(){e&&(x=true!==x);for(var t=document.querySelectorAll("th.UserScriptToggleYenPerGB,td.UserScriptToggleYenPerGB"),n=0,r=t.length;n<r;n++){t[n].style.display=x?"":"none"}for(var o=0,i=(t=document.querySelectorAll("th.UserScriptToggleYen,td.UserScriptToggleYen")).length;o<i;o++){t[o].style.display=x?"none":""}}}function parse_cell(e){var t=e.textContent.trim(),n=t.replace(/,/g,"").trim(),r=e.querySelector("img");if(""===e.textContent&&null!==r)return r.alt.toUpperCase();var o=n.match(g);if(null!==o)return parseFloat(o[1])*function(e){if(void 0===e)return 1/1073741824;switch(e.toUpperCase()){case"":return 1/1073741824;case"K":return 1/1048576;case"M":return 1/1024;case"G":return 1;case"T":return 1024;case"P":return 1048576;case"E":return 1073741824;default:return 0}}(o[2]);if(null!==(o=n.match(y)))return new Date(parseInt(o[1],10),parseInt(o[2],10)-1,parseInt(o[3],10),parseInt(o[4],10),parseInt(o[5],10));if(null!==(o=n.replace(v,"").match(b))){for(var l=[],a=1,s=o.length;a<s;a++){var d=o[a];l.push(void 0!==d?parseInt(d,10):0)}return 24*(l[0]*i+l[1]*i/12+7*l[2]+l[3])+l[4]+l[5]/60+l[6]/3600}if(null!==(o=n.match(C)))return parseFloat(o[1]);if(null!==(o=n.match(m)))switch(o[1]){case"∞":return 1/0;case"--":return-.2;case"0":return-.1;default:return parseFloat(o[1])}return/^Never(\s*\([^)]*\)\s*)*$/i.test(n)?0:t.toUpperCase()}function parse_row(t,n,r,o,d){var u=get_cell(t,n),h=get_cell(t,r),g=get_cell(t,o),m=null!==n&&null!==u?parse_cell(u):1,y=null!==r&&null!==h?parse_cell(h):6,C=null!==o&&null!==g?parse_cell(g):0,x=get_corresponding_torrent_row(t);if(null!==n&&a){var S=5*Math.max(0,m-10)+72;if(u.title="You need to seed this torrent for at least\n"+duration_to_string(S)+"\nor it will become a hit and run!",null!==x){var E=x.querySelector("blockquote");null!==E&&(E.appendChild(document.createElement("br")),E.innerHTML+='You need to seed this torrent for at least <span class="r01">'+duration_to_string(S)+"</span> or it will become a hit and run!")}}if(null!==n&&null!==r&&l){e&&console.log("adding yen to row: "+t.innerHTML);var T=function(e,t,n){var r="Click to toggle between Yen per "+p+"\nand Yen per "+p+" per GB of size.\n\n";r+="¥"+(f_seeders(1)*f_duration(0)*c*f_size(e)).toPrecision(6)+" \tbase for size";var o=(100*(N-1)).toFixed(1);"0.0"!==o&&(r+="\n+"+o+"% \tfor interest per "+p),"0.0"!==(o=(100*(_-1)).toFixed(1))&&(r+="\n+"+o+"% \tfor your account's age"),"0.0"!==(o=(100*(f_duration(n)/f_duration(0)-1)).toFixed(1))&&(r+="\n+"+o+"% \tfor your seeding time"),"0.0"!==(o=(100*(f_seeders(t)/f_seeders(1)-1)).toFixed(1))&&(r+="\n"+o+"% \tfor the number of seeders"),r+="\n\n¥ per "+p+" \t¥ per "+p+" per GB\t#seeders\n";for(var i=Math.max(t-1,3),l=Math.max(t+1,3),a=i;a<=l;a++)r+="¥"+f(e,a,n).toPrecision(6)+"  \t",r+="¥"+(f(e,a,n)/e).toPrecision(6)+" \t\t",3===a&&(r+="≤"),r+=a,a!==l&&(r+="\n");return r}(m,y,C),w=document.createElement("td");w.textContent="¥"+yen_to_string(f(m,y,C)),w.title=T,w.className="UserScriptToggleYen";var B=document.createElement("td");B.textContent="¥"+yen_to_string(f(m,y,C)/m),B.title=T,B.className="UserScriptToggleYenPerGB",B.style.display="none",w.addEventListener("click",toggle_yen()),B.addEventListener("click",toggle_yen()),t.appendChild(B),t.appendChild(w)}var L=[t,x];if(s)for(var F=t.cells,M=0,k=F.length;M<k;M++){var A=F[M];if(L.push(parse_cell(A)),A.colSpan>1)for(var O=2;O<=A.colSpan;O++)L.push(null)}if(null!==d&&null!==o){var q=get_cell(t,o).textContent.replace(/^[^(]*(\(|$)/,"").replace(/\s*left\s*\)[^)]*$/,"").replace(v,"").match(b),I=(0).toFixed(4);if(null!==q){for(var D=[],U=1,R=q.length;U<R;U++){var P=q[U];D.push(void 0!==P?parseInt(P,10):0)}I=(24*(D[0]*i+D[1]*i/12+7*D[2]+D[3])+D[4]+D[5]/60+D[6]/3600).toFixed(4)}for(;I.length<16;)I="0"+I;L[d+2]=I+L[d+2]}return L}function parse_table(e){for(var t=null,n=null,r=null,o=null,i=e.querySelector("tr"),a=i.cells,c=0,h=0,f=a.length;h<f;h++){var g=a[h],m=g.textContent.replace(/\u00a0/g," ").trim().toLowerCase(),v=g.title.trim().toLowerCase();null!==t||"size"!==m&&"size"!==v&&null===g.querySelector('*[title="Size"]')||(t=c),null!==n||"seeders"!==v&&null===g.querySelector('*[title="Seeders"]')||(n=c),null!==r||"seeding time"!==m&&"seed time"!==m||(r=c),null===o&&"h&r"===m&&(o=c),c+=g.colSpan}if(null!==t&&null!==n&&l){var b=document.createElement(i.cells[0].nodeName);b.textContent="¥/"+p.charAt(0),b.title="¥ per "+p,b.className="UserScriptToggleYen";var y=document.createElement(i.cells[0].nodeName);y.textContent="¥/"+p.charAt(0)+"/GB",y.title="¥ per "+p+" per GB",y.className="UserScriptToggleYenPerGB",y.style.display="none",b.addEventListener("click",toggle_yen()),y.addEventListener("click",toggle_yen()),i.appendChild(y),i.appendChild(b);for(var C=e.querySelectorAll('tr.edition_info,tr.pad,tr[id^="group_"]'),N=0,_=C.length;N<_;N++){var x=C[N].cells;x[x.length-1].colSpan+=1}}for(var S=[],E=e.querySelectorAll("tr.torrent,tr.group_torrent"),T=0,w=E.length;T<w;T++)S.push(parse_row(E[T],t,n,r,o));var B=S[0][0].parentNode,L=null,F=true;function sort_by_index(e,t){return void 0===t&&(t=true),function(n){null!==n&&(n.stopPropagation(),n.preventDefault()),null!==e&&(L===e&&t?(F=true!==F,S.reverse()):(t&&(F=true),L=e,S.sort(function(e){return function(t,n){return null!==t[e+2]&&null!==n[e+2]?t[e+2]>n[e+2]?-1:t[e+2]<n[e+2]?1:0:null!==t[e+2]&&null===n[e+2]?-1:null!==n[e+2]&&null===t[e+2]?1:0}}(e)),F||S.reverse()));for(var r=0,o=S.length;r<o;r++){var i=S[r],l=get_next_separator_element_sibling(i[0]);null!==l?(B.insertBefore(i[0],l),null!==i[1]&&B.insertBefore(i[1],l)):(B.appendChild(i[0]),null!==i[1]&&i[0]!==i[1]&&B.appendChild(i[1]))}}}if(s&&S.length>1)for(var M=0,k=a.length;M<k;M++){var A=a[M],O=get_column(i,A),q=document.createElement("a");q.href="#",q.textContent="*",q.addEventListener("click",sort_by_index(O)),A.appendChild(q)}function load_history_page(e){return void 0===e&&(e=false),function(i){null!==i&&(i.stopPropagation(),i.preventDefault());var l=e?U--:R++;if(!(l<1||l>P)){if(1===l)for(var a=0,s=Y.length;a<s;a++){var d=Y[a];d.parentNode.removeChild(d)}if(l===P)for(var u=0,c=W.length;u<c;u++){var p=W[u];p.parentNode.removeChild(p)}var h=document.URL.split("#")[0];h=h.indexOf("page=")>=0?h.replace(/page=(\d+)/i,"page="+l):h+"&page="+l;var f=new XMLHttpRequest;f.open("GET",h,true),f.send(),f.onreadystatechange=function(){if(4===f.readyState){for(var e=(new DOMParser).parseFromString(f.responseText,"text/html").querySelectorAll("tr.torrent,tr.group_torrent"),i=0,l=e.length;i<l;i++)S.push(parse_row(e[i],t,n,r,o));sort_by_index(L,false)(null),toggle_yen(false)()}}}}}if(u){var I=document.URL.match(/page=(\d+)/i),D=null!=I?parseInt(I[1],10):1,U=D-1,R=D+1,P=1/0,G=[];if(null!==e.previousElementSibling){var H=e.previousElementSibling.querySelector("div.pagenums");null!==H&&G.push(H)}if(null!==e.nextElementSibling){var V=e.nextElementSibling.querySelector("div.pagenums");null!==V&&G.push(V)}for(var Y=[],W=[],X=0,$=G.length;X<$;X++){var z=G[X],K=z.lastElementChild;if(null!==K&&null!==K.href){var Q=K.href.match(/page=(\d+)/i);P=null!==Q?parseInt(Q[1],10):1}else P=parseInt(K.textContent.trim(),10),isNaN(P)&&(P=1);for(var j=z.parentNode.cloneNode(true),J=j.querySelector("div.pagenums");J.hasChildNodes();)J.removeChild(J.lastChild);if(D>1){var Z=document.createElement("a");Z.href="#",Z.className="next-prev",Z.textContent="← Load previous page dynamically",Z.addEventListener("click",load_history_page(true),true),J.appendChild(Z),Y.push(Z)}if(D<P){var ee=document.createElement("a");ee.href="#",ee.className="next-prev",ee.textContent="Load next page dynamically →",ee.addEventListener("click",load_history_page(false),true),J.appendChild(ee),W.push(ee)}z.parentNode.parentNode.insertBefore(j,z.parentNode.nextSibling)}}if(d&&E.length>1){var te=document.createElement("div"),ne=document.createElement("div"),re=document.createElement("div");te.className="box torrent_filter_box",ne.className="head colhead strong",re.className="body pad",re.style.display="none",ne.innerHTML='<a href="#"><span class="triangle-right-md"><span class="stext">+/-</span></span> Filter </a>',ne.addEventListener("click",function(e){null!==e&&(e.stopPropagation(),e.preventDefault());var t=ne.querySelector("span");"none"!==re.style.display?(re.style.display="none",t.className="triangle-right-md"):(function filter_torrent_table(e){var t={};if(e.hasChildNodes())for(var n=e.firstElementChild.querySelectorAll('input[type="checkbox"]'),r=0,o=n.length;r<o;r++){var i=n[r];i.checked||(t[i.value]=true)}for(var l=document.createElement("form"),a={},s=[],d=0,u=0,c=0,p=0,h=E.length;p<h;p++){var f=E[p],g=/freeleech/.test(f.className)||null!==f.querySelector('img[alt="Freeleech!"]'),m=null!==f.querySelector('img[alt="Remastered"]');d|=/Dual Audio/.test(f.cells[0].lastElementChild.textContent)?1:2,u|=g?1:2,c|=m?1:2}for(var v=0,b=E.length;v<b;v++){var y=E[v],C=get_corresponding_torrent_row(y),N=/freeleech/.test(y.className)||null!==y.querySelector('img[alt="Freeleech!"]'),_=null!==y.querySelector('img[alt="Remastered"]'),x=y.cells[0].lastElementChild.textContent,S=/Dual Audio/i.test(x),T=((x=x.replace(/^\s*»/i,"").replace(/\d+:\d+/g,"").replace(/Dual Audio/gi,"").replace(/\|(\s*\|)+/g,"|").replace(/^\s*\|/,"").replace(/\|\s*$/,"")).indexOf("|")>=0?x.split("|"):x.split("/")).map(function(e){return e.trim()});3===d&&T.push(S?"Dual Audio":"No Dual Audio"),3===u&&T.push(N?"Freeleech":"No Freeleech"),3===c&&T.push(_?"Remastered":"Not Remastered");for(var w=false,B=0;B<T.length;B++)if(t.hasOwnProperty(T[B])){w=true;break}for(var L=0;L<T.length;L++){var F=T[L];if(0===F.indexOf("ISO")&&T.splice(L+1,0,""),""!==F){for(a.hasOwnProperty(F)||(a[F]=0),w||(a[F]=1);s.length<=L;)s.push({});s[L].hasOwnProperty(F)||(s[L][F]=1)}}w?(y.style.display="none",null!==C&&(C.style.display="none")):(y.style.display="",null!==C&&(C.style.display=""))}if(s.length>0||Object.keys(t).length>0){for(var M={},k=0,A=s.length;k<A;k++){for(var O=Object.keys(s[k]).sort(function(e,t){return e.toUpperCase()>t.toUpperCase()?1:-1}),q=0,I=O.length;q<I;q++){var D=O[q];if(!M.hasOwnProperty(D)){M[D]=1;var U=document.createElement("label");U.innerHTML='<input type="checkbox" '+(null!=t[D]?"":'checked="checked"')+"> "+D,U.querySelector("input").value=D,U.style.marginRight="1em",U.style.display="inline-block",0!==a[D]||t.hasOwnProperty(D)||(U.style.opacity="0.25"),O.length<=1&&(U.style.opacity="0.5"),l.appendChild(U)}}l.appendChild(document.createElement("hr"))}for(;"HR"===l.lastElementChild.tagName;)l.removeChild(l.lastChild);l.addEventListener("change",function(t){filter_torrent_table(e)}),e.hasChildNodes()?e.replaceChild(l,e.firstElementChild):e.appendChild(l)}}(re),re.style.display="",t.className="triangle-down-md")}),te.appendChild(ne),te.appendChild(re),e.parentNode.insertBefore(te,e)}}if(l||a||s||u||d)for(var S=document.querySelectorAll("table.torrent_table,table.torrent_group"),E=0,T=S.length;E<T;E++)parse_table(S[E]);if(l&&(""+GM_getValue("creation","0")=="0"||"null"===GM_getValue("creation","0"))){var w=document.querySelector("div#header div#userinfo li#username_menu a.username"),B=document.querySelector("div#content h2 a");if(null!==document.URL.match(/\/user\.php\?id=/i)&&null!==w&&null!==B&&w.href===B.href)for(var L=document.querySelector("div#content div#user_rightcol div.userstatsleft dl.userprofile_list").children,F=0,M=L.length;F<M;F++){var k=L[F];if(-1!==k.textContent.indexOf("Join"))try{GM_setValue("creation",JSON.stringify(Date.parse(k.nextElementSibling.firstElementChild.title.replace(/( \d\d:\d\d) [A-Z]+$/,"$1"))))}catch(e){console.error(e)}}}}(),function(){delicious.settings._migrateStringSetting("deliciousflpoolposition"),delicious.settings.init("deliciousflpoolposition","after #userinfo_minor"),delicious.settings.init("deliciousfreeleechpool",true),delicious.settings.init("deliciousnavbarpiechart",true);var e=delicious.settings.init("deliciousflpiepositions",{navbar:delicious.settings.get("deliciousnavbarpiechart"),profile:delicious.settings.get("deliciousnavbarpiechart")});if(delicious.settings.ensureSettingsInserted()){var t=delicious.settings.createCollapsibleSection("Delicious Freeleech Pool"),n=t.querySelector(".settings_section_body");n.appendChild(delicious.settings.createCheckbox("deliciousfreeleechpool","Enable/Disable","Shows current freeleech pool progress in the navbar and on user pages (updated once an hour or when freeleech pool site is visited).")),n.appendChild(delicious.settings.createDropDown("deliciousflpoolposition","Navbar Position","Select position of freeleech pool progress in the navbar or disable it.",[["Before user info","before #userinfo_minor"],["After user info","after #userinfo_minor"],["Before menu","before .main-menu.nobullet"],["After menu","after .main-menu.nobullet"],["Don't display","none"]],{default:"after #userinfo_minor"})),n.appendChild(delicious.settings.createFieldSetSetting("deliciousflpiepositions","FL Pie Chart Locations",[["Navbar dropdown","navbar"],["User profile","profile"]])),delicious.settings.insertSection(t)}if(delicious.settings.get("deliciousfreeleechpool")){var r=false,o=delicious.settings.get("deliciousflpoolposition");if("none"!==o||/user\.php\?id=/i.test(document.URL)||/konbini\/pool/i.test(document.URL)){var i=document.createElement("p"),l=document.createElement("center"),a=document.createElement("p"),s=document.createElement("li"),d=document.createElement("a"),u=document.createElement("ul"),c=document.createElement("li");if(d.href="/konbini/pool",s.appendChild(d),e.navbar){var p=document.createElement("span");p.className+="dropit hover clickmenu",p.addEventListener("click",delicious.utilities.toggleSubnav),p.innerHTML+='<span class="stext">▼</span>',s.appendChild(p),u.appendChild(c),u.className="subnav nobullet",u.style.display="none",s.appendChild(u),s.className="navmenu",s.id="fl_menu"}if("none"!==o){o=o.split(" ");var h=document.querySelector(o[1]);null!==h&&(getFLInfo(),"after"===o[0]&&h.appendChild(s),"before"===o[0]&&h.insertBefore(s,h.firstChild))}if(updatePieChart(),e.profile&&/user\.php\?id=/i.test(document.URL)){var f=document.querySelector("#user_rightcol > .box");if(null!=f&&null!=document.createTreeWalker(f,NodeFilter.SHOW_TEXT,{acceptNode:function(e){return/Yen per day/i.test(e.data)}}).nextNode()){getFLInfo();var g=document.querySelector(".userstatsleft"),m=document.createElement("hr");m.style.clear="both",g.insertBefore(m,g.lastElementChild),g.insertBefore(l,g.lastElementChild),g.insertBefore(a,g.lastElementChild)}}if(/konbini\/pool/i.test(document.URL)){var v=document.createTreeWalker(document.getElementById("content"),NodeFilter.SHOW_TEXT,{acceptNode:function(e){return/^\s*Most Donated to This Box\s*$/i.test(e.data)}});null!==v.nextNode()&&v.currentNode.parentNode.insertBefore(i,v.currentNode.nextSibling)}}}function niceNumber(e){for(var t="";e>=1e3;)t=","+("00"+e%1e3).slice(-3)+t,e=Math.floor(e/1e3);return e+t}function getFLInfo(){function parseFLInfo(e){var t=e.querySelectorAll("#content .box.pad");if(!(t.length<3)){var n=t[0].textContent.match(/have ¥([0-9,]+) \/ ¥([0-9,]+)/i),r=parseInt(GM_getValue("FLPoolMax","50000000"),10),o=parseInt(GM_getValue("FLPoolCurrent","0"),10);null==n?null!=(n=t[0].textContent.match(/You must wait for freeleech to be over before donating/i))&&(o=r):(o=parseInt(n[1].replace(/,/g,""),10),r=parseInt(n[2].replace(/,/g,""),10)),null!=n&&(GM_setValue("FLPoolCurrent",o),GM_setValue("FLPoolMax",r)),null!=(n=t[0].textContent.match(/you've donated ¥([0-9,]+)/i))&&GM_setValue("FLPoolContribution",parseInt(n[1].replace(/,/g,""),10));for(var i=t[2].querySelector("table").querySelectorAll("tbody > tr"),l=[],a=[],s=[],d=[],u=0,c=0;c<i.length;c++){var p=i[c].querySelectorAll("td");l[c]=p[0].textContent,a[c]=p[0].querySelector("a").href,s[c]=parseInt(p[1].textContent.replace(/[,¥]/g,""),10),d[c]="red",u+=s[c]}if(o===r&&0===u)l[0]="Freeleech!",a[0]="https://animebytes.tv/konbini/pool",s[0]=o,d[0]="red",u=o;else{var h=l.length;l[h]="Other",a[h]="https://animebytes.tv/konbini/pool",s[h]=o-u,d[h]="lightgrey",l[h+1]="Missing",a[h+1]="https://animebytes.tv/konbini/pool",s[h+1]=r-o,d[h+1]="black"}GM_setValue("FLPoolLastUpdate",Date.now()),GM_setValue("FLPoolTitles",JSON.stringify(l)),GM_setValue("FLPoolHrefs",JSON.stringify(a)),GM_setValue("FLPoolAmounts",JSON.stringify(s)),GM_setValue("FLPoolColors",JSON.stringify(d))}}if(/konbini\/pool$/i.test(document.URL))parseFLInfo(document);else if(Date.now()-parseInt(GM_getValue("FLPoolLastUpdate","0"),10)>36e5&&false===r){r=true;try{var e=XPCNativeWrapper(new window.wrappedJSObject.XMLHttpRequest)}catch(t){e=new XMLHttpRequest}var t=new DOMParser;e.open("GET","https://animebytes.tv/konbini/pool",true),e.send(),e.onreadystatechange=function(){4===e.readyState&&(parseFLInfo(t.parseFromString(e.responseText,"text/html")),updatePieChart(),r=false)}}}function updatePieChart(){var t=function(){function circlePart(e,r,o,i){if(0==e)return"";var l=Math.sin(t),a=Math.cos(t),s=Math.sin(t-=2*Math.PI*e/n),d=Math.cos(t),u=0;2*e>n&&(u=1);var c=(100*e/n).toFixed(1)+"%\n"+niceNumber(e)+" ¥";return e===n&&(s=-1e-6,d=-1,u=1,l=0,a=-1),'<a xlink:href="'+o+'" xlink:title="'+r+"\n"+c+'"><path title="'+r+"\n"+c+'" stroke-width="0.01" stroke="grey" fill="'+i+'" d="M0,0 L'+s+","+d+" A1,1 0 "+u+",0 "+l+","+a+'z">\n<animate begin="mouseover" attributeName="d" to="M0,0 L'+1.1*s+","+1.1*d+" A1.1,1.1 0 "+u+",0 "+1.1*l+","+1.1*a+'z" dur="0.3s" fill="freeze" />\n<animate begin="mouseout"  attributeName="d" to="M0,0 L'+s+","+d+" A1,1 0 "+u+",0 "+l+","+a+'z" dur="0.3s" fill="freeze" />\n</path></a>\n\n'}var e='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="-1.11 -1.11 2.22 2.22" height="200px" width="100%"><title>Most Donated To This Box Pie-Chart</title>';try{for(var t=Math.PI,n=parseInt(GM_getValue("FLPoolMax","50000000"),10),r=JSON.parse(GM_getValue("FLPoolTitles","[]")),o=JSON.parse(GM_getValue("FLPoolHrefs","[]")),i=JSON.parse(GM_getValue("FLPoolAmounts","[]")),l=JSON.parse(GM_getValue("FLPoolColors","[]")),a=0;a<r.length;a++)e+=circlePart(i[a],r[a],o[a],l[a])}catch(e){console.error(e)}return e+"</svg>"}();i.innerHTML=t,a.innerHTML=t,e.navbar&&(c.innerHTML=t),l.innerHTML="We currently have ¥"+niceNumber(parseInt(GM_getValue("FLPoolCurrent","0"),10))+" / ¥"+niceNumber(parseInt(GM_getValue("FLPoolMax","50000000"),10))+" in our donation box.<br/>",l.innerHTML+="(That means we're ¥"+niceNumber(parseInt(GM_getValue("FLPoolMax","50000000"),10)-parseInt(GM_getValue("FLPoolCurrent","0"),10))+" away from getting sitewide freeleech!)<br/>",l.innerHTML+="<br>In total, you've donated ¥"+niceNumber(parseInt(GM_getValue("FLPoolContribution","0"),10))+" to the freeleech pool.<br/>",l.innerHTML+="Last Update: "+Math.round((Date.now()-parseInt(GM_getValue("FLPoolLastUpdate",Date.now()),10))/6e4)+" minutes ago.",d.textContent="FL: "+(100*parseInt(GM_getValue("FLPoolCurrent","0"),10)/parseInt(GM_getValue("FLPoolMax","50000000"),10)).toFixed(1)+"%",s.replaceChild(d,s.firstChild)}}(),function(){delicious.settings.init("ABForumSearchWorkInFS",true),delicious.settings.init("ABForumSearchWorkInRest",true);for(var e=["ABForumSearchHighlightBG","ABForumSearchHighlightFG","ABForumLoadText","ABForumLoadingText","ABForumToggleText"],t=0;t<e.length;t++)delicious.settings._migrateStringSetting(e[t]);if("none"===delicious.settings.get("ABForumSearchHighlightBG")&&delicious.settings.set("ABForumSearchHighlightBG",null),"none"===delicious.settings.get("ABForumSearchHighlightFG")&&delicious.settings.set("ABForumSearchHighlightFG",null),delicious.settings.ensureSettingsInserted()){var n=delicious.settings.createCollapsibleSection("Forum Search Enhancements"),r=n.querySelector(".settings_section_body");r.appendChild(delicious.settings.createCheckbox("ABForumSearchWorkInFS","Load posts into search results","Allows you to load posts and threads into search results, slide through posts and filter for authors.")),r.appendChild(delicious.settings.createColourSetting("ABForumSearchHighlightBG","Color for search terms","Background color for search terms within posts and headers.",{default:"#FFC000"})),r.appendChild(delicious.settings.createColourSetting("ABForumSearchHighlightFG","Color for search terms","Text color for search terms within posts and headers.",{default:"#000000"})),r.appendChild(delicious.settings.createCheckbox("ABForumEnhWorkInRest","Load posts into forum view","Allows you to load posts and threads into the general forum view.",{default:false})),r.appendChild(delicious.settings.createTextSetting("ABForumLoadText","Text for links to be loaded","The text to be shown for forum links that have not been loaded yet.",{default:"(Load) ",width:"8em"})),r.appendChild(delicious.settings.createTextSetting("ABForumLoadingText","Text for loading links","The text to be shown for forum links that are currently being loaded.",{default:"(Loading) ",width:"8em"})),r.appendChild(delicious.settings.createTextSetting("ABForumToggleText","Text for loaded links","The text to be shown for forum links that have been loaded and can now be toggled.",{default:"(Toggle) ",width:"8em"})),delicious.settings.insertSection(n)}if(/^http.*:\/\/animebytes\.tv\/forums\.php/i.test(document.URL)&&!/action=viewthread/i.test(document.URL)){var o,i,l,a,s,d,u,c,p,h,f,g,m,v,b,y,C,N,_,x,S,E,T,w,B,L,F,M,k,A,O,q;if(l=delicious.settings.get("ABForumSearchHighlightBG","#FFC000"),B=delicious.settings.get("ABForumSearchHighlightFG","#000000"),L=delicious.settings.get("ABForumToggleText","(Toggle) "),m=delicious.settings.get("ABForumLoadText","(Load) "),b=delicious.settings.get("ABForumLoadingText","(Loading) "),delicious.settings.get("ABForumSearchHideSubfor",true),O=delicious.settings.get("ABForumSearchWorkInFS",true)&&document.URL.indexOf("action=search")>=0,q=delicious.settings.get("ABForumEnhWorkInRest",false)&&(document.URL.indexOf("action=viewforum")>=0||-1===document.URL.indexOf("?")),delicious.settings.get("ABForumEnhFastSearch",true)&&document.URL.indexOf("action=viewforum"),M=[],_=[],T=[],s=[],u=function(e,t){for(;null!==e&&"BODY"!==e.tagName&&e.tagName!==t;)e=e.parentNode;return null===e||e.tagName!==t?null:e},w=function(e){var t,n,r;if(""!==y&&("none"!==l||"none"!==B))for(r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,false),t=r.nextNode(),n=RegExp("("+y+")","i");null!=t;)t.textContent.replace(n,function(e){var n,o,i;return n=[].slice.call(arguments),(i=t.splitText(n[n.length-2])).textContent=i.textContent.substr(e.length),o=document.createElement("span"),"none"!==l&&(o.style.backgroundColor=l),"none"!==B&&(o.style.color=B),o.appendChild(document.createTextNode(e)),t.parentNode.insertBefore(o,i),t=r.nextNode()}),t=r.nextNode()},C=function(e,t,n,r,o){return function(){var i,l,a,s,d,u,c,p,h,f,g,m,v,b,y,C;for(b="threadid="+t+"&page="+n,o.textContent=L,_[e]=[],_[e].parent=r,_[e].index=0,_[e].page=n,_[e].threadid=t,i=l=0,s=(g=T[b]).length;l<s;i=++l)g[i].id===e&&(_[e].index=i);for(C=(C=T[b][_[e].index].className.split("_"))[C.length-1],_[e].user=T[b][_[e].index].querySelector('.num_author > a[href^="/user"]').textContent,u=document.createElement("div"),h=document.createElement("div"),u.className="linkbox",h.className="pagenums",f=document.createElement("a"),p=document.createElement("a"),f.href="#",p.href="#",f.className="page-link",p.className="page-link",f.textContent="← Prev",p.textContent="Next →",h.appendChild(f),h.appendChild(p),u.appendChild(h),f.addEventListener("click",S(e,true),true),p.addEventListener("click",S(e,false),true),y=document.createElement("tr"),v=document.createElement("td"),c=0,a=0,d=(m=r.cells).length;a<d;a++)c+=m[a].colSpan;v.colSpan=c,v.appendChild(u),v.appendChild(T[b][_[e].index]),y.appendChild(v),_[e].td=v,_[e].parent.parentNode.insertBefore(y,_[e].parent.nextSibling)}},v=function(e,t){var n,r;T[n="threadid="+e+"&page="+t]="Loading",s[n]=[],(r=new XMLHttpRequest).open("GET","https://animebytes.tv/forums.php?action=viewthread&"+n,true),r.send(),r.onreadystatechange=function(){var e,t,o,i,l,a,d;if(4===r.readyState){for(l=new DOMParser,T[n]=l.parseFromString(r.responseText,"text/html").querySelectorAll('div[id^="post"]'),e=0,o=(a=T[n]).length;e<o;e++)w(a[e]);for(t=0,i=(d=s[n]).length;t<i;t++)(0,d[t])();return delete s[n]}}},g=function(e,t,n){return function(r){var o,i,l,a,c,p,h;null!=r&&(r.stopPropagation(),r.preventDefault()),l=e.previousSibling,a=u(e,"TR"),h=null!=(h=e.href.match(/threadid=(\d+)/i))?h[1]:"0",null!=(i=e.href.match(/([^#]*)(?:#post(\d+))?/i))&&((o=null!=i[2]?"post"+i[2]:o=t+e.href)in _?true===n?d(o)():F(o):(c=null!=(c=e.href.match(/page=(\d+)/i))?parseInt(c[1],10):1,e.previousSibling.textContent=b,(p="threadid="+h+"&page="+c)in T?"Loading"===T[p]?(s[p].push(C(o,h,c,a,l)),true===n&&s[p].push(d(o))):(C(o,h,c,a,l)(),true===n&&d(o)()):(v(h,c),s[p].push(C(o,h,c,a,l)),true===n&&s[p].push(d(o)))))}},F=function(e){var t;return"collapse"===(t=_[e]).td.parentNode.style.visibility?(S(e,null)(),t.td.parentNode.style.visibility="visible"):t.td.parentNode.style.visibility="collapse"},S=function(e,t){return function(n){var r,o,i,l;l="threadid="+(r=_[e]).threadid+"&page="+r.page,o="threadid="+r.threadid+"&page="+(r.page+1),i="threadid="+r.threadid+"&page="+(r.page-1),null!=n&&(n.stopPropagation(),n.preventDefault()),true===t?0===r.index&&r.page>1?i in T?"Loading"===T[i]?s[i].push(S(e,t)):(r.page=r.page-1,r.index=T[i].length-1,r.td.replaceChild(T[i][r.index],r.td.lastChild)):(v(r.threadid,r.page-1),s[i].push(S(e,t))):(r.index=Math.max(r.index-1,0),2===r.td.children.length?r.td.replaceChild(T[l][r.index],r.td.lastChild):r.td.appendChild(T[l][r.index])):false===t?24===r.index?o in T?"Loading"===T[o]?s[i].push(S(e,t)):T[o].length>0&&(r.page=r.page+1,r.index=0,r.td.replaceChild(T[o][0],r.td.lastChild)):(v(r.threadid,r.page+1),s[o].push(S(e,t))):(r.index=Math.min(r.index+1,T[l].length-1),2===r.td.children.length?r.td.replaceChild(T[l][r.index],r.td.lastChild):r.td.appendChild(T[l][r.index])):2===r.td.children.length?r.td.replaceChild(T[l][r.index],r.td.lastChild):r.td.appendChild(T[l][r.index])}},d=function(e){return function(){var t,n,r,o,i;for(t=_[e],o=true,n=0,r=M.length;n<r;n++)if(i=M[n],t.user.toUpperCase()===i.toUpperCase()){o=false;break}o&&(t.td.parentNode.style.visibility="collapse",t.parent.style.visibility="collapse")}},q||O)for(y=null!=(y=document.querySelector('form[action=""] input[name="search"]'))?y.value.trim().replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&").replace(/\s+/g,"|"):"",p=c=0,f=(i=document.querySelectorAll('a[href^="/forums.php?action=viewthread"]')).length;c<f;p=++c)w(N=i[p]),(o=document.createElement("a")).href="#",o.textContent=m,o.addEventListener("click",g(N,p,false),true),N.parentNode.insertBefore(o,N);O&&(A=document.createElement("tr"),(k=[]).push(document.createElement("td")),k.push(document.createElement("td")),k[0].className="label",(E=document.createElement("strong")).textContent="Filter author(s):",k[0].appendChild(E),(h=document.createElement("input")).placeholder="Comma- or space-separated list of authors",h.size="64",(a=document.createElement("button")).textContent="Filter",a.type="button",k[1].appendChild(h),k[1].appendChild(a),A.appendChild(k[0]),A.appendChild(k[1]),(x=document.querySelector('select[name="forums[]"]').parentNode.parentNode).parentNode.insertBefore(A,x),a.addEventListener("click",function(e){var t,n,r;if(""!==h.value.replace(/[,\s]/g,"")){for(M=function(){var e,t,n,r;for(r=[],e=0,t=(n=h.value.trim().replace(/[,\s]+/g,",").split(",")).length;e<t;e++)r.push(n[e].trim());return r}(),a.disabled="disabled",r=[],t=t=0,n=i.length;t<n;t=++t)r.push(g(N=i[t],t,true)());return r}},true))}}(),function(){if(delicious.settings.basicScriptCheckbox("hidepmstaff","PM the staff","Hide/Unhide PM the Staff link on the main menu")){var e=document.evaluate('//*[@id="nav_staffpm"]',document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;e&&(e.style.display="none")}}(),function(){if(delicious.settings.basicScriptCheckbox("delicioustreats","Disgusting Treats","Hide those hideous treats on profile pages!")){var e=document.evaluate('//*[@id="user_leftcol"]/div[@class="box" and div[@class="head" and .="Treats"]]',document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;e&&(e.style.display="none")}}(),delicious.settings.basicScriptCheckbox("hoverdrop","Hoverin","Enable/Disable Auto dropdown menus when hovering.")){var e,t,n;if(e=".navmenu:hover .subnav { display: block !important;}",(t=document.getElementsByTagName("head")[0])&&((n=document.createElement("style")).type="text/css",n.innerHTML=e,t.appendChild(n)),function(){if(delicious.settings.basicScriptCheckbox("delicioushyperquote","Delicious Hyper Quote","Select text and press Ctrl+V to instantly quote it.")&&null!==document.getElementById("quickpost")){var e=false,t=/^rgb\((\d{1,3}), (\d{1,3}), (\d{1,3})\)$/i,n=/^\/user\.php\?id=(\d+)$/,r=/^torrents2?\.php\?id=\d+&torrentid=(\d+)$/,o=/\/embed\/([^?]+)\?/i,i=/\/player\/\?url=([^&]+)&/i;document.addEventListener("keydown",function(t){t.ctrlKey&&86===t.keyCode&&function(){var t=window.getSelection();if(0!==t.rangeCount)if(1===t.rangeCount)e&&console.log("Quoting one range:"),e&&console.log(t.getRangeAt(0)),QUOTEMANY(t.getRangeAt(0));else{e&&console.log("Dealing with multiple ranges.");for(var n=[],r=t.getRangeAt(0),o=r,i=null,l=1;l<t.rangeCount+1;l++)if(null!==(i=l<t.rangeCount?t.getRangeAt(l):null)&&0===i.startOffset&&o.endContainer.childNodes[o.endOffset+1]===i.startContainer)o=i;else{if(r!==o){var a=document.createRange();a.setStart(r.startContainer,r.startOffset),a.setEnd(o.endContainer,o.endOffset),n.push(a)}else n.push(o);r=i,o=i}for(var s=0;s<n.length;s++)QUOTEMANY(n[s])}}()})}function formattedUTCString(e,t){var n=new Date(e);return isNaN(n.getTime())?e:(n=n.toUTCString().split(" "))[1]+" "+n[2]+" "+n[3]+", "+n[4].substring(0,5)+(false!==t?" "+n[5]:"")}function QUOTEMANY(t){function removeChildren(e,t){if(null!==e&&null!==e.parentNode){if(true===t)for(;e.parentNode.firstChild!==e;)e.parentNode.removeChild(e.parentNode.firstChild);else for(;e.parentNode.lastChild!==e;)e.parentNode.removeChild(e.parentNode.lastChild);removeChildren(e.parentNode,t)}}function inArray(t,n){for(var r=0;r<t.length;r++)if(t[r]===n)return r;return e&&console.log(n),-1}var n=[];function preserveIfNeeded(e){var t=0;if(function(e){try{var t=e.previousSibling,n=t.previousSibling,r=n.firstElementChild,o=n.previousElementSibling;return":\n"===t.nodeValue&&"SPAN"===r.tagName.toUpperCase()&&r.title&&"A"===n.tagName.toUpperCase()&&"wrote "===n.textContent.slice(0,6)&&"STRONG"===o.tagName.toUpperCase()&&-1!==o.firstElementChild.href.indexOf("/user.php?id=")}catch(e){return false}}(e)?t=4:function(e){try{var t=e.previousSibling,n=t.previousSibling;return" wrote:\n"===t.nodeValue&&n.nodeType===Node.ELEMENT_NODE&&"STRONG"===n.tagName.toUpperCase()&&1===n.childNodes.length&&n.firstChild.nodeType===Node.TEXT_NODE}catch(e){return false}}(e)&&(t=2),t){var r,o=[r=n.length?n.slice(-1)[0]+1:1,function(e,t){for(var n=document.createDocumentFragment(),r=inArray(t.parentNode.childNodes,t),o=0;o<e;o++)n.appendChild(t.parentNode.childNodes[r-e+o].cloneNode(true));return n}(t,e)];return e.dataset.hyperQuote=r,n.push(o),o}return null}function traverseUpwards(e,t){for(var n=[];null!==e.parentNode;)n.push(inArray(e.parentNode.childNodes,e)),t&&preserveIfNeeded(e),e=e.parentNode;return[e,n]}function traverseDownwards(e,t){for(var n=t.length-1;n>=0;n--){if(-1===t[n])return;e=e.childNodes[t[n]]}return e}if(true!==t.collapsed){var r=t.startContainer,o=traverseUpwards(r,true);r=o[0];var i=o[1],l=t.endContainer,a=traverseUpwards(l,false),s=a[1];if(r===(l=a[0])&&null!==r){var d=r.cloneNode(true),u=traverseDownwards(d,i),c=traverseDownwards(d,s);if(3===c.nodeType)c.data=c.data.substr(0,t.endOffset);else if(1===c.nodeType)for(var p=c.childNodes.length;p>t.endOffset;p--)c.removeChild(c.lastChild);if(t.startOffset>0)if(3===u.nodeType)u.data=u.data.substr(t.startOffset);else if(1===u.nodeType)for(var h=0;h<t.startOffset;h++)u.removeChild(u.firstChild);removeChildren(u,true),removeChildren(c,false);for(var f=d,g=null,m=null;1===f.childNodes.length||2===f.childNodes.length&&(m=f.childNodes[1])&&(m.nodeType===Node.TEXT_NODE&&!m.nodeValue.trim()||m.tagName&&"BR"===m.tagName.toUpperCase());)(f=f.firstChild).classList&&f.classList.contains("blockquote")&&(g=f);for(var v=0;v<n.length;v++){var b='[data-hyper-quote="'+n[v][0]+'"]',y=d.querySelector(b);y.parentNode.insertBefore(n[v][1],y),delete document.querySelector(b).dataset.hyperQuote}if(n=[],g){var C=document.getElementById("quickpost");return C.value+=bbcodeChildrenTrim(g.parentNode),void C.scrollIntoView()}for(var N=d.querySelectorAll('div[id^="post"],div[id^="msg"]'),_=0;_<N.length;_++)QUOTEONE(N[_])}}}function bbcodeChildrenTrim(e){return bbcodeChildren(e).trim()}function bbcodeChildren(t){if(e&&console.log("parentNode: "),e&&console.log(t),!(t.childNodes&&t.childNodes.length))return"";for(var n="",r=0;r<t.childNodes.length;r++){var o=t.childNodes[r];if(o.nodeType!==Node.TEXT_NODE){var i=false;try{i=r+4<t.childNodes.length&&o.nodeType===Node.ELEMENT_NODE&&"STRONG"===o.tagName.toUpperCase()&&-1!==o.firstElementChild.href.indexOf("user.php?id=")&&!t.childNodes[r+1].nodeValue.trim()&&-1!==t.childNodes[r+2].textContent.indexOf("wrote")&&"SPAN"===t.childNodes[r+2].firstElementChild.tagName.toUpperCase()&&t.childNodes[r+2].firstElementChild.title&&-1!==t.childNodes[r+3].nodeValue.indexOf(":")&&t.childNodes[r+4].classList.contains("blockquote")}catch(t){e&&console.log(t)}if(e&&console.log("isSmartQuote: "+i),i)n+=bbcodeSmartQuote(0,t.childNodes[r+2],t.childNodes[r+4]),r+=4;else{var l=false;try{l=r+2<t.childNodes.length&&o.nodeType===Node.ELEMENT_NODE&&"STRONG"===o.tagName.toUpperCase()&&1===o.childNodes.length&&o.firstChild.nodeType===Node.TEXT_NODE&&"wrote:"===t.childNodes[r+1].nodeValue.trim()&&t.childNodes[r+2].classList.contains("blockquote")}catch(t){e&&console.log(t)}if(l)n+=bbcodeQuote(o.firstChild.nodeValue,t.childNodes[r+2]),r+=2;else{var a=false;try{a=o.classList.contains("hideContainer")&&(r+1<t.childNodes.length&&"TABLE"===t.childNodes[r+1].tagName.toUpperCase()&&t.childNodes[r+1].classList.contains("mediainfo")||r+1===t.childNodes.length&&o.firstElementChild.value.length>4&&-1!==o.firstElementChild.value.indexOf(".")&&document.querySelector('.hideContainer > .spoilerButton[value="'+o.firstElementChild.value+'"]').parentNode.nextElementSibling.classList.contains("mediainfo"))}catch(t){e&&console.log(t)}a?(n+=(d=o).children.length<2?"":"[mediainfo]"+bbcodeChildren(d.children[1])+"[/mediainfo]",r+=1):n+=bbcodeOneElement(o)}}}else{var s=o.nodeValue;r>0&&t.childNodes[r-1].nodeType===Node.ELEMENT_NODE&&"BR"===t.childNodes[r-1].tagName.toUpperCase()&&(s=s.replace(/^\s+/,"")),r+1<t.childNodes.length&&t.childNodes[r+1].nodeType===Node.ELEMENT_NODE&&"BR"===t.childNodes[r+1].tagName.toUpperCase()&&(s=s.replace(/\s+$/,"")),n+=s}}var d;return n}function bbcodeQuote(e,t){var n=bbcodeChildrenTrim(t);return"[quote"+(e?"="+e:"")+"]\n"+n+"\n[/quote]\n"}function bbcodeSmartQuote(e,t,n){var r="",o=t.href;if(-1!==o.indexOf("/forums.php")?r="#":-1!==o.indexOf("/user.php")?r="*":-1!==o.indexOf("/torrents.php")?r="-1":-1!==o.indexOf("/torrents2.php")&&(r="-2"),""!==r){var i=/#(?:msg|post)?(\d+)$/.exec(o);if(i)return bbcodeQuote(r+i[1],n)}return"[url="+t.href+"]Unknown quote[/url][quote]"+bbcodeChildren(n)+"[/quote]"}function bbcodeList(e,t){for(var n="",r=0;r<e.childElementCount;r++)"\n"!==(n+=t+bbcodeChildren(e.children[r])).slice(-1)&&(n+="\n");return n}function bbcodeImage(e){return e.classList.contains("bbcode_smiley")?e.alt:"[img]"+e.src+"[/img]"}function numToHex(e){for(var t=e.toString(16);t.length<2;)t="0"+t;return t}function bbcodeOneElement(e){if(e.nodeType!==Node.ELEMENT_NODE)return e.nodeType===Node.TEXT_NODE?e.nodeValue:e.nodeType===Node.COMMENT_NODE&&"n"===e.nodeValue?"[n]":"";switch(e.tagName.toUpperCase()){case"DIV":return(l=e).style.textAlign?"[align="+l.style.textAlign+"]"+bbcodeChildren(l)+"[/align]":l.classList.contains("codeBox")?"[code]"+l.firstElementChild.firstChild.nodeValue+"[/code]":l.classList.contains("spoilerContainer")?function(e){var t=!e.classList.contains("hideContainer"),n=t?"spoiler":"hide";if(e.children.length<2)return e.firstElementChild.classList.contains("spoiler")?"["+n+"]"+bbcodeChildren(e.firstElementChild)+"[/"+n+"]":"";var r=e.firstElementChild.value.replace(/^(Hide|Show)/,"");return t&&(r=r.replace(/ spoiler$/,"")),r&&(r=r.slice(1)),"["+n+(r?"="+r:"")+"]\n"+bbcodeChildrenTrim(e.children[1])+"\n[/"+n+"]"}(l):bbcodeChildren(l);case"SPAN":return function(e){if(-1!==e.className.indexOf("smiley-"))return n=e.title,null===(r=document.querySelector('span[alt="'+n+'"]'))&&(r=document.querySelector('span[style*="/'+n+'.png"]')),null===r&&(r=document.querySelector('span[style*="/'+n.replace(/-/g,"_")+'.png"]')),null===r&&(r=document.querySelector('span[style*="/'+n.replace(/-/g,"_").toLowerCase()+'.png"]')),null===r&&(r=document.querySelector('span[style*="/'+n.replace(/face/g,"~_~")+'.png"]')),null!==r&&null!==r.parentNode&&null!==(r=r.getAttribute("onclick").match(/'(.+?)'/i))?r[1]:":"+n+":";var n,r,o=e.style.color;if(o){var i=t.exec(o);return i&&(o="#"+numToHex(parseInt(i[1]))+numToHex(parseInt(i[2]))+numToHex(parseInt(i[3]))),"[color="+o+"]"+bbcodeChildren(e)+"[/color]"}return"size"===e.className.slice(0,4)?"[size="+e.className.replace("size","")+"]"+bbcodeChildren(e)+"[/size]":"last-edited"===e.className?"":e.classList.contains("secret")?"[secret]"+bbcodeChildren(e)+"[/secret]":e.title?formattedUTCString(e.title):bbcodeChildren(e)}(e);case"BR":return"\n";case"STRONG":return function(e){if(1===e.childNodes.length&&e.firstChild.nodeType===Node.TEXT_NODE&&"Added on "===e.firstChild.nodeValue.slice(0,9)){var t=e.firstChild.nodeValue.slice(9),n="";return":"===t.slice(-1)&&(t=t.slice(0,-1),n=":"),"[b]Added on "+formattedUTCString(t)+n+"[/b]"}return"[b]"+bbcodeChildren(e)+"[/b]"}(e);case"EM":return"[i]"+bbcodeChildren(e)+"[/i]";case"U":return"[u]"+bbcodeChildren(e)+"[/u]";case"S":return"[s]"+bbcodeChildren(e)+"[/s]";case"OL":return bbcodeList(e,"[#] ");case"UL":return bbcodeList(e,"[*] ");case"A":return function(e){if(e.classList.contains("scaledImg"))return bbcodeImage(e.firstElementChild);var t=e.href,o=e.getAttribute("href");return n.exec(o)?"[user="+t+"]"+bbcodeChildren(e)+"[/user]":r.exec(o)?-1!==e.textContent.indexOf("  [")?"[torrent]"+t+"[/torrent]":"[torrent="+t+"]"+bbcodeChildren(e)+"[/torrent]":"[url="+o+"]"+bbcodeChildren(e)+"[/url]"}(e);case"IMG":return bbcodeImage(e);case"IFRAME":return-1!==(a=e.src).indexOf("youtube.com/embed")?"[youtube]https://youtube.com/watch?v="+o.exec(a)[1]+"[/youtube]":-1!==a.indexOf("soundcloud.com/player")?"[soundcloud]"+decodeURIComponent(i.exec(a)[1])+"[/soundcloud]":"Embedded media: "+a;case"BLOCKQUOTE":return bbcodeQuote("",e);case"HR":return"[hr]";case"TABLE":return bbcodeChildren(e);case"CAPTION":return"[b]"+bbcodeChildren(e)+"[/b]\n";case"TBODY":return bbcodeChildren(e);case"TH":case"TR":return bbcodeChildren(e)+"\n";case"TD":return bbcodeChildren(e)+"\t";default:return"<"+e.tagName+">"+bbcodeChildren(e)+"</"+e.tagName+">"}var l,a}function QUOTEONE(e){var t,n,r,o=bbcodeChildrenTrim(e.querySelector("div.post, div.body")),i="";if(""!==o&&null!==(r=e.id.match(/(?:msg|post)(\d+)/i))){"/forums.php"===window.location.pathname&&(i="#"),"/user.php"===window.location.pathname&&(i="*"),"/torrents.php"===window.location.pathname&&(i="-1"),"/torrents2.php"===window.location.pathname&&(i="-2"),""!==i?o="[quote="+i+r[1]+"]"+o+"[/quote]\n":(t=null!==(t=e.className.match(/user_(\d+)/i))?"[b][user]"+t[1]+"[/user][/b] ":null!==(t=document.querySelector("#"+r[0]+' a[href^="/user.php?"]'))&&null!==(t=t.href.match(/id=(\d+)/i))?"[b][user]"+t[1]+"[/user][/b] ":"",null===(n=document.querySelector("div#"+r[0]+" > div > div > p.posted_info > span"))&&(n=document.querySelector("div#"+r[0]+" > div > span > span.usercomment_posttime")),n=null!==n?" on "+formattedUTCString(n.title.replace(/-/g,"/")):"",o=t+"[url="+window.location.pathname+window.location.search+"#"+r[0]+"]wrote"+n+"[/url]:\n[quote]"+o+"[/quote]\n\n"),document.getElementById("quickpost").value+=o;var l=document.getElementById("quickpost");null!==l&&l.scrollIntoView()}}}(),function(){var e=false;if(delicious.settings.basicScriptCheckbox("deliciouskeyboard","Delicious Keyboard Shortcuts","Keyboard shortcuts to make typing BBCode easier.")&&null!==document.querySelector("textarea")){var t=-1!=navigator.appVersion.indexOf("Mac")?"⌘":"Ctrl",n=[],r=document.querySelectorAll("textarea");keydownHandler({});for(var o=0;o<r.length;o++)r[o].addEventListener("keydown",keydownHandler,false);new MutationObserver(function(t,n){if(e&&console.log(t),t[0].addedNodes.length)for(var r=document.querySelectorAll("textarea"),o=0;o<r.length;o++)r[o].addEventListener("keydown",keydownHandler,false)}).observe(document.querySelector("body"),{childList:true,subtree:true})}function insert(r,o,i,l,a,s,d,u){var c;switch(e&&(console.log(String.fromCharCode(r.charCode)),console.log(r.ctrlKey),console.log(r.metaKey),console.log(r.altKey),console.log(r.shiftKey)),o){case".":c=190;break;case"/":c=191;break;default:c=o.charCodeAt(0)}if("textarea"===document.activeElement.tagName.toLowerCase()&&i===(r.ctrlKey||r.metaKey)&&l===r.altKey&&a===r.shiftKey&&r.keyCode===c)return r.preventDefault(),function(e,t){var n,r=document.activeElement;if(r.selectionStart||"0"==r.selectionStart){var o=r.selectionStart,i=r.selectionEnd;r.value=r.value.substring(0,o)+e+r.value.substring(o,i)+t+r.value.substring(i,r.value.length),r.selectionStart=r.selectionEnd=i+e.length+t.length,r.focus(),r.setSelectionRange(o+e.length,0==t.length?o+e.length:i+e.length)}else document.selection&&document.selection.createRange?(r.focus(),(n=document.selection.createRange()).text=e+n.text+t,0!=t.length&&(n.move("character",-t.length),n.select()),r.focus()):(r.value+=e,r.focus(),r.value+=t)}(s,d),false;if(void 0!==u&&-1===n.indexOf(u)){n.push(u);for(var p=document.querySelectorAll(u),h=0;h<p.length;h++){var f=p[h];f.title+=" (",i&&(f.title+=t+"+"),l&&(f.title+="Alt+"),a&&(f.title+="Shift+"),f.title+=o+")"}}}function keydownHandler(e){insert(e,"B",true,false,false,"[b]","[/b]",'#bbcode img[title="Bold"]'),insert(e,"I",true,false,false,"[i]","[/i]",'#bbcode img[title="Italics"]'),insert(e,"U",true,false,false,"[u]","[/u]",'#bbcode img[title="Underline"]'),insert(e,"R",true,false,false,"[align=right]","[/align]"),insert(e,"L",true,false,false,"[align=left]","[/align]"),insert(e,"E",true,false,false,"[align=center]","[/align]"),insert(e,"S",true,false,false,"[spoiler]","[/spoiler]",'#bbcode img[title="Spoilers"]'),insert(e,"H",true,false,false,"[hide]","[/hide]",'#bbcode img[title="Hide"]'),insert(e,"Y",true,true,false,"[youtube]","[/youtube]",'#bbcode img[alt="YouTube"]'),insert(e,"G",true,false,false,"[img]","[/img]",'#bbcode img[title="Image"]'),insert(e,".",true,false,false,"[*] ","",'#bbcode img[title="Unordered list"]'),insert(e,"/",true,false,false,"[#] ","",'#bbcode img[title="Ordered list"]'),insert(e,"K",true,false,false,"[url=]","[/url]",'#bbcode img[title="URL"]')}}(),delicious.settings.basicScriptCheckbox("delicioustitleflip","Delicious Title Flip","Flips the tab title.")&&-1!==document.title.indexOf(" > ")&&(document.title=document.title.split(" :: ")[0].split(" > ").reverse().join(" < ")+" :: AnimeBytes"),function(){if(delicious.settings.basicScriptCheckbox("delicioustitlenotifications","Delicious Title Notifications","Display number of notifications in the tab title.")){var e,t,n=0,r=document.querySelectorAll("#alerts .new_count"),o=r.length;for(e=0;e<o;e++)isNaN(t=parseInt(r[e].textContent,10))||(n+=t);n>0&&(document.title="("+n+") "+document.title)}}(),delicious.settings.init("ABGamesForum",false),delicious.settings.init("unreadindx",false),delicious.settings.init("ABNoT",5),delicious.settings.ensureSettingsInserted()){var r=delicious.settings.createCollapsibleSection("Unread Index"),o=r.querySelector(".settings_section_body");o.appendChild(delicious.settings.createCheckbox("unreadindx","Enable","Enable/Disable Unread Index script.")),o.appendChild(delicious.settings.createCheckbox("ABGamesForum","Unread forums in index(News Page)",'Hide those hideous "Forum Games" on your unread index page!')),o.appendChild(delicious.settings.createNumberInput("ABNoT","Number of threads","set the number of threads to show")),delicious.settings.insertSection(r)}if(delicious.settings.get("unreadindx")){var i,l=document.createElement("div");l.className="divider";var a,s,d=document.getElementById("news");null!==d&&(a=document.implementation.createHTMLDocument(""),(s=new XMLHttpRequest).onreadystatechange=function(){if(4==s.readyState&&200==s.status){a.documentElement.innerHTML=s.responseText,i=a.evaluate("//div[@id='content']/div[@class='thin']/table[@width='100%']",a,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;for(var e=0,t=0;t<2;t++)i.rows[0].cells[t].style.padding="8px";i.rows[0].cells[0].style.width="30%",i.rows[0].cells[1].style.width="70%",i.rows[0].deleteCell(2);for(var n=i.rows[1],r=1;n&&null!=(n=i.rows[r]);r++)if(true===delicious.settings.get("ABGamesForum")&&"Forum Games"===n.cells[0].getElementsByTagName("a")[0].textContent.trim()||e===delicious.settings.get("ABNoT"))i.deleteRow(r),r--;else if(e<delicious.settings.get("ABNoT")){for(var o=0;o<2;o++)n.cells[o].style.padding="0px";n.cells[1].getElementsByTagName("p")[0].innerHTML+="<div style='font-size: 8px;'>"+n.cells[2].getElementsByTagName("p")[0].innerHTML+"</div>",n.deleteCell(2),e++}i.style.marginBottom="20px",d.parentNode.insertBefore(i,d),d.parentNode.insertBefore(l,d)}},s.open("GET","/forums.php?action=viewunread",true),s.send()),function(){var e,t;function compoundInterest(e){return(Math.pow(2,e)-1)/Math.log(2)}function formatInteger(e){for(var t="";e>=1e3;)t=","+("00"+e%1e3).slice(-3)+t,e=Math.floor(e/1e3);return e+t}function bytecount(e,t){switch(t){case"B":return 1*e;case"KiB":case"KIB":return 1024*e;case"MiB":case"MIB":return 1048576*e;case"GiB":case"GIB":return 1073741824*e;case"TiB":case"TIB":return 1099511627776*e;case"PiB":case"PIB":return 0x4000000000000*e;case"EiB":case"EIB":return e*Math.pow(1024,6)}}function humancount(e){if(0==e)return"0 B";var t=Math.floor(Math.log(Math.abs(e))/Math.log(1024));switch(e=(e/Math.pow(1024,t)).toFixed(2),t){case 0:return e+" B";case 1:return e+" KiB";case 2:return e+" MiB";case 3:return e+" GiB";case 4:return e+" TiB";case 5:return e+" PiB";case 6:return e+" EiB";default:return e+" × 1024^"+t+" B"}}function addDefinitionAfter(n,r,o,i){return(e=document.createElement("dt")).appendChild(document.createTextNode(r)),t=document.createElement("dd"),void 0!==i&&(t.className+=i),t.appendChild(document.createTextNode(o)),n.parentNode.insertBefore(t,n.nextElementSibling.nextSibling),n.parentNode.insertBefore(e,n.nextElementSibling.nextSibling),e}function addDefinitionBefore(n,r,o,i){return(e=document.createElement("dt")).appendChild(document.createTextNode(r)),t=document.createElement("dd"),void 0!==i&&(t.className+=i),t.appendChild(document.createTextNode(o)),n.parentNode.insertBefore(e,n),n.parentNode.insertBefore(t,n),e}delicious.settings.init("deliciousyenperx",true),delicious.settings.init("deliciousratio",true),delicious.settings.basicScriptCheckbox("deliciousyenperx","Delicious Yen Per X","Shows how much yen you receive per X and as upload equivalent."),delicious.settings.basicScriptCheckbox("deliciousratio","Delicious Ratio","Shows ratio, raw ratio and how much upload/download you need for certain ratio milestones."),/user\.php\?id=/i.test(document.URL)&&(delicious.settings.get("deliciousratio")&&function(){var e,t=/([0-9,.]+)\s*([A-Z]+)\s*\(([^)]*)\)/i;if(null!=(e=document.createTreeWalker(document,NodeFilter.SHOW_TEXT,{acceptNode:function(e){return/^Raw Uploaded:/i.test(e.data)}})).nextNode()){var n=e.currentNode.data.match(t);if(null!=(e=document.createTreeWalker(e.currentNode.parentNode.parentNode,NodeFilter.SHOW_TEXT,{acceptNode:function(e){return/^Raw Downloaded:/i.test(e.data)}})).nextNode()){var r=e.currentNode.data.match(t);if(null!=(e=document.createTreeWalker(document.getElementById("content"),NodeFilter.SHOW_TEXT,{acceptNode:function(e){return/^\s*Ratio/i.test(e.data)}})).nextNode()){var o=e.currentNode.parentNode;if(null!=(e=document.createTreeWalker(document.getElementById("content"),NodeFilter.SHOW_TEXT,{acceptNode:function(e){return/^\s*Uploaded/i.test(e.data)}})).nextNode()){var i=e.currentNode.parentNode;if(null!=(e=document.createTreeWalker(document.getElementById("content"),NodeFilter.SHOW_TEXT,{acceptNode:function(e){return/^\s*Downloaded/i.test(e.data)}})).nextNode()){var l=e.currentNode.parentNode,a=i.nextElementSibling.textContent.match(t),s=l.nextElementSibling.textContent.match(t),d=bytecount(parseFloat(a[1].replace(/,/g,"")),a[2].toUpperCase()),u=bytecount(parseFloat(s[1].replace(/,/g,"")),s[2].toUpperCase()),c=bytecount(parseFloat(n[1].replace(/,/g,"")),n[2].toUpperCase()),p=bytecount(parseFloat(r[1].replace(/,/g,"")),r[2].toUpperCase()),h=1/0;bytecount(parseFloat(r[1].replace(/,/g,"")),r[2].toUpperCase())>0&&(h=(bytecount(parseFloat(n[1].replace(/,/g,"")),n[2].toUpperCase())/bytecount(parseFloat(r[1].replace(/,/g,"")),r[2].toUpperCase())).toFixed(2));var f="r99";h<1?f="r"+("0"+Math.ceil(10*h)).slice(-2):h<5?f="r20":h<99&&(f="r50");var g=document.createElement("hr");g.style.clear="both",o.parentNode.insertBefore(g,o.nextElementSibling.nextSibling);var m=addDefinitionAfter(o,"Raw Ratio:",h,f);addDefinitionAfter(o,"Raw Downloaded:",r[0]),addDefinitionAfter(o,"Raw Uploaded:",n[0]),o.nextElementSibling.title="Ratio\t  Buffer",m.nextElementSibling.title="Raw ratio\t Raw Buffer";for(var v=0;v<10;v++){var b=[.2,.5,.7,.8,.9,1,1.5,2,5,10][v];o.nextElementSibling.title+=printBuffer(d,u,b),m.nextElementSibling.title+=printBuffer(c,p,b)}}}}}}function printBuffer(e,t,n){return e/n-t>=0?"\n"+n.toFixed(1)+"\t"+humancount(e/n-t).slice(-10)+"    \tcan be downloaded":"\n"+n.toFixed(1)+"\t"+humancount(t*n-e).slice(-10)+"    \tmust be uploaded"}}(),delicious.settings.get("deliciousyenperx")&&function(){var e=365.256363,t=document.createTreeWalker(document.getElementById("content"),NodeFilter.SHOW_TEXT,{acceptNode:function(e){return/Yen per day/i.test(e.data)}});if(null!=t.nextNode()){var n=t.currentNode.parentNode,r=parseInt(n.nextElementSibling.textContent,10)*e;addDefinitionAfter(n,"Yen per year:",formatInteger(Math.round(r*compoundInterest(1)))),addDefinitionAfter(n,"Yen per month:",formatInteger(Math.round(r*compoundInterest(1/12)))),addDefinitionAfter(n,"Yen per week:",formatInteger(Math.round(r*compoundInterest(7/e))));var o=document.createElement("hr");o.style.clear="both",n.parentNode.insertBefore(o,n),addDefinitionBefore(n,"Yen as upload:",humancount(1048576*r*compoundInterest(1/e/24/60/60))+"/s"),addDefinitionBefore(n,"Yen per hour:",(r*compoundInterest(1/e/24)).toFixed(1))}}())}()}}}()}]);
//# sourceMappingURL=abs.min.user.js.map